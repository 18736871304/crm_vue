window.CtiAgentBar=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=116)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.STATUS_EARLY=1]="STATUS_EARLY",e[e.STATUS_CONFIRMED=2]="STATUS_CONFIRMED"}(t.DialogStatus||(t.DialogStatus={})),function(e){e[e.STATUS_NULL=0]="STATUS_NULL",e[e.STATUS_INVITE_SENT=1]="STATUS_INVITE_SENT",e[e.STATUS_1XX_RECEIVED=2]="STATUS_1XX_RECEIVED",e[e.STATUS_INVITE_RECEIVED=3]="STATUS_INVITE_RECEIVED",e[e.STATUS_WAITING_FOR_ANSWER=4]="STATUS_WAITING_FOR_ANSWER",e[e.STATUS_ANSWERED=5]="STATUS_ANSWERED",e[e.STATUS_WAITING_FOR_PRACK=6]="STATUS_WAITING_FOR_PRACK",e[e.STATUS_WAITING_FOR_ACK=7]="STATUS_WAITING_FOR_ACK",e[e.STATUS_CANCELED=8]="STATUS_CANCELED",e[e.STATUS_TERMINATED=9]="STATUS_TERMINATED",e[e.STATUS_ANSWERED_WAITING_FOR_PRACK=10]="STATUS_ANSWERED_WAITING_FOR_PRACK",e[e.STATUS_EARLY_MEDIA=11]="STATUS_EARLY_MEDIA",e[e.STATUS_CONFIRMED=12]="STATUS_CONFIRMED"}(t.SessionStatus||(t.SessionStatus={})),function(e){e[e.ClientContext=0]="ClientContext",e[e.ConfigurationError=1]="ConfigurationError",e[e.Dialog=2]="Dialog",e[e.DigestAuthentication=3]="DigestAuthentication",e[e.DTMF=4]="DTMF",e[e.IncomingMessage=5]="IncomingMessage",e[e.IncomingRequest=6]="IncomingRequest",e[e.IncomingResponse=7]="IncomingResponse",e[e.InvalidStateError=8]="InvalidStateError",e[e.InviteClientContext=9]="InviteClientContext",e[e.InviteServerContext=10]="InviteServerContext",e[e.Logger=11]="Logger",e[e.LoggerFactory=12]="LoggerFactory",e[e.MethodParameterError=13]="MethodParameterError",e[e.NameAddrHeader=14]="NameAddrHeader",e[e.NotSupportedError=15]="NotSupportedError",e[e.OutgoingRequest=16]="OutgoingRequest",e[e.Parameters=17]="Parameters",e[e.PublishContext=18]="PublishContext",e[e.ReferClientContext=19]="ReferClientContext",e[e.ReferServerContext=20]="ReferServerContext",e[e.RegisterContext=21]="RegisterContext",e[e.RenegotiationError=22]="RenegotiationError",e[e.RequestSender=23]="RequestSender",e[e.ServerContext=24]="ServerContext",e[e.Session=25]="Session",e[e.SessionDescriptionHandler=26]="SessionDescriptionHandler",e[e.SessionDescriptionHandlerError=27]="SessionDescriptionHandlerError",e[e.SessionDescriptionHandlerObserver=28]="SessionDescriptionHandlerObserver",e[e.Subscription=29]="Subscription",e[e.Transport=30]="Transport",e[e.UA=31]="UA",e[e.URI=32]="URI"}(t.TypeStrings||(t.TypeStrings={})),function(e){e[e.STATUS_INIT=0]="STATUS_INIT",e[e.STATUS_STARTING=1]="STATUS_STARTING",e[e.STATUS_READY=2]="STATUS_READY",e[e.STATUS_USER_CLOSED=3]="STATUS_USER_CLOSED",e[e.STATUS_NOT_READY=4]="STATUS_NOT_READY"}(t.UAStatus||(t.UAStatus={}))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(30);!function(e){e.USER_AGENT=n.title+"/"+n.version,e.SIP="sip",e.SIPS="sips",function(e){e.CONNECTION_ERROR="Connection Error",e.INTERNAL_ERROR="Internal Error",e.REQUEST_TIMEOUT="Request Timeout",e.SIP_FAILURE_CODE="SIP Failure Code",e.ADDRESS_INCOMPLETE="Address Incomplete",e.AUTHENTICATION_ERROR="Authentication Error",e.BUSY="Busy",e.DIALOG_ERROR="Dialog Error",e.INCOMPATIBLE_SDP="Incompatible SDP",e.NOT_FOUND="Not Found",e.REDIRECTED="Redirected",e.REJECTED="Rejected",e.UNAVAILABLE="Unavailable",e.BAD_MEDIA_DESCRIPTION="Bad Media Description",e.CANCELED="Canceled",e.EXPIRES="Expires",e.NO_ACK="No ACK",e.NO_ANSWER="No Answer",e.NO_PRACK="No PRACK",e.RTP_TIMEOUT="RTP Timeout",e.USER_DENIED_MEDIA_ACCESS="User Denied Media Access",e.WEBRTC_ERROR="WebRTC Error",e.WEBRTC_NOT_SUPPORTED="WebRTC Not Supported"}(e.causes||(e.causes={})),function(e){e.REQUIRED="required",e.SUPPORTED="supported",e.UNSUPPORTED="none"}(e.supported||(e.supported={})),e.SIP_ERROR_CAUSES={ADDRESS_INCOMPLETE:[484],AUTHENTICATION_ERROR:[401,407],BUSY:[486,600],INCOMPATIBLE_SDP:[488,606],NOT_FOUND:[404,604],REDIRECTED:[300,301,302,305,380],REJECTED:[403,603],UNAVAILABLE:[480,410,408,430]},e.ACK="ACK",e.BYE="BYE",e.CANCEL="CANCEL",e.INFO="INFO",e.INVITE="INVITE",e.MESSAGE="MESSAGE",e.NOTIFY="NOTIFY",e.OPTIONS="OPTIONS",e.REGISTER="REGISTER",e.UPDATE="UPDATE",e.SUBSCRIBE="SUBSCRIBE",e.PUBLISH="PUBLISH",e.REFER="REFER",e.PRACK="PRACK",e.REASON_PHRASE={100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},e.OPTION_TAGS={"100rel":!0,199:!0,answermode:!0,"early-session":!0,eventlist:!0,explicitsub:!0,"from-change":!0,"geolocation-http":!0,"geolocation-sip":!0,gin:!0,gruu:!0,histinfo:!0,ice:!0,join:!0,"multiple-refer":!0,norefersub:!0,nosub:!0,outbound:!0,path:!0,policy:!0,precondition:!0,pref:!0,privacy:!0,"recipient-list-invite":!0,"recipient-list-message":!0,"recipient-list-subscribe":!0,replaces:!0,"resource-priority":!0,"sdp-anat":!0,"sec-agree":!0,tdialog:!0,timer:!0,uui:!0},function(e){e.INFO="info",e.RTP="rtp"}(e.dtmfType||(e.dtmfType={}))}(t.C||(t.C={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),o=r(7);!function(e){e.defer=function(){var e={};return e.promise=new Promise(function(t,r){e.resolve=t,e.reject=r}),e},e.reducePromises=function(e,t){return e.reduce(function(e,t){return e=e.then(t)},Promise.resolve(t))},e.str_utf8_length=function(e){return encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length},e.generateFakeSDP=function(e){if(e){var t=e.indexOf("o="),r=e.indexOf("\r\n",t);return"v=0\r\n"+e.slice(t,r)+"\r\ns=-\r\nt=0 0\r\nc=IN IP4 0.0.0.0"}},e.isDecimal=function(e){var t=parseInt(e,10);return!isNaN(t)&&parseFloat(e)===t},e.createRandomToken=function(e,t){void 0===t&&(t=32);for(var r="",n=0;n<e;n++)r+=Math.floor(Math.random()*t).toString(t);return r},e.newTag=function(){return e.createRandomToken(10)},e.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.floor(16*Math.random());return("x"===e?t:t%4+8).toString(16)})},e.normalizeTarget=function(t,r){if(t){if(t.type===i.TypeStrings.URI)return t;if("string"==typeof t){var s=t.split("@"),a=void 0,c=void 0;switch(s.length){case 1:if(!r)return;a=t,c=r;break;case 2:a=s[0],c=s[1];break;default:a=s.slice(0,s.length-1).join("@"),c=s[s.length-1]}return a=a.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(a)&&(a=a.replace(/[\-\.\(\)]/g,"")),t=n.C.SIP+":"+e.escapeUser(a)+"@"+c,o.Grammar.URIParse(t)}}},e.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},e.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length,i="",o=0;o<n;o++)0!==o&&(i+="-"),i+=r[o].charAt(0).toUpperCase()+r[o].substring(1);return t[i]&&(i=t[i]),i},e.sipErrorCause=function(e){for(var t in n.C.SIP_ERROR_CAUSES)if(-1!==n.C.SIP_ERROR_CAUSES[t].indexOf(e))return n.C.causes[t];return n.C.causes.SIP_FAILURE_CODE},e.getReasonPhrase=function(e,t){return t||n.C.REASON_PHRASE[e]||""},e.getReasonHeaderValue=function(t,r){return"SIP;cause="+t+';text="'+(r=e.getReasonPhrase(t,r))+'"'},e.getCancelReason=function(t,r){if(t&&t<200||t>699)throw new TypeError("Invalid statusCode: "+t);if(t)return e.getReasonHeaderValue(t,r)},e.buildStatusLine=function(t,r){if(!t||t<100||t>699)throw new TypeError("Invalid statusCode: "+t);if(r&&"string"!=typeof r&&!(r instanceof String))throw new TypeError("Invalid reason: "+r);return"SIP/2.0 "+t+" "+(r=e.getReasonPhrase(t,r))+"\r\n"}}(t.Utils||(t.Utils={}))},function(e,t,r){"use strict";var n=r(43),i=r(70),o=Object.prototype.toString;function s(e){return"[object Array]"===o.call(e)}function a(e){return null!==e&&"object"==typeof e}function c(e){return"[object Function]"===o.call(e)}function u(e,t){if(null!=e)if("object"==typeof e||s(e)||(e=[e]),s(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:i,isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:a,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:c,isStream:function(e){return a(e)&&c(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:u,merge:function e(){var t={};function r(r,n){"object"==typeof t[n]&&"object"==typeof r?t[n]=e(t[n],r):t[n]=r}for(var n=0,i=arguments.length;n<i;n++)u(arguments[n],r);return t},extend:function(e,t,r){return u(t,function(t,i){e[i]=r&&"function"==typeof t?n(t,r):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function h(e,t,r,n){var i,o,s,a;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function l(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,h=f(c,u);for(r=0;r<u;++r)o(h[r],this,t)}return!0},a.prototype.addListener=function(e,t){return h(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return h(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):l.call(e,t)},a.prototype.listenerCount=l,a.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),s=function(e){function t(t){var r=this.constructor,n=e.call(this,t)||this;return Object.setPrototypeOf(n,r.prototype),n}return i(t,e),t}(Error);t.Exception=s,function(e){var t=function(e){function t(t){return e.call(this,t||"Unspecified transport error.")||this}return i(t,e),t}(s);e.TransportError=t}(t.Exceptions||(t.Exceptions={}));var a=function(e){function t(t,r,n){var i=e.call(this,n)||this;return i.code=t,i.name=r,i.message=n,i}return i(t,e),t}(s);!function(e){var t=function(e){function t(t,r){var n=e.call(this,1,"CONFIGURATION_ERROR",r?"Invalid value "+JSON.stringify(r)+" for parameter '"+t+"'":"Missing parameter: "+t)||this;return n.type=o.TypeStrings.ConfigurationError,n.parameter=t,n.value=r,n}return i(t,e),t}(a);e.ConfigurationError=t;var r=function(e){function t(t){var r=e.call(this,2,"INVALID_STATE_ERROR","Invalid status: "+t)||this;return r.type=o.TypeStrings.InvalidStateError,r.status=t,r}return i(t,e),t}(a);e.InvalidStateError=r;var n=function(e){function t(t){var r=e.call(this,3,"NOT_SUPPORTED_ERROR",t)||this;return r.type=o.TypeStrings.NotSupportedError,r}return i(t,e),t}(a);e.NotSupportedError=n;var s=function(e){function t(t){var r=e.call(this,5,"RENEGOTIATION_ERROR",t)||this;return r.type=o.TypeStrings.RenegotiationError,r}return i(t,e),t}(a);e.RenegotiationError=s;var c=function(e){function t(t,r,n){var i=e.call(this,6,"METHOD_PARAMETER_ERROR",n?"Invalid value "+JSON.stringify(n)+" for parameter '"+r+"'":"Missing parameter: "+r)||this;return i.type=o.TypeStrings.MethodParameterError,i.method=t,i.parameter=r,i.value=n,i}return i(t,e),t}(a);e.MethodParameterError=c;var u=function(e){function t(t,r,n){var i=e.call(this,8,"SESSION_DESCRIPTION_HANDLER_ERROR",n||"Error with Session Description Handler")||this;return i.type=o.TypeStrings.SessionDescriptionHandlerError,i.method=t,i.error=r,i}return i(t,e),t}(a);e.SessionDescriptionHandlerError=u}(t.Exceptions||(t.Exceptions={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(62);!function(e){e.parse=function(e,t){var r={startRule:t};try{n.parse(e,r)}catch(e){r.data=-1}return r.data},e.nameAddrHeaderParse=function(t){var r=e.parse(t,"Name_Addr_Header");return-1!==r?r:void 0},e.URIParse=function(t){var r=e.parse(t,"SIP_URI");return-1!==r?r:void 0}}(t.Grammar||(t.Grammar={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(5),a=r(2),c=r(6),u=r(16);!function(e){e.Accepted="Accepted",e.Calling="Calling",e.Completed="Completed",e.Confirmed="Confirmed",e.Proceeding="Proceeding",e.Terminated="Terminated",e.Trying="Trying"}(o=t.TransactionState||(t.TransactionState={}));var h=function(e){function t(t,r,n,i,o){var s=e.call(this)||this;return s._transport=t,s._user=r,s._id=n,s._state=i,s.logger=r.loggerFactory.getLogger(o,n),s.logger.debug("Constructing "+s.typeToString()+" with id "+s.id+"."),s}return i(t,e),t.prototype.dispose=function(){this.logger.debug("Destroyed "+this.typeToString()+" with id "+this.id+".")},Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"kind",{get:function(){if(this instanceof p)return"ict";if(this instanceof l)return"nict";if(this instanceof g)return"ist";if(this instanceof m)return"nist";throw new Error("Invalid kind.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transport",{get:function(){return this._transport},enumerable:!0,configurable:!0}),t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.logTransportError=function(e,t){this.logger.error(e.message),this.logger.error("Transport error occurred in "+this.typeToString()+" with id "+this.id+"."),this.logger.error(t)},t.prototype.send=function(e){var t=this;return this.transport.send(e).catch(function(e){var r;if(!(e instanceof c.Exceptions.TransportError))throw r=e&&"string"==typeof e.message?new c.Exceptions.TransportError(e.message):new c.Exceptions.TransportError,t.onTransportError(r),r;t.onTransportError(e)})},t.prototype.setState=function(e){this.logger.debug('State change to "'+e+'" on '+this.typeToString()+" with id "+this.id+"."),this._state=e,this._user.onStateChange&&this._user.onStateChange(e),this.emit("stateChanged")},t.prototype.typeToString=function(){var e="UnknownType";return this instanceof p?e="INVITE client transaction":this instanceof l?e="non-INVITE client transaction":this instanceof g?e="INVITE server transaction":this instanceof m&&(e="non-INVITE server transaction"),e},t}(s.EventEmitter);t.Transaction=h;var d=function(e){function t(r,n,i,o,s){var a=e.call(this,n,i,t.makeId(r),o,s)||this;return a._request=r,a.user=i,r.setViaHeader(a.id,n),r.transaction=a,a}return i(t,e),t.makeId=function(e){if("CANCEL"===e.method){if(!e.branch)throw new Error("Outgoing CANCEL request without a branch.");return e.branch}return"z9hG4bK"+Math.floor(1e7*Math.random())},Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),t.prototype.onRequestTimeout=function(){this.user.onRequestTimeout&&this.user.onRequestTimeout()},t}(h);t.ClientTransaction=d;var p=function(e){function t(t,r,n){var i=e.call(this,t,r,n,o.Calling,"sip.transaction.ict")||this;return i.ackRetransmissionCache=new Map,i.B=setTimeout(function(){return i.timer_B()},u.Timers.TIMER_B),i.send(t.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")}),i}return i(t,e),t.prototype.dispose=function(){this.B&&(clearTimeout(this.B),this.B=void 0),this.D&&(clearTimeout(this.D),this.D=void 0),this.M&&(clearTimeout(this.M),this.M=void 0),e.prototype.dispose.call(this)},t.prototype.ackResponse=function(e){var t=this,r=e.toTag;if(!r)throw new Error("To tag undefined.");var n="z9hG4bK"+Math.floor(1e7*Math.random());e.setViaHeader(n,this.transport),this.ackRetransmissionCache.set(r,e),this.send(e.toString()).catch(function(e){t.logTransportError(e,"Failed to send ACK to 2xx response.")})},t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode;if(!r||r<100||r>699)throw new Error("Invalid status code "+r);switch(this.state){case o.Calling:if(r>=100&&r<=199)return this.stateTransition(o.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=200&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(o.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=300&&r<=699)return this.stateTransition(o.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case o.Proceeding:if(r>=100&&r<=199)return void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=200&&r<=299)return this.ackRetransmissionCache.set(e.toTag,void 0),this.stateTransition(o.Accepted),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(r>=300&&r<=699)return this.stateTransition(o.Completed),this.ack(e),void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case o.Accepted:if(r>=200&&r<=299){if(!this.ackRetransmissionCache.has(e.toTag))return this.ackRetransmissionCache.set(e.toTag,void 0),void(this.user.receiveResponse&&this.user.receiveResponse(e));var n=this.ackRetransmissionCache.get(e.toTag);return n?void this.send(n.toString()).catch(function(e){t.logTransportError(e,"Failed to send retransmission of ACK to 2xx response.")}):void 0}break;case o.Completed:if(r>=300&&r<=699)return void this.ack(e);break;case o.Terminated:break;default:throw new Error("Invalid state "+this.state)}var i="Received unexpected "+r+" response while in state "+this.state+".";this.logger.warn(i)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(o.Terminated,!0)},t.prototype.ack=function(e){var t=this,r=this.request.ruri,n=this.request.callId,i=this.request.cseq,o=this.request.getHeader("from"),s=e.getHeader("to"),a=this.request.getHeader("via"),c=this.request.getHeader("route");if(!o)throw new Error("From undefined.");if(!s)throw new Error("To undefined.");if(!a)throw new Error("Via undefined.");var u="ACK "+r+" SIP/2.0\r\n";c&&(u+="Route: "+c+"\r\n"),u+="Via: "+a+"\r\n",u+="To: "+s+"\r\n",u+="From: "+o+"\r\n",u+="Call-ID: "+n+"\r\n",u+="CSeq: "+i+" ACK\r\n",u+="Max-Forwards: 70\r\n",u+="Content-Length: 0\r\n\r\n",this.send(u).catch(function(e){t.logTransportError(e,"Failed to send ACK to non-2xx response.")})},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var n=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case o.Calling:n();break;case o.Proceeding:this.state!==o.Calling&&n();break;case o.Accepted:case o.Completed:this.state!==o.Calling&&this.state!==o.Proceeding&&n();break;case o.Terminated:this.state!==o.Calling&&this.state!==o.Accepted&&this.state!==o.Completed&&(t||n());break;default:n()}this.B&&(clearTimeout(this.B),this.B=void 0),o.Proceeding,e===o.Completed&&(this.D=setTimeout(function(){return r.timer_D()},u.Timers.TIMER_D)),e===o.Accepted&&(this.M=setTimeout(function(){return r.timer_M()},u.Timers.TIMER_M)),e===o.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_A=function(){},t.prototype.timer_B=function(){this.logger.debug("Timer B expired for INVITE client transaction "+this.id+"."),this.state===o.Calling&&(this.onRequestTimeout(),this.stateTransition(o.Terminated))},t.prototype.timer_D=function(){this.logger.debug("Timer D expired for INVITE client transaction "+this.id+"."),this.state===o.Completed&&this.stateTransition(o.Terminated)},t.prototype.timer_M=function(){this.logger.debug("Timer M expired for INVITE client transaction "+this.id+"."),this.state===o.Accepted&&this.stateTransition(o.Terminated)},t}(d);t.InviteClientTransaction=p;var l=function(e){function t(t,r,n){var i=e.call(this,t,r,n,o.Trying,"sip.transaction.nict")||this;return i.F=setTimeout(function(){return i.timer_F()},u.Timers.TIMER_F),i.send(t.toString()).catch(function(e){i.logTransportError(e,"Failed to send initial outgoing request.")}),i}return i(t,e),t.prototype.dispose=function(){this.F&&(clearTimeout(this.F),this.F=void 0),this.K&&(clearTimeout(this.K),this.K=void 0),e.prototype.dispose.call(this)},t.prototype.receiveResponse=function(e){var t=e.statusCode;if(!t||t<100||t>699)throw new Error("Invalid status code "+t);switch(this.state){case o.Trying:if(t>=100&&t<=199)return this.stateTransition(o.Proceeding),void(this.user.receiveResponse&&this.user.receiveResponse(e));if(t>=200&&t<=699)return this.stateTransition(o.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));break;case o.Proceeding:if(t>=100&&t<=199&&this.user.receiveResponse)return this.user.receiveResponse(e);if(t>=200&&t<=699)return this.stateTransition(o.Completed),408===t?void this.onRequestTimeout():void(this.user.receiveResponse&&this.user.receiveResponse(e));case o.Completed:case o.Terminated:return;default:throw new Error("Invalid state "+this.state)}var r="Non-INVITE client transaction received unexpected "+t+" response while in state "+this.state+".";this.logger.warn(r)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(o.Terminated,!0)},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var n=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case o.Trying:n();break;case o.Proceeding:this.state!==o.Trying&&n();break;case o.Completed:this.state!==o.Trying&&this.state!==o.Proceeding&&n();break;case o.Terminated:this.state!==o.Trying&&this.state!==o.Proceeding&&this.state!==o.Completed&&(t||n());break;default:n()}e===o.Completed&&(this.F&&(clearTimeout(this.F),this.F=void 0),this.K=setTimeout(function(){return r.timer_K()},u.Timers.TIMER_K)),e===o.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_F=function(){this.logger.debug("Timer F expired for non-INVITE client transaction "+this.id+"."),this.state!==o.Trying&&this.state!==o.Proceeding||(this.onRequestTimeout(),this.stateTransition(o.Terminated))},t.prototype.timer_K=function(){this.state===o.Completed&&this.stateTransition(o.Terminated)},t}(d);t.NonInviteClientTransaction=l;var f=function(e){function t(t,r,n,i,o){var s=e.call(this,r,n,t.viaBranch,i,o)||this;return s._request=t,s.user=n,t.transaction=s,s}return i(t,e),Object.defineProperty(t.prototype,"request",{get:function(){return this._request},enumerable:!0,configurable:!0}),t}(h);t.ServerTransaction=f;var g=function(e){function t(t,r,n){var i=e.call(this,t,r,n,o.Proceeding,"sip.transaction.ist")||this;return t.reply(100),i}return i(t,e),t.prototype.dispose=function(){this.stopProgressExtensionTimer(),this.H&&(clearTimeout(this.H),this.H=void 0),this.I&&(clearTimeout(this.I),this.I=void 0),this.L&&(clearTimeout(this.L),this.L=void 0),e.prototype.dispose.call(this)},t.prototype.receiveRequest=function(e){var t=this;switch(this.state){case o.Proceeding:if(e.method===a.C.INVITE)return void(this.lastProvisionalResponse&&this.send(this.lastProvisionalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")}));break;case o.Accepted:if(e.method===a.C.INVITE)return;break;case o.Completed:if(e.method===a.C.INVITE){if(!this.lastFinalResponse)throw new Error("Last final response undefined.");return void this.send(this.lastFinalResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")})}if(e.method===a.C.ACK)return void this.stateTransition(o.Confirmed);break;case o.Confirmed:case o.Terminated:if(e.method===a.C.INVITE||e.method===a.C.ACK)return;break;default:throw new Error("Invalid state "+this.state)}var r="INVITE server transaction received unexpected "+e.method+" request while in state "+this.state+".";this.logger.warn(r)},t.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699)throw new Error("Invalid status code "+e);switch(this.state){case o.Proceeding:if(e>=100&&e<=199)return this.lastProvisionalResponse=t,e>100&&this.startProgressExtensionTimer(),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 1xx response.")});if(e>=200&&e<=299)return this.lastFinalResponse=t,this.stateTransition(o.Accepted),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});if(e>=300&&e<=699)return this.lastFinalResponse=t,this.stateTransition(o.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send non-2xx final response.")});break;case o.Accepted:if(e>=200&&e<=299)return void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send 2xx response.")});break;case o.Completed:case o.Confirmed:case o.Terminated:break;default:throw new Error("Invalid state "+this.state)}var n="INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(n),new Error(n)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e)},t.prototype.stateTransition=function(e){var t=this,r=function(){throw new Error("Invalid state transition from "+t.state+" to "+e)};switch(e){case o.Proceeding:r();break;case o.Accepted:case o.Completed:this.state!==o.Proceeding&&r();break;case o.Confirmed:this.state!==o.Completed&&r();break;case o.Terminated:this.state!==o.Accepted&&this.state!==o.Completed&&this.state!==o.Confirmed&&r();break;default:r()}this.stopProgressExtensionTimer(),e===o.Accepted&&(this.L=setTimeout(function(){return t.timer_L()},u.Timers.TIMER_L)),e===o.Completed&&(this.H=setTimeout(function(){return t.timer_H()},u.Timers.TIMER_H)),e===o.Confirmed&&(this.I=setTimeout(function(){return t.timer_I()},u.Timers.TIMER_I)),e===o.Terminated&&this.dispose(),this.setState(e)},t.prototype.startProgressExtensionTimer=function(){var e=this;void 0===this.progressExtensionTimer&&(this.progressExtensionTimer=setInterval(function(){if(e.logger.debug("Progress extension timer expired for INVITE server transaction "+e.id+"."),!e.lastProvisionalResponse)throw new Error("Last provisional response undefined.");e.send(e.lastProvisionalResponse).catch(function(t){e.logTransportError(t,"Failed to send retransmission of provisional response.")})},u.Timers.PROVISIONAL_RESPONSE_INTERVAL))},t.prototype.stopProgressExtensionTimer=function(){void 0!==this.progressExtensionTimer&&(clearInterval(this.progressExtensionTimer),this.progressExtensionTimer=void 0)},t.prototype.timer_G=function(){},t.prototype.timer_H=function(){this.logger.debug("Timer H expired for INVITE server transaction "+this.id+"."),this.state===o.Completed&&(this.logger.warn("ACK to negative final response was never received, terminating transaction."),this.stateTransition(o.Terminated))},t.prototype.timer_I=function(){this.logger.debug("Timer I expired for INVITE server transaction "+this.id+"."),this.stateTransition(o.Terminated)},t.prototype.timer_L=function(){this.logger.debug("Timer L expired for INVITE server transaction "+this.id+"."),this.state===o.Accepted&&this.stateTransition(o.Terminated)},t}(f);t.InviteServerTransaction=g;var m=function(e){function t(t,r,n){return e.call(this,t,r,n,o.Trying,"sip.transaction.nist")||this}return i(t,e),t.prototype.dispose=function(){this.J&&(clearTimeout(this.J),this.J=void 0),e.prototype.dispose.call(this)},t.prototype.receiveRequest=function(e){var t=this;switch(this.state){case o.Trying:break;case o.Proceeding:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of provisional response.")});break;case o.Completed:if(!this.lastResponse)throw new Error("Last response undefined.");this.send(this.lastResponse).catch(function(e){t.logTransportError(e,"Failed to send retransmission of final response.")});break;case o.Terminated:break;default:throw new Error("Invalid state "+this.state)}},t.prototype.receiveResponse=function(e,t){var r=this;if(e<100||e>699)throw new Error("Invalid status code "+e);if(e>100&&e<=199)throw new Error("Provisional response other than 100 not allowed.");switch(this.state){case o.Trying:if(this.lastResponse=t,e>=100&&e<200)return this.stateTransition(o.Proceeding),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send provisional response.")});if(e>=200&&e<=699)return this.stateTransition(o.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case o.Proceeding:if(this.lastResponse=t,e>=200&&e<=699)return this.stateTransition(o.Completed),void this.send(t).catch(function(e){r.logTransportError(e,"Failed to send final response.")});break;case o.Completed:return;case o.Terminated:break;default:throw new Error("Invalid state "+this.state)}var n="Non-INVITE server transaction received unexpected "+e+" response from TU while in state "+this.state+".";throw this.logger.error(n),new Error(n)},t.prototype.onTransportError=function(e){this.user.onTransportError&&this.user.onTransportError(e),this.stateTransition(o.Terminated,!0)},t.prototype.stateTransition=function(e,t){var r=this;void 0===t&&(t=!1);var n=function(){throw new Error("Invalid state transition from "+r.state+" to "+e)};switch(e){case o.Trying:n();break;case o.Proceeding:this.state!==o.Trying&&n();break;case o.Completed:this.state!==o.Trying&&this.state!==o.Proceeding&&n();break;case o.Terminated:this.state!==o.Proceeding&&this.state!==o.Completed&&(t||n());break;default:n()}e===o.Completed&&(this.J=setTimeout(function(){return r.timer_J()},u.Timers.TIMER_J)),e===o.Terminated&&this.dispose(),this.setState(e)},t.prototype.timer_J=function(){this.logger.debug("Timer J expired for NON-INVITE server transaction "+this.id+"."),this.state===o.Completed&&this.stateTransition(o.Terminated)},t}(f);t.NonInviteServerTransaction=m},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(0),a=r(7),c=r(8),u=r(3);t.getSupportedHeader=function(e){var t=[];e.method===o.C.REGISTER?t.push("path","gruu"):e.method===o.C.INVITE&&(e.ua.contact.pubGruu||e.ua.contact.tempGruu)&&t.push("gruu"),e.ua.configuration.rel100===o.C.supported.SUPPORTED&&t.push("100rel"),e.ua.configuration.replaces===o.C.supported.SUPPORTED&&t.push("replaces"),t.push("outbound"),t=t.concat(e.ua.configuration.extraSupported||[]);var r=e.ua.configuration.hackAllowUnregisteredOptionTags||!1,n={};return"Supported: "+(t=t.filter(function(e){var t=o.C.OPTION_TAGS[e],i=!n[e];return n[e]=!0,(t||r)&&i})).join(", ")+"\r\n"};var h=function(){function e(e,t,r,n,i,o){void 0===n&&(n={}),this.type=s.TypeStrings.OutgoingRequest,this.logger=r.getLogger("sip.sipmessage"),this.ua=r,this.headers={},this.method=e,this.ruri=t,this.body=o,this.extraHeaders=(i||[]).slice(),this.statusCode=n.statusCode,this.reasonPhrase=n.reasonPhrase,n.routeSet?this.setHeader("route",n.routeSet):r.configuration.usePreloadedRoute&&r.transport&&this.setHeader("route",r.transport.server.sipUri),this.setHeader("via",""),this.setHeader("max-forwards","70");var c=n.toUri||t;this.toTag=n.toTag;var h=n.toDisplayName||0===n.toDisplayName?'"'+n.toDisplayName+'" ':"";h+="<"+(c.type===s.TypeStrings.URI?c.toRaw():c)+">",h+=this.toTag?";tag="+this.toTag:"",this.to=a.Grammar.nameAddrHeaderParse(h),this.setHeader("to",h);var d,p=n.fromUri||r.configuration.uri||"";this.fromTag=n.fromTag||u.Utils.newTag(),d=n.fromDisplayName||0===n.fromDisplayName?'"'+n.fromDisplayName+'" ':r.configuration.displayName?'"'+r.configuration.displayName+'" ':"",d+="<"+(p.type===s.TypeStrings.URI?p.toRaw():p)+">;tag=",d+=this.fromTag,this.from=a.Grammar.nameAddrHeaderParse(d),this.setHeader("from",d),this.callId=n.callId||r.configuration.sipjsId+u.Utils.createRandomToken(15),this.setHeader("call-id",this.callId),this.cseq=n.cseq||Math.floor(1e4*Math.random()),this.setHeader("cseq",this.cseq+" "+e)}return e.prototype.getHeader=function(e){var t=this.headers[u.Utils.headerize(e)];if(t){if(t[0])return t[0]}else for(var r=new RegExp("^\\s*"+e+"\\s*:","i"),n=0,i=this.extraHeaders;n<i.length;n++){var o=i[n];if(r.test(o))return o.substring(o.indexOf(":")+1).trim()}},e.prototype.getHeaders=function(e){var t=[],r=this.headers[u.Utils.headerize(e)];if(r)for(var n=0,i=r;n<i.length;n++){var o=i[n];t.push(o)}else for(var s=new RegExp("^\\s*"+e+"\\s*:","i"),a=0,c=this.extraHeaders;a<c.length;a++){var h=c[a];s.test(h)&&t.push(h.substring(h.indexOf(":")+1).trim())}return t},e.prototype.hasHeader=function(e){if(this.headers[u.Utils.headerize(e)])return!0;for(var t=new RegExp("^\\s*"+e+"\\s*:","i"),r=0,n=this.extraHeaders;r<n.length;r++){var i=n[r];if(t.test(i))return!0}return!1},e.prototype.setHeader=function(e,t){this.headers[u.Utils.headerize(e)]=t instanceof Array?t:[t]},e.prototype.setViaHeader=function(e,t){var r="WSS";t.server&&t.server.scheme&&(r=t.server.scheme),this.ua.configuration.hackViaTcp&&(r="TCP");var n="SIP/2.0/"+r;n+=" "+this.ua.configuration.viaHost+";branch="+e,this.ua.configuration.forceRport&&(n+=";rport"),this.setHeader("via",n),this.branch=e},e.prototype.cancel=function(t,r){var n=this;if(!this.transaction)throw new Error("Transaction undefined.");var i=function(){if(!n.transaction)throw new Error("Transaction undefined.");if(!n.to)throw new Error("To undefined.");if(!n.from)throw new Error("From undefined.");var i=new e(o.C.CANCEL,n.ruri,n.ua,{toUri:n.to.uri,toTag:n.toTag,fromUri:n.from.uri,fromTag:n.fromTag,callId:n.callId,cseq:n.cseq},r);i.branch=n.branch,n.headers.Route&&(i.headers.Route=n.headers.Route),t&&i.setHeader("Reason",t);var s=n.transaction.transport,a={loggerFactory:n.ua.getLoggerFactory(),onStateChange:function(e){e===c.TransactionState.Terminated&&n.ua.destroyTransaction(u)},receiveResponse:function(e){}},u=new c.NonInviteClientTransaction(i,s,a);n.ua.newTransaction(u)};this.transaction instanceof c.InviteClientTransaction&&(this.transaction.state===c.TransactionState.Proceeding?i():this.transaction.once("stateChanged",function(){n.transaction&&n.transaction.state===c.TransactionState.Proceeding&&i()}))},e.prototype.toString=function(){var e="";for(var r in e+=this.method+" "+(this.ruri.type===s.TypeStrings.URI?this.ruri.toRaw():this.ruri)+" SIP/2.0\r\n",this.headers)if(this.headers[r])for(var n=0,i=this.headers[r];n<i.length;n++){e+=r+": "+i[n]+"\r\n"}for(var o=0,a=this.extraHeaders;o<a.length;o++){e+=(r=a[o]).trim()+"\r\n"}return e+=t.getSupportedHeader(this),e+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",this.body?"string"==typeof this.body?(e+="Content-Length: "+u.Utils.str_utf8_length(this.body)+"\r\n\r\n",e+=this.body):this.body.body&&this.body.contentType?(e+="Content-Type: "+this.body.contentType+"\r\n",e+="Content-Length: "+u.Utils.str_utf8_length(this.body.body)+"\r\n\r\n",e+=this.body.body):e+="Content-Length: 0\r\n\r\n":e+="Content-Length: 0\r\n\r\n",e},e}();t.OutgoingRequest=h;var d=function(){function e(){this.type=s.TypeStrings.IncomingMessage,this.headers={}}return e.prototype.addHeader=function(e,t){var r={raw:t};e=u.Utils.headerize(e),this.headers[e]?this.headers[e].push(r):this.headers[e]=[r]},e.prototype.getHeader=function(e){var t=this.headers[u.Utils.headerize(e)];if(t)return t[0]?t[0].raw:void 0},e.prototype.getHeaders=function(e){var t=this.headers[u.Utils.headerize(e)],r=[];if(!t)return[];for(var n=0,i=t;n<i.length;n++){var o=i[n];r.push(o.raw)}return r},e.prototype.hasHeader=function(e){return!!this.headers[u.Utils.headerize(e)]},e.prototype.parseHeader=function(e,t){if(void 0===t&&(t=0),e=u.Utils.headerize(e),this.headers[e]&&!(t>=this.headers[e].length)){var r=this.headers[e][t],n=r.raw;if(r.parsed)return r.parsed;var i=a.Grammar.parse(n,e.replace(/-/g,"_"));return-1===i?void this.headers[e].splice(t,1):(r.parsed=i,i)}},e.prototype.s=function(e,t){return void 0===t&&(t=0),this.parseHeader(e,t)},e.prototype.setHeader=function(e,t){this.headers[u.Utils.headerize(e)]=[{raw:t}]},e.prototype.toString=function(){return this.data},e}();t.IncomingMessage=d;var p=function(e){function r(t){var r=e.call(this)||this;return r.ua=t,r.type=s.TypeStrings.IncomingRequest,r.logger=t.getLogger("sip.sipmessage"),r}return i(r,e),r.prototype.reply=function(e,r,n,i){if(!this.transaction)throw new Error("Transaction undefined.");var s=u.Utils.buildStatusLine(e,r);if(n=(n||[]).slice(),this.method===o.C.INVITE&&e>100&&e<=200)for(var a=0,c=this.getHeaders("record-route");a<c.length;a++){s+="Record-Route: "+c[a]+"\r\n"}for(var h=0,d=this.getHeaders("via");h<d.length;h++){s+="Via: "+d[h]+"\r\n"}var p=this.getHeader("to")||"";!this.toTag&&e>100?p+=";tag="+u.Utils.newTag():this.toTag&&!this.s("to").hasParam("tag")&&(p+=";tag="+this.toTag),s+="To: "+p+"\r\n",s+="From: "+this.getHeader("From")+"\r\n",s+="Call-ID: "+this.callId+"\r\n",s+="CSeq: "+this.cseq+" "+this.method+"\r\n";for(var l=0,f=n;l<f.length;l++){s+=f[l].trim()+"\r\n"}return s+=t.getSupportedHeader(this),s+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",i?"string"==typeof i?(s+="Content-Type: application/sdp\r\n",s+="Content-Length: "+u.Utils.str_utf8_length(i)+"\r\n\r\n",s+=i):i.body&&i.contentType?(s+="Content-Type: "+i.contentType+"\r\n",s+="Content-Length: "+u.Utils.str_utf8_length(i.body)+"\r\n\r\n",s+=i.body):s+="Content-Length: 0\r\n\r\n":s+="Content-Length: 0\r\n\r\n",this.transaction.receiveResponse(e,s),s},r.prototype.reply_sl=function(e,t){if(!this.transport)throw new Error("Transport undefined.");for(var r=u.Utils.buildStatusLine(e,t),n=0,i=this.getHeaders("via");n<i.length;n++){r+="Via: "+i[n]+"\r\n"}var o=this.getHeader("To")||"";return!this.toTag&&e>100?o+=";tag="+u.Utils.newTag():this.toTag&&!this.s("to").hasParam("tag")&&(o+=";tag="+this.toTag),r+="To: "+o+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.callId+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="User-Agent: "+this.ua.configuration.userAgentString+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r),r},r}(d);t.IncomingRequest=p;var l=function(e){function t(t){var r=e.call(this)||this;return r.ua=t,r.type=s.TypeStrings.IncomingResponse,r.logger=t.getLogger("sip.sipmessage"),r.headers={},r}return i(t,e),t.prototype.ack=function(e){if(!this.statusCode||this.statusCode<200||this.statusCode>299)throw new Error("Response status code must be 2xx to ACK.");if(this.method!==o.C.INVITE)throw new Error("Response must to be for an INVITE to ACK.");if(!this.transaction)throw new Error("Transaction undefined.");if(!(this.transaction instanceof c.InviteClientTransaction))throw new Error("Transaction not instance of InviteServerTrasaction.");var t=this.ua.dialogs[this.callId+this.fromTag+this.toTag];if(!t)throw new Error("Dialog undefined.");var r=this.callId,n=this.cseq,i=t.localUri,s=this.fromTag,a=t.remoteUri,u=this.toTag,d=t.remoteTarget,p=t.routeSet,l=new h(o.C.ACK,d,this.ua,{callId:r,cseq:n,fromUri:i,fromTag:s,toUri:a,toTag:u,routeSet:p},e?e.extraHeaders:void 0,e?e.body:void 0);return this.transaction.ackResponse(l),l},t}(d);t.IncomingResponse=l},function(e,t,r){e.exports=r(69)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),s=r(2),a=r(0),c=r(15),u=r(9),h=r(3),d=function(e){function t(r,n,i,o){var s=e.call(this)||this;return s.data={},t.initializer(s,r,n,i,o),s}return i(t,e),t.initializer=function(e,t,r,n,i){if(e.type=a.TypeStrings.ClientContext,void 0===n)throw new TypeError("Not enough arguments");e.ua=t,e.logger=t.getLogger("sip.clientcontext"),e.method=r;var o=t.normalizeTarget(n);if(!o)throw new TypeError("Invalid target: "+n);(i=Object.create(i||Object.prototype)).extraHeaders=(i.extraHeaders||[]).slice(),e.request=new u.OutgoingRequest(e.method,o,e.ua,i.params,i.extraHeaders),i.body&&(e.body={},e.body.body=i.body,i.contentType&&(e.body.contentType=i.contentType),e.request.body=e.body),e.request.from&&(e.localIdentity=e.request.from),e.request.to&&(e.remoteIdentity=e.request.to)},t.prototype.send=function(){return new c.RequestSender(this,this.ua).send(),this},t.prototype.receiveResponse=function(e){var t=e.statusCode||0,r=h.Utils.getReasonPhrase(t);switch(!0){case/^1[0-9]{2}$/.test(t.toString()):this.emit("progress",e,r);break;case/^2[0-9]{2}$/.test(t.toString()):this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("accepted",e,r);break;default:this.ua.applicants[this.toString()]&&delete this.ua.applicants[this.toString()],this.emit("rejected",e,r),this.emit("failed",e,r)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR)},t}(o.EventEmitter);t.ClientContext=d},function(e,t,r){(function(e){var n,i=r(102),o=r(55),s=r(103),a=r(104),c=r(105);e&&e.ArrayBuffer&&(n=r(106));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),h="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),d=u||h;t.protocol=3;var p=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},l=i(p),f={type:"error",data:"parser error"},g=r(107);function m(e,t,r){for(var n=new Array(e.length),i=a(e.length,r),o=function(e,r,i){t(r,function(t,r){n[e]=r,i(t,n)})},s=0;s<e.length;s++)o(s,e[s],i)}t.encodePacket=function(r,n,i,o){"function"==typeof n&&(o=n,n=!1),"function"==typeof i&&(o=i,i=null);var s=void 0===r.data?void 0:r.data.buffer||r.data;if(e.ArrayBuffer&&s instanceof ArrayBuffer)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=p[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return n(s.buffer)}(r,n,o);if(g&&s instanceof e.Blob)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(d)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,r,!0,n)},i.readAsArrayBuffer(e.data)}(e,r,n);var i=new Uint8Array(1);i[0]=p[e.type];var o=new g([i.buffer,e.data]);return n(o)}(r,n,o);if(s&&s.base64)return function(e,r){var n="b"+t.packets[e.type]+e.data.data;return r(n)}(r,o);var a=p[r.type];return void 0!==r.data&&(a+=i?c.encode(String(r.data)):String(r.data)),o(""+a)},t.encodeBase64Packet=function(r,n){var i,o="b"+t.packets[r.type];if(g&&r.data instanceof e.Blob){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];n(o+e)},s.readAsDataURL(r.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(r.data))}catch(e){for(var a=new Uint8Array(r.data),c=new Array(a.length),u=0;u<a.length;u++)c[u]=a[u];i=String.fromCharCode.apply(null,c)}return o+=e.btoa(i),n(o)},t.decodePacket=function(e,r,n){if(void 0===e)return f;if("string"==typeof e){if("b"==e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&!1===(e=function(e){try{e=c.decode(e)}catch(e){return!1}return e}(e)))return f;var i=e.charAt(0);return Number(i)==i&&l[i]?e.length>1?{type:l[i],data:e.substring(1)}:{type:l[i]}:f}i=new Uint8Array(e)[0];var o=s(e,1);return g&&"blob"===r&&(o=new g([o])),{type:l[i],data:o}},t.decodeBase64Packet=function(e,t){var r=l[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=n.decode(e.substr(1));return"blob"===t&&g&&(i=new g([i])),{type:r,data:i}},t.encodePayload=function(e,r,n){"function"==typeof r&&(n=r,r=null);var i=o(e);if(r&&i)return g&&!d?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");m(e,function(e,n){t.encodePacket(e,!!i&&r,!0,function(e){n(null,function(e){return e.length+":"+e}(e))})},function(e,t){return n(t.join(""))})},t.decodePayload=function(e,r,n){if("string"!=typeof e)return t.decodePayloadAsBinary(e,r,n);var i;if("function"==typeof r&&(n=r,r=null),""==e)return n(f,0,1);for(var o,s,a="",c=0,u=e.length;c<u;c++){var h=e.charAt(c);if(":"!=h)a+=h;else{if(""==a||a!=(o=Number(a)))return n(f,0,1);if(a!=(s=e.substr(c+1,o)).length)return n(f,0,1);if(s.length){if(i=t.decodePacket(s,r,!0),f.type==i.type&&f.data==i.data)return n(f,0,1);if(!1===n(i,c+o,u))return}c+=o,a=""}}return""!=a?n(f,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));m(e,function(e,r){t.encodePacket(e,!0,!0,function(e){return r(null,e)})},function(e,t){var n=t.reduce(function(e,t){var r;return e+(r="string"==typeof t?t.length:t.byteLength).toString().length+r+2},0),i=new Uint8Array(n),o=0;return t.forEach(function(e){var t="string"==typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);r=n.buffer}i[o++]=t?0:1;var a=r.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(n=new Uint8Array(r),s=0;s<n.length;s++)i[o++]=n[s]}),r(i.buffer)})},t.encodePayloadAsBlob=function(e,r){m(e,function(e,r){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,g){var a=new g([t.buffer,s.buffer,e]);r(null,a)}})},function(e,t){return r(new g(t))})},t.decodePayloadAsBinary=function(e,r,n){"function"==typeof r&&(n=r,r=null);for(var i=e,o=[],a=!1;i.byteLength>0;){for(var c=new Uint8Array(i),u=0===c[0],h="",d=1;255!=c[d];d++){if(h.length>310){a=!0;break}h+=c[d]}if(a)return n(f,0,1);i=s(i,2+h.length),h=parseInt(h);var p=s(i,0,h);if(u)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var l=new Uint8Array(p);p="";for(d=0;d<l.length;d++)p+=String.fromCharCode(l[d])}o.push(p),i=s(i,h)}var g=o.length;o.forEach(function(e,i){n(t.decodePacket(e,r,!0),i,g)})}}).call(this,r(1))},function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),s=r(11),a=r(2),c=r(21),u=r(0),h=r(6),d=r(7),p=r(15),l=r(22),f=r(65),g=r(9),m=r(16),v=r(8),y=r(3),T=function(e){function t(r){var n=e.call(this)||this;if(n.data={},n.type=u.TypeStrings.Session,!r)throw new h.Exceptions.SessionDescriptionHandlerError("A session description handler is required for the session to function");return n.status=t.C.STATUS_NULL,n.dialog=void 0,n.pendingReinvite=!1,n.earlyDialogs={},n.sessionDescriptionHandlerFactory=r,n.hasOffer=!1,n.hasAnswer=!1,n.timers={ackTimer:void 0,expiresTimer:void 0,invite2xxTimer:void 0,userNoAnswerTimer:void 0,rel1xxTimer:void 0,prackTimer:void 0},n.startTime=void 0,n.endTime=void 0,n.tones=void 0,n.localHold=!1,n.earlySdp=void 0,n.rel100=a.C.supported.UNSUPPORTED,n.originalReceiveRequest=n.receiveRequest,n}return i(t,e),t.prototype.dtmf=function(e,t){var r=this;if(void 0===t&&(t={}),this.status!==u.SessionStatus.STATUS_CONFIRMED&&this.status!==u.SessionStatus.STATUS_WAITING_FOR_ACK)throw new h.Exceptions.InvalidStateError(this.status);if(!e||!e.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+e);var n=function(){if(r.status!==u.SessionStatus.STATUS_TERMINATED&&r.tones&&0!==r.tones.length){var e,i=r.tones.shift();","===i.tone?e=2e3:(i.on("failed",function(){r.tones=void 0}),i.send(t),e=i.duration+i.interToneGap),setTimeout(n,e)}else r.tones=void 0};e=e.toString();var i=this.ua.configuration.dtmfType;this.sessionDescriptionHandler&&i===a.C.dtmfType.RTP&&(this.sessionDescriptionHandler.sendDtmf(e,t)||(this.logger.warn("Attempt to use dtmfType 'RTP' has failed, falling back to INFO packet method"),i=a.C.dtmfType.INFO));if(i===a.C.dtmfType.INFO){for(var o=[],s=e.split("");s.length>0;)o.push(new f.DTMF(this,s.shift(),t));if(this.tones)return this.tones=this.tones.concat(o),this;this.tones=o,n()}return this},t.prototype.bye=function(e){if(void 0===e&&(e={}),this.status===u.SessionStatus.STATUS_TERMINATED)return this.logger.error("Error: Attempted to send BYE in a terminated session."),this;this.logger.log("terminating Session");var t=e.statusCode;if(t&&(t<200||t>=700))throw new TypeError("Invalid statusCode: "+t);return e.receiveResponse=function(){},this.sendRequest(a.C.BYE,e).terminated()},t.prototype.refer=function(e,t){if(void 0===t&&(t={}),this.status!==u.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);return this.referContext=new A(this.ua,this,e,t),this.emit("referRequested",this.referContext),this.referContext.refer(t),this.referContext},t.prototype.sendRequest=function(e,t){var r=this;if(void 0===t&&(t={}),t=t||{},!this.dialog)throw new Error("sending request without a dialog");var n=new g.OutgoingRequest(e,this.dialog.remoteTarget,this.ua,{cseq:t.cseq||(this.dialog.localSeqnum+=1),callId:this.dialog.id.callId,fromUri:this.dialog.localUri,fromTag:this.dialog.id.localTag,ToUri:this.dialog.remoteUri,toTag:this.dialog.id.remoteTag,routeSet:this.dialog.routeSet,statusCode:t.statusCode,reasonPhrase:t.reasonPhrase},t.extraHeaders||[],t.body);return new p.RequestSender({request:n,onRequestTimeout:function(){return r.onRequestTimeout()},onTransportError:function(){return r.onTransportError()},receiveResponse:function(e){return(t.receiveResponse||r.receiveNonInviteResponse.bind(r))(e)}},this.ua).send(),this.emit(e.toLowerCase(),n),this},t.prototype.close=function(){if(this.status===u.SessionStatus.STATUS_TERMINATED)return this;for(var e in this.logger.log("closing INVITE session "+this.id),this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.timers)this.timers[e]&&clearTimeout(this.timers[e]);for(var t in this.dialog&&(this.dialog.terminate(),delete this.dialog),this.earlyDialogs)this.earlyDialogs.hasOwnProperty(t)&&(this.earlyDialogs[t].terminate(),delete this.earlyDialogs[t]);return this.status=u.SessionStatus.STATUS_TERMINATED,this.ua.transport&&this.ua.transport.removeListener("transportError",this.errorListener),delete this.ua.sessions[this.id],this},t.prototype.createDialog=function(e,t,r){void 0===r&&(r=!1);var n,i=e["UAS"===t?"toTag":"fromTag"],o=e["UAS"===t?"fromTag":"toTag"],s=e.callId+i+o;if(r)return!!this.earlyDialogs[s]||((n=new c.Dialog(this,e,t,c.Dialog.C.STATUS_EARLY)).error?(this.logger.error(n.error),this.failed(e,a.C.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[s]=n,!0));if(n=this.earlyDialogs[s]){for(var u in n.update(e,t),this.dialog=n,delete this.earlyDialogs[s],this.earlyDialogs)this.earlyDialogs.hasOwnProperty(u)&&(this.earlyDialogs[u].terminate(),delete this.earlyDialogs[u]);return!0}var h=new c.Dialog(this,e,t);return h.error?(this.logger.error(h.error),this.failed(e,a.C.causes.INTERNAL_ERROR),!1):(this.toTag=e.toTag,this.dialog=h,!0)},t.prototype.hold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==u.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==u.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);this.localHold?this.logger.log("Session is already on hold, cannot put it on hold again"):(e.modifiers=t,this.sessionDescriptionHandler&&e.modifiers.push(this.sessionDescriptionHandler.holdModifier),this.localHold=!0,this.sendReinvite(e))},t.prototype.unhold=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=[]),this.status!==u.SessionStatus.STATUS_WAITING_FOR_ACK&&this.status!==u.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);this.localHold?(e.modifiers=t,this.localHold=!1,this.sendReinvite(e)):this.logger.log("Session is not on hold, cannot unhold it")},t.prototype.reinvite=function(e,t){return void 0===e&&(e={}),void 0===t&&(t=[]),e.modifiers=t,this.sendReinvite(e)},t.prototype.receiveRequest=function(e){switch(e.method){case a.C.BYE:e.reply(200),this.status===u.SessionStatus.STATUS_CONFIRMED&&(this.emit("bye",e),this.terminated(e,a.C.BYE));break;case a.C.INVITE:this.status===u.SessionStatus.STATUS_CONFIRMED&&(this.logger.log("re-INVITE received"),this.receiveReinvite(e));break;case a.C.INFO:if(this.status===u.SessionStatus.STATUS_CONFIRMED||this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK){if(this.onInfo)return this.onInfo(e);var t=e.getHeader("content-type");if(t)if(t.match(/^application\/dtmf-relay/i)){if(e.body){var r=e.body.split("\r\n",2);if(2===r.length){var n=void 0,i=void 0,o=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/;o.test(r[0])&&(n=r[0].replace(o,"$2"));var s=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;s.test(r[1])&&(i=parseInt(r[1].replace(s,"$2"),10)),n&&i&&new f.DTMF(this,n,{duration:i}).init_incoming(e)}}}else e.reply(415,void 0,["Accept: application/dtmf-relay"])}break;case a.C.REFER:if(this.status===u.SessionStatus.STATUS_CONFIRMED)if(this.logger.log("REFER received"),this.referContext=new b(this.ua,e),this.listeners("referRequested").length)this.emit("referRequested",this.referContext);else{this.logger.log("No referRequested listeners, automatically accepting and following the refer");var c={followRefer:!0};this.passedOptions&&(c.inviteOptions=this.passedOptions),this.referContext.accept(c,this.modifiers)}break;case a.C.NOTIFY:if(this.referContext&&this.referContext.type===u.TypeStrings.ReferClientContext&&e.hasHeader("event")&&/^refer(;.*)?$/.test(e.getHeader("event")))return void this.referContext.receiveNotify(e);e.reply(200,"OK"),this.emit("notify",e)}},t.prototype.terminate=function(e){return this},t.prototype.onTransportError=function(){this.status!==u.SessionStatus.STATUS_CONFIRMED&&this.status!==u.SessionStatus.STATUS_TERMINATED&&this.failed(void 0,a.C.causes.CONNECTION_ERROR)},t.prototype.onRequestTimeout=function(){this.status===u.SessionStatus.STATUS_CONFIRMED?this.terminated(void 0,a.C.causes.REQUEST_TIMEOUT):this.status!==u.SessionStatus.STATUS_TERMINATED&&(this.failed(void 0,a.C.causes.REQUEST_TIMEOUT),this.terminated(void 0,a.C.causes.REQUEST_TIMEOUT))},t.prototype.onDialogError=function(e){this.status===u.SessionStatus.STATUS_CONFIRMED?this.terminated(e,a.C.causes.DIALOG_ERROR):this.status!==u.SessionStatus.STATUS_TERMINATED&&(this.failed(e,a.C.causes.DIALOG_ERROR),this.terminated(e,a.C.causes.DIALOG_ERROR))},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.receiveReinvite=function(e){var t,r=this;if(this.emit("reinvite",this,e),e.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=d.Grammar.nameAddrHeaderParse(e.getHeader("P-Asserted-Identity"))),this.sessionDescriptionHandler){if("0"!==e.getHeader("Content-Length")||e.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||""))return e.reply(415),void this.emit("reinviteFailed",this);t=this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(this.sessionDescriptionHandler.getDescription.bind(this.sessionDescriptionHandler,this.sessionDescriptionHandlerOptions,this.modifiers))}else t=this.sessionDescriptionHandler.getDescription(this.sessionDescriptionHandlerOptions,this.modifiers);this.receiveRequest=function(e){e.method===a.C.ACK&&r.status===u.SessionStatus.STATUS_WAITING_FOR_ACK?r.sessionDescriptionHandler&&r.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")?(r.hasAnswer=!0,r.sessionDescriptionHandler.setDescription(e.body,r.sessionDescriptionHandlerOptions,r.modifiers).then(function(){clearTimeout(r.timers.ackTimer),clearTimeout(r.timers.invite2xxTimer),r.status=u.SessionStatus.STATUS_CONFIRMED,r.emit("confirmed",e)})):(clearTimeout(r.timers.ackTimer),clearTimeout(r.timers.invite2xxTimer),r.status=u.SessionStatus.STATUS_CONFIRMED,r.emit("confirmed",e)):r.originalReceiveRequest(e)},t.catch(function(t){var n;throw t.type===u.TypeStrings.SessionDescriptionHandlerError?n=500:t.type===u.TypeStrings.RenegotiationError?(r.emit("renegotiationError",t),r.logger.warn(t.toString()),n=488):(r.logger.error(t),n=488),e.reply(n),r.emit("reinviteFailed",r),t}).then(function(t){var n=["Contact: "+r.contact];e.reply(200,void 0,n,t),r.status=u.SessionStatus.STATUS_WAITING_FOR_ACK,r.setACKTimer(),r.emit("reinviteAccepted",r)})}else this.logger.warn("No SessionDescriptionHandler to reinvite")},t.prototype.sendReinvite=function(e){var t=this;if(void 0===e&&(e={}),this.pendingReinvite)this.logger.warn("Reinvite in progress. Please wait until complete, then try again.");else if(this.sessionDescriptionHandler){this.pendingReinvite=!0,e.modifiers=e.modifiers||[];var r=(e.extraHeaders||[]).slice();r.push("Contact: "+this.contact),r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(e){t.sendRequest(a.C.INVITE,{extraHeaders:r,body:e,receiveResponse:function(e){return t.receiveReinviteResponse(e)}})}).catch(function(e){if(e.type===u.TypeStrings.RenegotiationError)throw t.pendingReinvite=!1,t.emit("renegotiationError",e),t.logger.warn("Renegotiation Error"),t.logger.warn(e.toString()),e;throw t.logger.error("sessionDescriptionHandler error"),t.logger.error(e),e})}else this.logger.warn("No SessionDescriptionHandler, can't reinvite..")},t.prototype.receiveReinviteResponse=function(e){var t=this;if(this.status!==u.SessionStatus.STATUS_TERMINATED)if(this.pendingReinvite){var r=e&&e.statusCode?e.statusCode.toString():"";switch(!0){case/^1[0-9]{2}$/.test(r):break;case/^2[0-9]{2}$/.test(r):if(this.status=u.SessionStatus.STATUS_CONFIRMED,this.emit("ack",e.ack()),this.pendingReinvite=!1,clearTimeout(this.timers.invite2xxTimer),!this.sessionDescriptionHandler||!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){this.logger.error("2XX response received to re-invite but did not have a description"),this.emit("reinviteFailed",this),this.emit("renegotiationError",new h.Exceptions.RenegotiationError("2XX response received to re-invite but did not have a description"));break}this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(e){throw t.logger.error("Could not set the description in 2XX response"),t.logger.error(e),t.emit("reinviteFailed",t),t.emit("renegotiationError",e),t.sendRequest(a.C.BYE,{extraHeaders:["Reason: "+y.Utils.getReasonHeaderValue(488,"Not Acceptable Here")]}),t.terminated(void 0,a.C.causes.INCOMPATIBLE_SDP),e}).then(function(){t.emit("reinviteAccepted",t)});break;default:this.pendingReinvite=!1,this.logger.log("Received a non 1XX or 2XX response to a re-invite"),this.emit("reinviteFailed",this),this.emit("renegotiationError",new h.Exceptions.RenegotiationError("Invalid response to a re-invite"))}}else this.logger.error("Received reinvite response, but have no pending reinvite");else this.logger.error("Received reinvite response, but in STATUS_TERMINATED")},t.prototype.acceptAndTerminate=function(e,t,r){var n=[];return t&&n.push("Reason: "+y.Utils.getReasonHeaderValue(t,r)),(this.dialog||this.createDialog(e,"UAC"))&&(this.emit("ack",e.ack()),this.sendRequest(a.C.BYE,{extraHeaders:n})),this},t.prototype.setInvite2xxTimer=function(e,t){var r=this,n=m.Timers.T1,i=function(){if(r.status===u.SessionStatus.STATUS_WAITING_FOR_ACK){r.logger.log("no ACK received, attempting to retransmit OK");var o=["Contact: "+r.contact];e.reply(200,void 0,o,t),n=Math.min(2*n,m.Timers.T2),r.timers.invite2xxTimer=setTimeout(i,n)}};this.timers.invite2xxTimer=setTimeout(i,n)},t.prototype.setACKTimer=function(){var e=this;this.timers.ackTimer=setTimeout(function(){e.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&(e.logger.log("no ACK received for an extended period of time, terminating the call"),clearTimeout(e.timers.invite2xxTimer),e.sendRequest(a.C.BYE),e.terminated(void 0,a.C.causes.NO_ACK))},m.Timers.TIMER_H)},t.prototype.failed=function(e,t){return this.status===u.SessionStatus.STATUS_TERMINATED?this:(this.emit("failed",e,t),this)},t.prototype.rejected=function(e,t){return this.emit("rejected",e,t),this},t.prototype.canceled=function(){return this.sessionDescriptionHandler&&this.sessionDescriptionHandler.close(),this.emit("cancel"),this},t.prototype.accepted=function(e,t){return e instanceof String||(t=y.Utils.getReasonPhrase(e&&e.statusCode||0,t)),this.startTime=new Date,this.replacee&&(this.replacee.emit("replaced",this),this.replacee.terminate()),this.emit("accepted",e,t),this},t.prototype.terminated=function(e,t){return this.status===u.SessionStatus.STATUS_TERMINATED?this:(this.endTime=new Date,this.close(),this.emit("terminated",e,t),this)},t.prototype.connecting=function(e){return this.emit("connecting",{request:e}),this},t.prototype.receiveNonInviteResponse=function(e){},t.C=u.SessionStatus,t}(o.EventEmitter);t.Session=T;var C=function(e){function t(t,r){var n=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ISC Constructor Failed");n=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this,l.ServerContext.initializer(n,t,r),n.type=u.TypeStrings.InviteServerContext;var i=r.parseHeader("Content-Disposition");i&&"render"===i.type&&(n.renderbody=r.body,n.rendertype=r.getHeader("Content-Type")),n.status=u.SessionStatus.STATUS_INVITE_RECEIVED,n.fromTag=r.fromTag,n.id=r.callId+n.fromTag,n.request=r,n.contact=n.ua.contact.toString(),n.receiveNonInviteResponse=function(){},n.logger=t.getLogger("sip.inviteservercontext",n.id),n.ua.sessions[n.id]=n;var o=function(e,t){r.hasHeader(e)&&r.getHeader(e).toLowerCase().indexOf("100rel")>=0&&(n.rel100=t)};if(o("require",a.C.supported.REQUIRED),o("supported",a.C.supported.SUPPORTED),r.toTag=y.Utils.newTag(),n.createDialog(r,"UAS",!0)){var s={extraHeaders:["Contact: "+n.contact]};if(n.rel100!==a.C.supported.REQUIRED&&n.progress(s),n.status=u.SessionStatus.STATUS_WAITING_FOR_ANSWER,n.timers.userNoAnswerTimer=setTimeout(function(){r.reply(408),n.failed(r,a.C.causes.NO_ANSWER),n.terminated(r,a.C.causes.NO_ANSWER)},n.ua.configuration.noAnswerTimeout||60),r.hasHeader("expires")){var c=1e3*Number(r.getHeader("expires")||0);n.timers.expiresTimer=setTimeout(function(){n.status===u.SessionStatus.STATUS_WAITING_FOR_ANSWER&&(r.reply(487),n.failed(r,a.C.causes.EXPIRES),n.terminated(r,a.C.causes.EXPIRES))},c)}return n.errorListener=n.onTransportError.bind(n),t.transport&&t.transport.on("transportError",n.errorListener),n}r.reply(500,"Missing Contact header field")}return i(t,e),t.prototype.reject=function(e){var t=this;if(void 0===e&&(e={}),this.status===u.SessionStatus.STATUS_TERMINATED)throw new h.Exceptions.InvalidStateError(this.status);this.logger.log("rejecting RTCSession");var r=e.statusCode||480,n=y.Utils.getReasonPhrase(r,e.reasonPhrase),i=e.extraHeaders||[];if(r<300||r>699)throw new TypeError("Invalid statusCode: "+r);var o=this.request.reply(r,n,i,e.body);return["rejected","failed"].forEach(function(e){t.emit(e,o,n)}),this.terminated()},t.prototype.reply=function(e){return void 0===e&&(e={}),this},t.prototype.terminate=function(e){var t=this;void 0===e&&(e={});var r=(e.extraHeaders||[]).slice();if(this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&this.request.transaction&&this.request.transaction.state!==v.TransactionState.Terminated){var n=this.dialog;this.receiveRequest=function(e){e.method===a.C.ACK&&(t.sendRequest(a.C.BYE,{extraHeaders:r}),t.dialog&&t.dialog.terminate())},this.request.transaction.on("stateChanged",function(){t.request.transaction&&t.request.transaction.state===v.TransactionState.Terminated&&t.dialog&&(t.bye(),t.dialog.terminate())}),this.emit("bye",this.request),this.terminated(),this.dialog=n,this.dialog&&(this.ua.dialogs[this.dialog.id.toString()]=this.dialog)}else this.status===u.SessionStatus.STATUS_CONFIRMED?this.bye(e):this.reject(e);return this},t.prototype.progress=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||180,n=(e.extraHeaders||[]).slice();if(r<100||r>199)throw new TypeError("Invalid statusCode: "+r);if(this.status===u.SessionStatus.STATUS_TERMINATED)return this;var i,o=function(){var r=e.statusCode||183;t.status=u.SessionStatus.STATUS_WAITING_FOR_PRACK,n.push("Contact: "+t.contact),n.push("Require: 100rel"),n.push("RSeq: "+Math.floor(1e4*Math.random())),t.sessionDescriptionHandler?t.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(i){if(t.status!==u.SessionStatus.STATUS_TERMINATED){t.earlySdp=i.body,t[t.hasOffer?"hasAnswer":"hasOffer"]=!0;var o=m.Timers.T1,s=function(){t.request.reply(r,void 0,n,i),o*=2,t.timers.rel1xxTimer=setTimeout(s,o)};t.timers.rel1xxTimer=setTimeout(s,o),t.timers.prackTimer=setTimeout(function(){t.status===u.SessionStatus.STATUS_WAITING_FOR_PRACK&&(t.logger.log("no PRACK received, rejecting the call"),clearTimeout(t.timers.rel1xxTimer),t.request.reply(504),t.terminated(void 0,a.C.causes.NO_PRACK))},64*m.Timers.T1);var c=t.request.reply(r,e.reasonPhrase,n,i);t.emit("progress",c,e.reasonPhrase)}},function(){t.request.reply(480),t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR)}):t.logger.warn("No SessionDescriptionHandler, can't do 100rel")};return 100!==e.statusCode&&(this.rel100===a.C.supported.REQUIRED||this.rel100===a.C.supported.SUPPORTED&&e.rel100||this.rel100===a.C.supported.SUPPORTED&&this.ua.configuration.rel100===a.C.supported.REQUIRED)?(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")||"")?(this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,e.sessionDescriptionHandlerOptions,e.modifiers).then(o).catch(function(e){throw t.logger.warn("invalid description"),t.logger.warn(e),t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR),e})):o()):(i=t.request.reply(r,e.reasonPhrase,n,e.body),t.emit("progress",i,e.reasonPhrase)),this},t.prototype.accept=function(e){var t=this;void 0===e&&(e={}),this.onInfo=e.onInfo;var r=(e.extraHeaders||[]).slice(),n=function(e){r.push("Contact: "+t.contact),r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.hasOffer?t.hasAnswer=!0:t.hasOffer=!0;var n=t.request.reply(200,void 0,r,e);t.status=u.SessionStatus.STATUS_WAITING_FOR_ACK,t.setInvite2xxTimer(t.request,e),t.setACKTimer(),t.accepted(n,y.Utils.getReasonPhrase(200))},i=function(e){throw e.type===u.TypeStrings.SessionDescriptionHandlerError&&(t.logger.log(e.message),e.error&&t.logger.log(e.error)),t.request.reply(480),t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR),e};if(this.status===u.SessionStatus.STATUS_WAITING_FOR_PRACK)return this.status=u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK,this;if(this.status===u.SessionStatus.STATUS_WAITING_FOR_ANSWER)this.status=u.SessionStatus.STATUS_ANSWERED;else if(this.status!==u.SessionStatus.STATUS_EARLY_MEDIA)throw new h.Exceptions.InvalidStateError(this.status);if(!this.createDialog(this.request,"UAS"))return this.request.reply(500,"Missing Contact header field"),this;if(clearTimeout(this.timers.userNoAnswerTimer),this.status===u.SessionStatus.STATUS_EARLY_MEDIA)n({});else if(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),"0"!==this.request.getHeader("Content-Length")||this.request.getHeader("Content-Type")){if(!this.sessionDescriptionHandler.hasDescription(this.request.getHeader("Content-Type")||""))return this.request.reply(415),this;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(this.request.body,e.sessionDescriptionHandlerOptions,e.modifiers).then(function(){if(!t.sessionDescriptionHandler)throw new Error("No SDH");return t.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers)}).catch(i).then(n)}else this.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).catch(i).then(n);return this},t.prototype.receiveRequest=function(e){var t=this,r=function(){clearTimeout(t.timers.ackTimer),clearTimeout(t.timers.invite2xxTimer),t.status=u.SessionStatus.STATUS_CONFIRMED;var r=e.getHeader("Content-Disposition");r&&"render"===r.type&&(t.renderbody=e.body,t.rendertype=e.getHeader("Content-Type")),t.emit("confirmed",e)};switch(e.method){case a.C.CANCEL:this.status!==u.SessionStatus.STATUS_WAITING_FOR_ANSWER&&this.status!==u.SessionStatus.STATUS_WAITING_FOR_PRACK&&this.status!==u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&this.status!==u.SessionStatus.STATUS_EARLY_MEDIA&&this.status!==u.SessionStatus.STATUS_ANSWERED||(this.status=u.SessionStatus.STATUS_CANCELED,this.request.reply(487),this.canceled(),this.rejected(e,a.C.causes.CANCELED),this.failed(e,a.C.causes.CANCELED),this.terminated(e,a.C.causes.CANCELED));break;case a.C.ACK:this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&(this.status=u.SessionStatus.STATUS_CONFIRMED,this.sessionDescriptionHandler&&this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).catch(function(r){throw t.logger.warn(r),t.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION),t.terminated(e,a.C.causes.BAD_MEDIA_DESCRIPTION),r}).then(function(){return r()})):r());break;case a.C.PRACK:this.status===u.SessionStatus.STATUS_WAITING_FOR_PRACK||this.status===u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK?this.hasAnswer?(clearTimeout(this.timers.rel1xxTimer),clearTimeout(this.timers.prackTimer),e.reply(200),this.status===u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(this.status=u.SessionStatus.STATUS_EARLY_MEDIA,this.accept()),this.status=u.SessionStatus.STATUS_EARLY_MEDIA):(this.sessionDescriptionHandler=this.setupSessionDescriptionHandler(),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")?(this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){clearTimeout(t.timers.rel1xxTimer),clearTimeout(t.timers.prackTimer),e.reply(200),t.status===u.SessionStatus.STATUS_ANSWERED_WAITING_FOR_PRACK&&(t.status=u.SessionStatus.STATUS_EARLY_MEDIA,t.accept()),t.status=u.SessionStatus.STATUS_EARLY_MEDIA},function(r){t.logger.warn(r),t.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION),t.terminated(e,a.C.causes.BAD_MEDIA_DESCRIPTION)})):(this.terminate({statusCode:"488",reasonPhrase:"Bad Media Description"}),this.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION),this.terminated(e,a.C.causes.BAD_MEDIA_DESCRIPTION))):this.status===u.SessionStatus.STATUS_EARLY_MEDIA&&e.reply(200);break;default:T.prototype.receiveRequest.apply(this,[e])}},t.prototype.setupSessionDescriptionHandler=function(){return this.sessionDescriptionHandler?this.sessionDescriptionHandler:this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions)},t}(T);t.InviteServerContext=C;var S=function(e){function t(t,r,n,i){void 0===n&&(n={}),void 0===i&&(i=[]);var o=this;if(!t.configuration.sessionDescriptionHandlerFactory)throw t.logger.warn("Can't build ISC without SDH Factory"),new Error("ICC Constructor Failed");n.params=n.params||{};var c=n.anonymous||!1,d=y.Utils.newTag();n.params.fromTag=d;var p=t.contact.toString({anonymous:c,outbound:c?!t.contact.tempGruu:!t.contact.pubGruu}),l=(n.extraHeaders||[]).slice();if(c&&t.configuration.uri&&(n.params.from_displayName="Anonymous",n.params.from_uri="sip:anonymous@anonymous.invalid",l.push("P-Preferred-Identity: "+t.configuration.uri.toString()),l.push("Privacy: id")),l.push("Contact: "+p),l.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),t.configuration.rel100===a.C.supported.REQUIRED&&l.push("Require: 100rel"),t.configuration.replaces===a.C.supported.REQUIRED&&l.push("Require: replaces"),n.extraHeaders=l,o=e.call(this,t.configuration.sessionDescriptionHandlerFactory)||this,s.ClientContext.initializer(o,t,a.C.INVITE,r,n),o.type=u.TypeStrings.InviteClientContext,o.passedOptions=n,o.sessionDescriptionHandlerOptions=n.sessionDescriptionHandlerOptions||{},o.modifiers=i,o.inviteWithoutSdp=n.inviteWithoutSdp||!1,o.anonymous=n.anonymous||!1,o.renderbody=n.renderbody||void 0,o.rendertype=n.rendertype||"text/plain",o.fromTag=d,o.contact=p,o.status!==u.SessionStatus.STATUS_NULL)throw new h.Exceptions.InvalidStateError(o.status);return o.isCanceled=!1,o.received100=!1,o.method=a.C.INVITE,o.logger=t.getLogger("sip.inviteclientcontext"),t.applicants[o.toString()]=o,o.id=o.request.callId+o.fromTag,o.onInfo=n.onInfo,o.errorListener=o.onTransportError.bind(o),t.transport&&t.transport.on("transportError",o.errorListener),o}return i(t,e),t.prototype.receiveNonInviteResponse=function(e){this.receiveInviteResponse(e)},t.prototype.receiveResponse=function(e){this.receiveInviteResponse(e)},t.prototype.send=function(){return new p.RequestSender(this,this.ua).send(),this},t.prototype.invite=function(){var e=this;return this.ua.sessions[this.id]=this,Promise.resolve().then(function(){e.inviteWithoutSdp?(e.request.body=e.renderbody,e.status=u.SessionStatus.STATUS_INVITE_SENT,e.send()):(e.sessionDescriptionHandler=e.sessionDescriptionHandlerFactory(e,e.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),e.emit("SessionDescriptionHandler-created",e.sessionDescriptionHandler),e.sessionDescriptionHandler.getDescription(e.sessionDescriptionHandlerOptions,e.modifiers).then(function(t){e.isCanceled||e.status===u.SessionStatus.STATUS_TERMINATED||(e.hasOffer=!0,e.request.body=t,e.status=u.SessionStatus.STATUS_INVITE_SENT,e.send())},function(t){t.type===u.TypeStrings.SessionDescriptionHandlerError&&(e.logger.log(t.message),t.error&&e.logger.log(t.error)),e.status!==u.SessionStatus.STATUS_TERMINATED&&(e.failed(void 0,a.C.causes.WEBRTC_ERROR),e.terminated(void 0,a.C.causes.WEBRTC_ERROR))}))}),this},t.prototype.receiveInviteResponse=function(e){var t=this;if(this.status!==u.SessionStatus.STATUS_TERMINATED&&e.method===a.C.INVITE){var r=e.callId+e.fromTag+e.toTag,n=[];if(this.dialog&&e.statusCode&&e.statusCode>=200&&e.statusCode<=299){if(r!==this.dialog.id.toString()){if(!this.createDialog(e,"UAC",!0))return;return this.emit("ack",e.ack({body:y.Utils.generateFakeSDP(e.body)})),this.earlyDialogs[r].sendRequest(this,a.C.BYE),void(this.status!==u.SessionStatus.STATUS_CONFIRMED&&(this.failed(e,a.C.causes.WEBRTC_ERROR),this.terminated(e,a.C.causes.WEBRTC_ERROR)))}if(this.status===u.SessionStatus.STATUS_CONFIRMED)return void this.emit("ack",e.ack(e));if(!this.hasAnswer)return}var i=e&&e.statusCode;if(this.dialog&&i&&i<200){var o=e.getHeader("rseq");if(o&&(-1!==this.dialog.pracked.indexOf(o)||Number(this.dialog.pracked[this.dialog.pracked.length-1])>=Number(o)&&this.dialog.pracked.length>0))return;if(!this.earlyDialogs[r]&&!this.createDialog(e,"UAC",!0))return;if(-1!==this.earlyDialogs[r].pracked.indexOf(e.getHeader("rseq"))||this.earlyDialogs[r].pracked[this.earlyDialogs[r].pracked.length-1]>=Number(o)&&this.earlyDialogs[r].pracked.length>0)return;return n.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),this.earlyDialogs[r].pracked.push(e.getHeader("rseq")),void this.earlyDialogs[r].sendRequest(this,a.C.PRACK,{extraHeaders:n,body:y.Utils.generateFakeSDP(e.body)})}if(this.isCanceled){if(i&&i>=100&&i<200)this.request.cancel(this.cancelReason,n),this.canceled();else if(i&&i>=200&&i<299)this.acceptAndTerminate(e),this.emit("bye",this.request);else if(i&&i>=300){var s=a.C.REASON_PHRASE[e.statusCode||0]||a.C.causes.CANCELED;this.rejected(e,s),this.failed(e,s),this.terminated(e,s)}}else{var c=i?i.toString():"";switch(!0){case/^100$/.test(c):this.received100=!0,this.emit("progress",e);break;case/^1[0-9]{2}$/.test(c):if(!e.toTag){this.logger.warn("1xx response received without to tag");break}if(e.hasHeader("contact")&&!this.createDialog(e,"UAC",!0))break;if(this.status=u.SessionStatus.STATUS_1XX_RECEIVED,e.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=d.Grammar.nameAddrHeaderParse(e.getHeader("P-Asserted-Identity"))),e.hasHeader("require")&&-1!==e.getHeader("require").indexOf("100rel")){if(this.dialog||!this.earlyDialogs[r])break;var h=e.getHeader("rseq");if(-1!==this.earlyDialogs[r].pracked.indexOf(h)||this.earlyDialogs[r].pracked[this.earlyDialogs[r].pracked.length-1]>=Number(h)&&this.earlyDialogs[r].pracked.length>0)return;if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||""))if(this.hasOffer){if(!this.createDialog(e,"UAC"))break;this.hasAnswer=!0,void 0!==this.dialog&&h&&this.dialog.pracked.push(h),this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){n.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),t.sendRequest(a.C.PRACK,{extraHeaders:n,receiveResponse:function(){}}),t.status=u.SessionStatus.STATUS_EARLY_MEDIA,t.emit("progress",e)},function(r){t.logger.warn(r),t.acceptAndTerminate(e,488,"Not Acceptable Here"),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION)})}else{var p=this.earlyDialogs[r];p.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),this.emit("SessionDescriptionHandler-created",p.sessionDescriptionHandler),h&&p.pracked.push(h),p.sessionDescriptionHandler&&p.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return p.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(r){n.push("RAck: "+h+" "+e.getHeader("cseq")),p.sendRequest(t,a.C.PRACK,{extraHeaders:n,body:r}),t.status=u.SessionStatus.STATUS_EARLY_MEDIA,t.emit("progress",e)}).catch(function(e){if(h&&e.type===u.TypeStrings.SessionDescriptionHandlerError){if(p.pracked.push(h),t.status===u.SessionStatus.STATUS_TERMINATED)return;t.failed(void 0,a.C.causes.WEBRTC_ERROR),t.terminated(void 0,a.C.causes.WEBRTC_ERROR)}else h&&p.pracked.splice(p.pracked.indexOf(h),1),t.logger.warn("invalid description"),t.logger.warn(e)})}else n.push("RAck: "+e.getHeader("rseq")+" "+e.getHeader("cseq")),this.earlyDialogs[r].pracked.push(e.getHeader("rseq")),this.earlyDialogs[r].sendRequest(this,a.C.PRACK,{extraHeaders:n}),this.emit("progress",e)}else this.emit("progress",e);break;case/^2[0-9]{2}$/.test(c):if(this.request.cseq+" "+this.request.method!==e.getHeader("cseq"))break;if(e.hasHeader("P-Asserted-Identity")&&(this.assertedIdentity=d.Grammar.nameAddrHeaderParse(e.getHeader("P-Asserted-Identity"))),this.status===u.SessionStatus.STATUS_EARLY_MEDIA&&this.dialog){this.status=u.SessionStatus.STATUS_CONFIRMED;var l={};this.renderbody&&(n.push("Content-Type: "+this.rendertype),l.extraHeaders=n,l.body=this.renderbody),this.emit("ack",e.ack(l)),this.accepted(e);break}if(this.dialog)break;if(this.hasOffer)if(this.hasAnswer){l={};this.renderbody&&(n.push("Content-Type: "+this.rendertype),l.extraHeaders=n,l.body=this.renderbody),this.emit("ack",e.ack(l))}else{if(!this.sessionDescriptionHandler||!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){this.acceptAndTerminate(e,400,"Missing session description"),this.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(e,"UAC"))break;this.hasAnswer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){var r={};t.status=u.SessionStatus.STATUS_CONFIRMED,t.renderbody&&(n.push("Content-Type: "+t.rendertype),r.extraHeaders=n,r.body=t.renderbody),t.emit("ack",e.ack(r)),t.accepted(e)},function(r){t.logger.warn(r),t.acceptAndTerminate(e,488,"Not Acceptable Here"),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION)})}else if(this.earlyDialogs[r]&&this.earlyDialogs[r].sessionDescriptionHandler){if(this.hasOffer=!0,this.hasAnswer=!0,this.sessionDescriptionHandler=this.earlyDialogs[r].sessionDescriptionHandler,!this.createDialog(e,"UAC"))break;this.status=u.SessionStatus.STATUS_CONFIRMED,this.emit("ack",e.ack()),this.accepted(e)}else{if(this.sessionDescriptionHandler=this.sessionDescriptionHandlerFactory(this,this.ua.configuration.sessionDescriptionHandlerFactoryOptions||{}),this.emit("SessionDescriptionHandler-created",this.sessionDescriptionHandler),!this.sessionDescriptionHandler.hasDescription(e.getHeader("Content-Type")||"")){this.acceptAndTerminate(e,400,"Missing session description"),this.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(e,"UAC"))break;this.hasOffer=!0,this.sessionDescriptionHandler.setDescription(e.body,this.sessionDescriptionHandlerOptions,this.modifiers).then(function(){return t.sessionDescriptionHandler.getDescription(t.sessionDescriptionHandlerOptions,t.modifiers)}).then(function(r){t.isCanceled||t.status===u.SessionStatus.STATUS_TERMINATED||(t.status=u.SessionStatus.STATUS_CONFIRMED,t.hasAnswer=!0,t.emit("ack",e.ack({body:r})),t.accepted(e))}).catch(function(r){if(r.type!==u.TypeStrings.SessionDescriptionHandlerError)throw r;t.logger.warn("invalid description"),t.logger.warn(r.toString()),t.acceptAndTerminate(e,488,"Invalid session description"),t.failed(e,a.C.causes.BAD_MEDIA_DESCRIPTION)})}break;default:s=y.Utils.sipErrorCause(i||0);this.rejected(e,s),this.failed(e,s),this.terminated(e,s)}}}},t.prototype.cancel=function(e){if(void 0===e&&(e={}),e.extraHeaders=(e.extraHeaders||[]).slice(),this.isCanceled)throw new h.Exceptions.InvalidStateError(u.SessionStatus.STATUS_CANCELED);if(this.status===u.SessionStatus.STATUS_TERMINATED||this.status===u.SessionStatus.STATUS_CONFIRMED)throw new h.Exceptions.InvalidStateError(this.status);this.logger.log("canceling RTCSession"),this.isCanceled=!0;var t=y.Utils.getCancelReason(e.statusCode,e.reasonPhrase);return this.status===u.SessionStatus.STATUS_NULL||this.status===u.SessionStatus.STATUS_INVITE_SENT&&!this.received100?this.cancelReason=t:this.status!==u.SessionStatus.STATUS_INVITE_SENT&&this.status!==u.SessionStatus.STATUS_1XX_RECEIVED&&this.status!==u.SessionStatus.STATUS_EARLY_MEDIA||this.request.cancel(t,e.extraHeaders),this.canceled()},t.prototype.terminate=function(e){return this.status===u.SessionStatus.STATUS_TERMINATED?this:(this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK||this.status===u.SessionStatus.STATUS_CONFIRMED?this.bye(e):this.cancel(e),this)},t.prototype.receiveRequest=function(t){return t.method,a.C.CANCEL,t.method===a.C.ACK&&this.status===u.SessionStatus.STATUS_WAITING_FOR_ACK&&(clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.status=u.SessionStatus.STATUS_CONFIRMED,this.accepted()),e.prototype.receiveRequest.call(this,t)},t}(T);t.InviteClientContext=S;var A=function(e){function t(t,r,n,i){void 0===i&&(i={});var o=this;if(void 0===t||void 0===r||void 0===n)throw new TypeError("Not enough arguments");if((o=e.call(this,t,a.C.REFER,r.remoteIdentity.uri.toString(),i)||this).type=u.TypeStrings.ReferClientContext,o.options=i,o.extraHeaders=(o.options.extraHeaders||[]).slice(),o.applicant=r,"string"==typeof n||n.type!==u.TypeStrings.InviteServerContext&&n.type!==u.TypeStrings.InviteClientContext){var s=d.Grammar.parse(n,"Refer_To");o.target=s&&s.uri?s.uri:n;var c=o.ua.normalizeTarget(o.target);if(!c)throw new TypeError("Invalid target: "+n);o.target=c}else{var h=n.dialog;if(!h)throw new TypeError("Invalid target due to no dialog: "+n);o.target='"'+n.remoteIdentity.friendlyName+'" <'+h.remoteTarget.toString()+"?Replaces="+encodeURIComponent(h.id.callId+";to-tag="+h.id.remoteTag+";from-tag="+h.id.localTag)+">"}return o.ua&&o.extraHeaders.push("Referred-By: <"+o.ua.configuration.uri+">"),o.extraHeaders.push("Contact: "+r.contact),o.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),o.extraHeaders.push("Refer-To: "+o.target),o.errorListener=o.onTransportError.bind(o),t.transport&&t.transport.on("transportError",o.errorListener),o}return i(t,e),t.prototype.refer=function(e){var t=this;void 0===e&&(e={});var r=(this.extraHeaders||[]).slice();return e.extraHeaders&&r.concat(e.extraHeaders),this.applicant.sendRequest(a.C.REFER,{extraHeaders:this.extraHeaders,receiveResponse:function(r){var n=r&&r.statusCode?r.statusCode.toString():"";/^1[0-9]{2}$/.test(n)?t.emit("referRequestProgress",t):/^2[0-9]{2}$/.test(n)?t.emit("referRequestAccepted",t):/^[4-6][0-9]{2}$/.test(n)&&t.emit("referRequestRejected",t),e.receiveResponse&&e.receiveResponse(r)}}),this},t.prototype.receiveNotify=function(e){var t=e.hasHeader("Content-Type")?e.getHeader("Content-Type"):void 0;if(t&&-1!==t.search(/^message\/sipfrag/)){var r=d.Grammar.parse(e.body,"sipfrag");if(-1===r)return void e.reply(489,"Bad Event");switch(!0){case/^1[0-9]{2}$/.test(r.status_code):this.emit("referProgress",this);break;case/^2[0-9]{2}$/.test(r.status_code):this.emit("referAccepted",this),!this.options.activeAfterTransfer&&this.applicant.terminate&&this.applicant.terminate();break;default:this.emit("referRejected",this)}return e.reply(200),void this.emit("notify",e)}e.reply(489,"Bad Event")},t}(s.ClientContext);t.ReferClientContext=A;var b=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.type=u.TypeStrings.ReferServerContext,n.ua=t,n.status=u.SessionStatus.STATUS_INVITE_RECEIVED,n.fromTag=r.fromTag,n.id=r.callId+n.fromTag,n.request=r,n.contact=n.ua.contact.toString(),n.logger=t.getLogger("sip.referservercontext",n.id),n.cseq=Math.floor(1e4*Math.random()),n.callId=n.request.callId,n.fromUri=n.request.to.uri,n.fromTag=n.request.to.parameters.tag,n.remoteTarget=n.request.headers.Contact[0].parsed.uri,n.toUri=n.request.from.uri,n.toTag=n.request.fromTag,n.routeSet=n.request.getHeaders("record-route"),n.request.hasHeader("refer-to")?(n.referTo=n.request.parseHeader("refer-to"),n.referredSession=n.ua.findSession(r),n.request.hasHeader("referred-by")&&(n.referredBy=n.request.getHeader("referred-by")),n.referTo.uri.hasHeader("replaces")&&(n.replaces=n.referTo.uri.getHeader("replaces")),n.errorListener=n.onTransportError.bind(n),t.transport&&t.transport.on("transportError",n.errorListener),n.status=u.SessionStatus.STATUS_WAITING_FOR_ANSWER,n):(n.logger.warn("Invalid REFER packet. A refer-to header is required. Rejecting refer."),n.reject(),n)}return i(t,e),t.prototype.receiveNonInviteResponse=function(e){},t.prototype.progress=function(){if(this.status!==u.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new h.Exceptions.InvalidStateError(this.status);this.request.reply(100)},t.prototype.reject=function(t){if(void 0===t&&(t={}),this.status===u.SessionStatus.STATUS_TERMINATED)throw new h.Exceptions.InvalidStateError(this.status);this.logger.log("Rejecting refer"),this.status=u.SessionStatus.STATUS_TERMINATED,e.prototype.reject.call(this,t),this.emit("referRequestRejected",this)},t.prototype.accept=function(e,t){var r=this;if(void 0===e&&(e={}),this.status!==u.SessionStatus.STATUS_WAITING_FOR_ANSWER)throw new h.Exceptions.InvalidStateError(this.status);if(this.status=u.SessionStatus.STATUS_ANSWERED,this.request.reply(202,"Accepted"),this.emit("referRequestAccepted",this),e.followRefer){this.logger.log("Accepted refer, attempting to automatically follow it");var n=this.referTo.uri;if(!n.scheme||!n.scheme.match("^sips?$"))return this.logger.error("SIP.js can only automatically follow SIP refer target"),void this.reject();var i=e.inviteOptions||{},o=(i.extraHeaders||[]).slice();if(this.replaces&&o.push("Replaces: "+decodeURIComponent(this.replaces)),this.referredBy&&o.push("Referred-By: "+this.referredBy),i.extraHeaders=o,n.clearHeaders(),this.targetSession=this.ua.invite(n.toString(),i,t),this.emit("referInviteSent",this),this.targetSession){this.targetSession.once("progress",function(e){var t=e.statusCode||100,n=e.reasonPhrase;r.sendNotify(("SIP/2.0 "+t+" "+n).trim()),r.emit("referProgress",r),r.referredSession&&r.referredSession.emit("referProgress",r)}),this.targetSession.once("accepted",function(){r.logger.log("Successfully followed the refer"),r.sendNotify("SIP/2.0 200 OK"),r.emit("referAccepted",r),r.referredSession&&r.referredSession.emit("referAccepted",r)});var s=function(e){if(r.status!==u.SessionStatus.STATUS_TERMINATED){if(r.logger.log("Refer was not successful. Resuming session"),e&&429===e.statusCode)return r.logger.log("Alerting referrer that identity is required."),void r.sendNotify("SIP/2.0 429 Provide Referrer Identity");r.sendNotify("SIP/2.0 603 Declined"),r.status=u.SessionStatus.STATUS_TERMINATED,r.emit("referRejected",r),r.referredSession&&r.referredSession.emit("referRejected")}};this.targetSession.once("rejected",s),this.targetSession.once("failed",s)}}else this.logger.log("Accepted refer, but did not automatically follow it"),this.sendNotify("SIP/2.0 200 OK"),this.emit("referAccepted",this),this.referredSession&&this.referredSession.emit("referAccepted",this)},t.prototype.sendNotify=function(e){if(this.status!==u.SessionStatus.STATUS_ANSWERED)throw new h.Exceptions.InvalidStateError(this.status);if(-1===d.Grammar.parse(e,"sipfrag"))throw new Error("sipfrag body is required to send notify for refer");var t=new g.OutgoingRequest(a.C.NOTIFY,this.remoteTarget,this.ua,{cseq:this.cseq+=1,callId:this.callId,fromUri:this.fromUri,fromTag:this.fromTag,toUri:this.toUri,toTag:this.toTag,routeSet:this.routeSet},["Event: refer","Subscription-State: terminated","Content-Type: message/sipfrag"],e);new p.RequestSender({request:t,onRequestTimeout:function(){},onTransportError:function(){},receiveResponse:function(){}},this.ua).send()},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t}(l.ServerContext);t.ReferServerContext=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),o=r(8),s=function(){function e(e,t){this.type=i.TypeStrings.RequestSender,this.logger=t.getLogger("sip.requestsender"),this.loggerFactory=t.getLoggerFactory(),this.ua=t,this.applicant=e,this.method=e.request.method,this.request=e.request,this.credentials=void 0,this.challenged=!1,this.staled=!1,t.status===i.UAStatus.STATUS_USER_CLOSED&&this.method!==n.C.BYE&&this.method!==n.C.ACK&&this.onTransportError()}return e.prototype.send=function(){var e=this,t=this.ua.transport;if(!t)throw new Error("Transport undefined.");var r,n={loggerFactory:this.ua.getLoggerFactory(),onRequestTimeout:function(){return e.onRequestTimeout()},onStateChange:function(t){t===o.TransactionState.Terminated&&e.ua.destroyTransaction(r)},onTransportError:function(t){return e.onTransportError()},receiveResponse:function(t){return e.receiveResponse(t)}};switch(this.method){case"INVITE":r=new o.InviteClientTransaction(this.request,t,n);break;case"ACK":throw new Error("Cannot make client transaction for ACK method.");default:r=new o.NonInviteClientTransaction(this.request,t,n)}return this.clientTransaction=r,this.ua.newTransaction(r),r},e.prototype.onRequestTimeout=function(){this.applicant.onRequestTimeout()},e.prototype.onTransportError=function(){this.applicant.onTransportError()},e.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;if(401===t||407===t){var r=void 0,i=void 0;if(401===t?(r=e.parseHeader("www-authenticate"),i="authorization"):(r=e.parseHeader("proxy-authenticate"),i="proxy-authorization"),!r)return this.logger.warn(t+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(e);if(!this.challenged||!this.staled&&!0===r.stale){if(!this.credentials&&this.ua.configuration.authenticationFactory&&(this.credentials=this.ua.configuration.authenticationFactory(this.ua)),!this.credentials.authenticate(this.request,r))return void this.applicant.receiveResponse(e);this.challenged=!0,r.stale&&(this.staled=!0);var o=void 0;e.method===n.C.REGISTER?o=this.applicant.cseq+=1:this.request.dialog?o=this.request.dialog.localSeqnum+=1:(o=(this.request.cseq||0)+1,this.request.cseq=o),this.request.setHeader("cseq",o+" "+this.method),this.request.setHeader(i,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(e)}else this.applicant.receiveResponse(e)},e}();t.RequestSender=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=500;t.Timers={T1:n,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,TIMER_N:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(2),s=r(0),a=function(){function e(e){for(var t in this.parameters={},this.type=s.TypeStrings.Parameters,e)e.hasOwnProperty(t)&&this.setParam(t,e[t])}return e.prototype.setParam=function(e,t){e&&(this.parameters[e.toLowerCase()]=null==t?null:t.toString())},e.prototype.getParam=function(e){if(e)return this.parameters[e.toLowerCase()]},e.prototype.hasParam=function(e){return!!e&&!!this.parameters.hasOwnProperty(e.toLowerCase())},e.prototype.deleteParam=function(e){if(e=e.toLowerCase(),this.parameters.hasOwnProperty(e)){var t=this.parameters[e];return delete this.parameters[e],t}},e.prototype.clearParams=function(){this.parameters={}},e}();t.Parameters=a;var c=function(e){function t(t,r,n,i,a,c){var u=e.call(this,a)||this;if(u.headers={},u.type=s.TypeStrings.URI,!n)throw new TypeError('missing or invalid "host" parameter');for(var h in t=t||o.C.SIP,c)c.hasOwnProperty(h)&&u.setHeader(h,c[h]);return u.raw={scheme:t,user:r,host:n,port:i},u.normal={scheme:t.toLowerCase(),user:r,host:n.toLowerCase(),port:i},u}return i(t,e),Object.defineProperty(t.prototype,"_normal",{get:function(){return this.normal},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_raw",{get:function(){return this.raw},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scheme",{get:function(){return this.normal.scheme},set:function(e){this.raw.scheme=e,this.normal.scheme=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"user",{get:function(){return this.normal.user},set:function(e){this.normal.user=this.raw.user=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this.normal.host},set:function(e){this.raw.host=e,this.normal.host=e.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aor",{get:function(){return this.normal.user+"@"+this.normal.host},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"port",{get:function(){return this.normal.port},set:function(e){this.normal.port=this.raw.port=e},enumerable:!0,configurable:!0}),t.prototype.setHeader=function(e,t){this.headers[this.headerize(e)]=t instanceof Array?t:[t]},t.prototype.getHeader=function(e){if(e)return this.headers[this.headerize(e)]},t.prototype.hasHeader=function(e){return!!e&&!!this.headers.hasOwnProperty(this.headerize(e))},t.prototype.deleteHeader=function(e){if(e=this.headerize(e),this.headers.hasOwnProperty(e)){var t=this.headers[e];return delete this.headers[e],t}},t.prototype.clearHeaders=function(){this.headers={}},t.prototype.clone=function(){return new t(this._raw.scheme,this._raw.user||"",this._raw.host,this._raw.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},t.prototype.toRaw=function(){return this._toString(this._raw)},t.prototype.toString=function(){return this._toString(this._normal)},t.prototype._toString=function(e){var t=e.scheme+":";for(var r in e.scheme.toLowerCase().match("^sips?$")||(t+="//"),e.user&&(t+=this.escapeUser(e.user)+"@"),t+=e.host,(e.port||0===e.port)&&(t+=":"+e.port),this.parameters)this.parameters.hasOwnProperty(r)&&(t+=";"+r,null!==this.parameters[r]&&(t+="="+this.parameters[r]));var n=[];for(var i in this.headers)if(this.headers.hasOwnProperty(i))for(var o in this.headers[i])this.headers[i].hasOwnProperty(o)&&n.push(i+"="+this.headers[i][o]);return n.length>0&&(t+="?"+n.join("&")),t},t.prototype.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},t.prototype.headerize=function(e){for(var t={"Call-Id":"Call-ID",Cseq:"CSeq","Min-Se":"Min-SE",Rack:"RAck",Rseq:"RSeq","Www-Authenticate":"WWW-Authenticate"},r=e.toLowerCase().replace(/_/g,"-").split("-"),n=r.length,i="",o=0;o<n;o++)0!==o&&(i+="-"),i+=r[o].charAt(0).toUpperCase()+r[o].substring(1);return t[i]&&(i=t[i]),i},t}(a);t.URI=c},function(e,t,r){function n(){try{return t.storage.debug}catch(e){}if("undefined"!=typeof process&&"env"in process)return process.env.DEBUG}(t=e.exports=r(88)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(){var e=arguments,r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n),e},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())},function(e,t){e.exports=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){function n(){try{return t.storage.debug}catch(e){}if("undefined"!=typeof process&&"env"in process)return process.env.DEBUG}(t=e.exports=r(108)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(){var e=arguments,r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n),e},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),o=r(15),s=r(9),a=r(8),c=function(){function e(e,t,r,n){if(this.pracked=[],this.uacPendingReply=!1,this.uasPendingReply=!1,this.type=i.TypeStrings.Dialog,!t.hasHeader("contact"))throw new Error("unable to create a Dialog without Contact header field");if(t.type===i.TypeStrings.IncomingResponse){var o=t.statusCode;n=o&&o<200?i.DialogStatus.STATUS_EARLY:i.DialogStatus.STATUS_CONFIRMED}else n=n||i.DialogStatus.STATUS_CONFIRMED;var s=t.parseHeader("contact");"UAS"===r&&t.type===i.TypeStrings.IncomingRequest?(this.id={callId:t.callId,localTag:t.toTag,remoteTag:t.fromTag,toString:function(){return t.callId+t.toTag+t.fromTag}},this.state=n,this.remoteSeqnum=t.cseq,this.localUri=(t.parseHeader("to")||{}).uri,this.remoteUri=(t.parseHeader("from")||{}).uri,this.remoteTarget=s.uri,this.routeSet=t.getHeaders("record-route"),this.inviteSeqnum=t.cseq,this.localSeqnum=t.cseq):(this.id={callId:t.callId,localTag:t.fromTag,remoteTag:t.toTag,toString:function(){return t.callId+t.fromTag+t.toTag}},this.state=n,this.inviteSeqnum=t.cseq,this.localSeqnum=t.cseq,this.localUri=t.parseHeader("from").uri,this.pracked=[],this.remoteUri=t.parseHeader("to").uri,this.remoteTarget=s.uri,this.routeSet=t.getHeaders("record-route").reverse()),this.logger=e.ua.getLogger("sip.dialog",this.id.toString()),this.owner=e,e.ua.dialogs[this.id.toString()]=this,this.logger.log("new "+r+" dialog created with status "+(this.state===i.DialogStatus.STATUS_EARLY?"EARLY":"CONFIRMED")),e.emit("dialog",this)}return e.prototype.update=function(e,t){this.state=i.DialogStatus.STATUS_CONFIRMED,this.logger.log("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this.routeSet=e.getHeaders("record-route").reverse())},e.prototype.terminate=function(){this.logger.log("dialog "+this.id.toString()+" deleted"),this.sessionDescriptionHandler&&this.state!==i.DialogStatus.STATUS_CONFIRMED&&this.sessionDescriptionHandler.close(),delete this.owner.ua.dialogs[this.id.toString()]},e.prototype.createRequest=function(e,t,r){void 0===t&&(t=[]),t=t.slice(),this.localSeqnum||(this.localSeqnum=Math.floor(1e4*Math.random()));var i=e===n.C.CANCEL||e===n.C.ACK?this.inviteSeqnum:this.localSeqnum+=1,o=new s.OutgoingRequest(e,this.remoteTarget,this.owner.ua,{cseq:i,callId:this.id.callId,fromUri:this.localUri,fromTag:this.id.localTag,toIri:this.remoteUri,toTag:this.id.remoteTag,routeSet:this.routeSet},t,r);return o.dialog=this,o},e.prototype.checkInDialogRequest=function(e){var t=this;if(this.remoteSeqnum){if(e.cseq<this.remoteSeqnum)return e.method!==n.C.ACK&&e.reply(500),e.cseq===this.inviteSeqnum}else this.remoteSeqnum=e.cseq;switch(e.method){case n.C.INVITE:if(!0===this.uacPendingReply)e.reply(491);else{if(!0===this.uasPendingReply&&e.cseq>this.remoteSeqnum){var r=Math.floor(10*Math.random())+1;return e.reply(500,void 0,["Retry-After:"+r]),this.remoteSeqnum=e.cseq,!1}this.uasPendingReply=!0;var i=function(){!e.transaction||e.transaction.state!==a.TransactionState.Accepted&&e.transaction.state!==a.TransactionState.Completed&&e.transaction.state!==a.TransactionState.Terminated||(e.transaction.removeListener("stateChanged",i),t.uasPendingReply=!1)};e.transaction&&e.transaction.on("stateChanged",i)}e.hasHeader("contact")&&e.transaction&&e.transaction.on("stateChanged",function(){e.transaction&&e.transaction.state===a.TransactionState.Accepted&&(t.remoteTarget=e.parseHeader("contact").uri)});break;case n.C.NOTIFY:e.hasHeader("contact")&&e.transaction&&e.transaction.on("stateChanged",function(){e.transaction&&e.transaction.state===a.TransactionState.Completed&&(t.remoteTarget=e.parseHeader("contact").uri)})}return e.cseq>this.remoteSeqnum&&(this.remoteSeqnum=e.cseq),!0},e.prototype.sendRequest=function(e,t,r){var s=this;void 0===r&&(r={});var c,u=(r.extraHeaders||[]).slice();r.body&&(r.body.body?c=r.body:((c={}).body=r.body,r.contentType&&(c.contentType=r.contentType)));var h=this.createRequest(t,u,c),d=function(t){var r=new o.RequestSender({request:h,onRequestTimeout:e.onRequestTimeout.bind(e),onTransportError:e.onTransportError.bind(e),receiveResponse:function(r){408===r.statusCode||481===r.statusCode?e.onDialogError(r):r.method===n.C.INVITE&&491===r.statusCode?t?e.receiveResponse(r):(h.cseq=s.localSeqnum+=1,setTimeout(function(){void 0!==s.owner.status&&s.owner.status!==i.SessionStatus.STATUS_TERMINATED&&d(!0)},1e3)):e.receiveResponse(r)}},s.owner.ua);if(r.send(),r.clientTransaction&&h.method===n.C.INVITE&&r.clientTransaction&&r.clientTransaction.state!==a.TransactionState.Terminated){s.uacPendingReply=!0;var c=function(){var e=r.clientTransaction.state;r.clientTransaction&&(!r.clientTransaction||e!==a.TransactionState.Accepted&&e!==a.TransactionState.Completed&&e!==a.TransactionState.Terminated||(r.clientTransaction.removeListener("stateChanged",c),s.uacPendingReply=!1))};r.clientTransaction.on("stateChanged",c)}};return d(!1),h},e.prototype.receiveRequest=function(e){this.checkInDialogRequest(e)&&this.owner.receiveRequest(e)},e.C=i.DialogStatus,e}();t.Dialog=c},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),s=r(2),a=r(0),c=r(7),u=r(8),h=r(3),d=function(e){function t(r,n){var i=e.call(this)||this;return i.data={},t.initializer(i,r,n),i}return i(t,e),t.initializer=function(e,t,r){e.type=a.TypeStrings.ServerContext,e.ua=t,e.logger=t.getLogger("sip.servercontext"),e.request=r;var n=t.transport;if(!n)throw new Error("Transport undefined.");var i={loggerFactory:t.getLoggerFactory(),onStateChange:function(r){r===u.TransactionState.Terminated&&t.destroyTransaction(e.transaction)},onTransportError:function(t){e.logger.error(t.message),e.onTransportError()}};if(r.method===s.C.INVITE?e.transaction=new u.InviteServerTransaction(r,n,i):e.transaction=new u.NonInviteServerTransaction(r,n,i),t.newTransaction(e.transaction),r.body&&(e.body=r.body),r.hasHeader("Content-Type")&&(e.contentType=r.getHeader("Content-Type")),e.method=r.method,e.localIdentity=r.to,e.remoteIdentity=r.from,r.hasHeader("P-Asserted-Identity")){var o=r.getHeader("P-Asserted-Identity");o&&(e.assertedIdentity=c.Grammar.nameAddrHeaderParse(o))}},t.prototype.progress=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||180,e.minCode=100,e.maxCode=199,e.events=["progress"],this.reply(e)},t.prototype.accept=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||200,e.minCode=200,e.maxCode=299,e.events=["accepted"],this.reply(e)},t.prototype.reject=function(e){return void 0===e&&(e={}),e.statusCode=e.statusCode||480,e.minCode=300,e.maxCode=699,e.events=["rejected","failed"],this.reply(e)},t.prototype.reply=function(e){var t=this;void 0===e&&(e={});var r=e.statusCode||100,n=e.minCode||100,i=e.maxCode||699,o=h.Utils.getReasonPhrase(r,e.reasonPhrase),s=e.extraHeaders||[],a=e.body,c=e.events||[];if(r<n||r>i)throw new TypeError("Invalid statusCode: "+r);var u=this.request.reply(r,o,s,a);return c.forEach(function(e){t.emit(e,u,o)}),this},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR)},t}(o.EventEmitter);t.ServerContext=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t){for(var r,n=[],i=e.split(/\r\n/),o=0;o<i.length;){var s=i[o];if(/^m=(?:audio|video)/.test(s))r={index:o,stripped:[]},n.push(r);else if(r){var a=/^a=rtpmap:(\d+) ([^/]+)\//.exec(s);if(a&&t===a[2]){i.splice(o,1),r.stripped.push(a[1]);continue}}o++}for(var c=0,u=n;c<u.length;c++){for(var h=u[c],d=i[h.index].split(" "),p=3;p<d.length;)-1===h.stripped.indexOf(d[p])?p++:d.splice(p,1);i[h.index]=d.join(" ")}return i.join("\r\n")},i=function(e,t){var r=new RegExp("m="+t+".*$","gm"),n=new RegExp("^a=group:.*$","gm");if(r.test(e)){var i,o=(e=e.split(/^m=/gm).filter(function(e){if(e.substr(0,t.length)===t){if(i=e.match(/^a=mid:.*$/gm)){var r=i[0].match(/:.+$/g);r&&(i=r[0].substr(1))}return!1}return!0}).join("m=")).match(n);if(o&&1===o.length){var s=o[0],a=new RegExp(" *"+i+"[^ ]*","g");s=s.replace(a,""),e=e.split(n).join(s)}}return e};t.stripTcpCandidates=function(e){return e.sdp=(e.sdp||"").replace(/^a=candidate:\d+ \d+ tcp .*?\r\n/gim,""),Promise.resolve(e)},t.stripTelephoneEvent=function(e){return e.sdp=n(e.sdp||"","telephone-event"),Promise.resolve(e)},t.cleanJitsiSdpImageattr=function(e){return e.sdp=(e.sdp||"").replace(/^(a=imageattr:.*?)(x|y)=\[0-/gm,"$1$2=[1:"),Promise.resolve(e)},t.stripG722=function(e){return e.sdp=n(e.sdp||"","G722"),Promise.resolve(e)},t.stripRtpPayload=function(e){return function(t){return t.sdp=n(t.sdp||"",e),Promise.resolve(t)}},t.stripVideo=function(e){return e.sdp=i(e.sdp||"","video"),Promise.resolve(e)},t.addMidLines=function(e){var t=e.sdp||"";if(-1===t.search(/^a=mid.*$/gm)){var r=t.match(/^m=.*$/gm),n=t.split(/^m=.*$/gm);r&&r.forEach(function(e,t){r[t]=e+"\na=mid:"+t}),n.forEach(function(e,t){r&&r[t]&&(n[t]=e+r[t])}),t=n.join(""),e.sdp=t}return Promise.resolve(e)}},function(e,t,r){"use strict";var n=r(4),i=r(72),o={"Content-Type":"application/x-www-form-urlencoded"};function s(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var a,c={adapter:("undefined"!=typeof XMLHttpRequest?a=r(44):"undefined"!=typeof process&&(a=r(44)),a),transformRequest:[function(e,t){return i(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(s(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)?(s(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};c.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],function(e){c.headers[e]={}}),n.forEach(["post","put","patch"],function(e){c.headers[e]=n.merge(o)}),e.exports=c},function(e,t,r){var n=r(90)("socket.io-parser"),i=r(93),o=r(95),s=r(96),a=r(51);function c(){}function u(e){var r="",o=!1;return r+=e.type,t.BINARY_EVENT!=e.type&&t.BINARY_ACK!=e.type||(r+=e.attachments,r+="-"),e.nsp&&"/"!=e.nsp&&(o=!0,r+=e.nsp),null!=e.id&&(o&&(r+=",",o=!1),r+=e.id),null!=e.data&&(o&&(r+=","),r+=i.stringify(e.data)),n("encoded %j as %s",e,r),r}function h(){this.reconstructor=null}function d(e){this.reconPack=e,this.buffers=[]}function p(e){return{type:t.ERROR,data:"parser error"}}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=h,c.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT==e.type||t.BINARY_ACK==e.type)?function(e,t){s.removeBlobs(e,function(e){var r=s.deconstructPacket(e),n=u(r.packet),i=r.buffers;i.unshift(n),t(i)})}(e,r):r([u(e)])},o(h.prototype),h.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r={},o=0;if(r.type=Number(e.charAt(0)),null==t.types[r.type])return p();if(t.BINARY_EVENT==r.type||t.BINARY_ACK==r.type){for(var s="";"-"!=e.charAt(++o)&&(s+=e.charAt(o),o!=e.length););if(s!=Number(s)||"-"!=e.charAt(o))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"==e.charAt(o+1))for(r.nsp="";++o;){var a=e.charAt(o);if(","==a)break;if(r.nsp+=a,o==e.length)break}else r.nsp="/";var c=e.charAt(o+1);if(""!==c&&Number(c)==c){for(r.id="";++o;){var a=e.charAt(o);if(null==a||Number(a)!=a){--o;break}if(r.id+=e.charAt(o),o==e.length)break}r.id=Number(r.id)}e.charAt(++o)&&(r=function(e,t){try{e.data=i.parse(t)}catch(e){return p()}return e}(r,e.substr(o)));return n("decoded %s as %j",e,r),r}(e),t.BINARY_EVENT==r.type||t.BINARY_ACK==r.type?(this.reconstructor=new d(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},h.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,r){(function(t){var n=r(100);e.exports=function(e){var r=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!r||n))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!r)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,r(1))},function(e,t,r){var n=r(12),i=r(13);function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=o,i(o.prototype),o.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t){t.encode=function(e){var t="";for(var r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t},t.decode=function(e){for(var t={},r=e.split("&"),n=0,i=r.length;n<i;n++){var o=r[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(11);t.ClientContext=n.ClientContext;var i=r(2);t.C=i.C;var o=r(21);t.Dialog=o.Dialog;var s=r(32);t.DigestAuthentication=s.DigestAuthentication;var a=r(0);t.DialogStatus=a.DialogStatus,t.SessionStatus=a.SessionStatus,t.TypeStrings=a.TypeStrings,t.UAStatus=a.UAStatus;var c=r(6);t.Exceptions=c.Exceptions;var u=r(7);t.Grammar=u.Grammar;var h=r(33);t.LoggerFactory=h.LoggerFactory;var d=r(31);t.NameAddrHeader=d.NameAddrHeader;var p=r(34);t.Parser=p.Parser;var l=r(35);t.PublishContext=l.PublishContext;var f=r(36);t.RegisterContext=f.RegisterContext;var g=r(15);t.RequestSender=g.RequestSender;var m=r(37).SanityCheck.sanityCheck;t.sanityCheck=m;var v=r(22);t.ServerContext=v.ServerContext;var y=r(14);t.InviteClientContext=y.InviteClientContext,t.InviteServerContext=y.InviteServerContext,t.ReferClientContext=y.ReferClientContext,t.ReferServerContext=y.ReferServerContext,t.Session=y.Session;var T=r(9);t.IncomingRequest=T.IncomingRequest,t.IncomingResponse=T.IncomingResponse,t.OutgoingRequest=T.OutgoingRequest;var C=r(38);t.Subscription=C.Subscription;var S=r(16);t.Timers=S.Timers;var A=r(8),b={InviteClientTransaction:A.InviteClientTransaction,InviteServerTransaction:A.InviteServerTransaction,NonInviteClientTransaction:A.NonInviteClientTransaction,NonInviteServerTransaction:A.NonInviteServerTransaction};t.Transactions=b;var E=r(39);t.Transport=E.Transport;var w=r(40);t.UA=w.UA;var _=r(17);t.URI=_.URI;var R=r(3);t.Utils=R.Utils;var I=r(67);t.Web=I;var O=r(30),N=O.title;t.name=N;var D=O.version;t.version=D},function(e){e.exports={_args:[["tky-sip@0.0.3","/Users/tianyu/code/ketian/kty_v2/client/CC_v2.0"]],_from:"tky-sip@0.0.3",_id:"tky-sip@0.0.3",_inBundle:!1,_integrity:"sha1-B8aYqxeEB6QX1YJJpdTYulpdZuo=",_location:"/tky-sip",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"tky-sip@0.0.3",name:"tky-sip",escapedName:"tky-sip",rawSpec:"0.0.3",saveSpec:null,fetchSpec:"0.0.3"},_requiredBy:["/"],_resolved:"https://registry.npm.taobao.org/tky-sip/download/tky-sip-0.0.3.tgz",_spec:"0.0.3",_where:"/Users/tianyu/code/ketian/kty_v2/client/CC_v2.0",author:{name:"tky"},dependencies:{"crypto-js":"^3.1.9-1"},description:"A simple, intuitive, and powerful JavaScript signaling library",devDependencies:{"@types/jasmine":"^3.3.11","@types/node":"^11.11.6","circular-dependency-plugin":"^5.0.2","jasmine-core":"^3.3.0",karma:"^4.0.1","karma-chrome-launcher":"^2.2.0","karma-cli":"^2.0.0","karma-jasmine":"^2.0.1","karma-jasmine-html-reporter":"^1.4.0","karma-mocha-reporter":"^2.2.5","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^3.0.5",pegjs:"^0.10.0","ts-loader":"^5.3.3","ts-pegjs":"0.2.2",tslint:"^5.14.0",typescript:"^3.3.4000",webpack:"^4.29.6","webpack-cli":"^3.3.0"},engines:{node:">=8.0"},license:"MIT",main:"./lib/index.js",name:"tky-sip",scripts:{browserTest:"npm run build-test && sleep 2 && open http://0.0.0.0:9876/debug.html & karma start --reporters kjhtml --no-single-run",build:"npm run generate-grammar && npm run build-lib && npm run build-reg-bundle && npm run build-min-bundle","build-bundles":"npm run build-reg-bundle && npm run build-min-bundle","build-lib":"tsc -p src","build-min-bundle":"webpack --progress --config build/webpack.config.js --env.buildType min","build-reg-bundle":"webpack --progress --config build/webpack.config.js --env.buildType reg","build-test":"tsc -p test",buildAndBrowserTest:"npm run build && npm run browserTest",buildAndTest:"npm run build && npm run commandLineTest",commandLineTest:"npm run build-test && karma start --reporters mocha --browsers ChromeHeadless --single-run","copy-dist-files":"cp dist/sip.js dist/sip-$npm_package_version.js && cp dist/sip.min.js dist/sip-$npm_package_version.min.js","generate-grammar":"node build/grammarGenerator.js",prebuild:"tslint -p tsconfig-base.json -c tslint.json",prepublish:"npm run build"},title:"tky-sip",types:"./lib/index.d.ts",version:"0.0.3"}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),s=function(e){function t(t,r,n){var i=e.call(this,n)||this;if(i.type=o.TypeStrings.NameAddrHeader,!t||t.type!==o.TypeStrings.URI)throw new TypeError('missing or invalid "uri" parameter');return i.uri=t,i._displayName=r,i}return i(t,e),Object.defineProperty(t.prototype,"friendlyName",{get:function(){return this.displayName||this.uri.aor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName},set:function(e){this._displayName=e},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new t(this.uri.clone(),this._displayName,JSON.parse(JSON.stringify(this.parameters)))},t.prototype.toString=function(){var e=this.displayName||"0"===this.displayName?'"'+this.displayName+'" ':"";for(var t in e+="<"+this.uri.toString()+">",this.parameters)this.parameters.hasOwnProperty(t)&&(e+=";"+t,null!==this.parameters[t]&&(e+="="+this.parameters[t]));return e},t}(r(17).Parameters);t.NameAddrHeader=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(63),i=r(0),o=r(3),s=function(){function e(e){this.type=i.TypeStrings.DigestAuthentication,this.logger=e.getLogger("sipjs.digestauthentication"),this.username=e.configuration.authorizationUser,this.password=e.configuration.password,this.nc=0,this.ncHex="00000000"}return e.prototype.authenticate=function(e,t,r){if(this.algorithm=t.algorithm,this.realm=t.realm,this.nonce=t.nonce,this.opaque=t.opaque,this.stale=t.stale,this.algorithm){if("MD5"!==this.algorithm)return this.logger.warn("challenge with Digest algorithm different than 'MD5', authentication aborted"),!1}else this.algorithm="MD5";if(!this.realm)return this.logger.warn("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return this.logger.warn("challenge without Digest nonce, authentication aborted"),!1;if(t.qop)if(t.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(t.qop.indexOf("auth-int")>-1))return this.logger.warn("challenge without Digest qop different than 'auth' or 'auth-int', authentication aborted"),!1;this.qop="auth-int"}else this.qop=void 0;return this.method=e.method,this.uri=e.ruri,this.cnonce=o.Utils.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(r),!0},e.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},e.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},e.prototype.calculateResponse=function(e){var t,r=n(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(t=n(this.method+":"+this.uri),this.response=n(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=n(this.method+":"+this.uri+":"+n(e||"")),this.response=n(r+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):void 0===this.qop&&(t=n(this.method+":"+this.uri),this.response=n(r+":"+this.nonce+":"+t))},e}();t.DigestAuthentication=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(0);!function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.log=2]="log",e[e.debug=3]="debug"}(n=t.Levels||(t.Levels={}));var o=function(){function e(){this.builtinEnabled=!0,this._level=n.log,this.loggers={},this.type=i.TypeStrings.LoggerFactory,this.logger=this.getLogger("sip:loggerfactory")}return Object.defineProperty(e.prototype,"level",{get:function(){return this._level},set:function(e){e>=0&&e<=3?this._level=e:e>3?this._level=3:n.hasOwnProperty(e)?this._level=e:this.logger.error("invalid 'level' parameter value: "+JSON.stringify(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connector",{get:function(){return this._connector},set:function(e){e?"function"==typeof e?this._connector=e:this.logger.error("invalid 'connector' parameter value: "+JSON.stringify(e)):this._connector=void 0},enumerable:!0,configurable:!0}),e.prototype.getLogger=function(e,t){if(t&&3===this.level)return new s(this,e,t);if(this.loggers[e])return this.loggers[e];var r=new s(this,e);return this.loggers[e]=r,r},e.prototype.genericLog=function(e,t,r,i){this.level>=e&&this.builtinEnabled&&this.print(console[n[e]],t,r,i),this.connector&&this.connector(n[e],t,r,i)},e.prototype.print=function(e,t,r,n){if("string"==typeof n){var i=[new Date,t];r&&i.push(r),n=i.concat(n).join(" | ")}e.call(console,n)},e}();t.LoggerFactory=o;var s=function(){function e(e,t,r){this.type=i.TypeStrings.Logger,this.logger=e,this.category=t,this.label=r}return e.prototype.error=function(e){this.genericLog(n.error,e)},e.prototype.warn=function(e){this.genericLog(n.warn,e)},e.prototype.log=function(e){this.genericLog(n.log,e)},e.prototype.debug=function(e){this.genericLog(n.debug,e)},e.prototype.genericLog=function(e,t){this.logger.genericLog(e,this.category,this.label,t)},e}();t.Logger=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(7),o=r(9);!function(e){function t(e,t){var r=t,n=0,i=0;if(e.substring(r,r+2).match(/(^\r\n)/))return-2;for(;0===n;){if(-1===(i=e.indexOf("\r\n",r)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?r=i+2:n=i}return n}function r(e,t,r,o){var s,a=t.indexOf(":",r),c=t.substring(r,a).trim(),u=t.substring(a+1,o).trim();switch(c.toLowerCase()){case"via":case"v":e.addHeader("via",u),1===e.getHeaders("via").length?(s=e.parseHeader("Via"))&&(e.via=s,e.viaBranch=s.branch):s=0;break;case"from":case"f":e.setHeader("from",u),(s=e.parseHeader("from"))&&(e.from=s,e.fromTag=s.getParam("tag"));break;case"to":case"t":e.setHeader("to",u),(s=e.parseHeader("to"))&&(e.to=s,e.toTag=s.getParam("tag"));break;case"record-route":if(-1===(s=i.Grammar.parse(u,"Record_Route"))){s=void 0;break}if(!(s instanceof Array)){s=void 0;break}s.forEach(function(t){e.addHeader("record-route",u.substring(t.position,t.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=t.parsed});break;case"call-id":case"i":e.setHeader("call-id",u),(s=e.parseHeader("call-id"))&&(e.callId=u);break;case"contact":case"m":if(-1===(s=i.Grammar.parse(u,"Contact"))){s=void 0;break}if(!(s instanceof Array)){s=void 0;break}s.forEach(function(t){e.addHeader("contact",u.substring(t.position,t.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=t.parsed});break;case"content-length":case"l":e.setHeader("content-length",u),s=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",u),s=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",u),(s=e.parseHeader("cseq"))&&(e.cseq=s.value),e.type===n.TypeStrings.IncomingResponse&&(e.method=s.method);break;case"max-forwards":e.setHeader("max-forwards",u),s=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",u),s=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",u),s=e.parseHeader("proxy-authenticate");break;case"refer-to":case"r":e.setHeader("refer-to",u),(s=e.parseHeader("refer-to"))&&(e.referTo=s);break;default:e.setHeader(c,u),s=0}return void 0!==s||{error:"error parsing header '"+c+"'"}}e.getHeader=t,e.parseHeader=r,e.parseMessage=function(e,n){var s=0,a=e.indexOf("\r\n"),c=n.getLogger("sip.parser");if(-1!==a){var u,h=e.substring(0,a),d=i.Grammar.parse(h,"Request_Response");if(-1!==d){var p;for(d.status_code?((u=new o.IncomingResponse(n)).statusCode=d.status_code,u.reasonPhrase=d.reason_phrase):((u=new o.IncomingRequest(n)).method=d.method,u.ruri=d.uri),u.data=e,s=a+2;;){if(-2===(a=t(e,s))){p=s+2;break}if(-1===a)return void c.error("malformed message");if(!0!==r(u,e,s,a))return void c.error(d.error);s=a+2}return u.hasHeader("content-length")?u.body=e.substr(p,Number(u.getHeader("content-length"))):u.body=e.substring(p),u}c.warn('error parsing first line of SIP message: "'+h+'"')}else c.warn("no CRLF found, not a SIP message, discarded")}}(t.Parser||(t.Parser={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(11),s=r(2),a=r(0),c=r(6),u=r(9),h=r(3),d=function(e){function t(t,r,n,i){void 0===i&&(i={});var o=this;if(i.extraHeaders=(i.extraHeaders||[]).slice(),i.contentType=i.contentType||"text/plain","number"!=typeof i.expires||i.expires%1!=0?i.expires=3600:i.expires=Number(i.expires),"boolean"!=typeof i.unpublishOnClose&&(i.unpublishOnClose=!0),null==r||""===r)throw new c.Exceptions.MethodParameterError("Publish","Target",r);if(void 0===(r=t.normalizeTarget(r)))throw new c.Exceptions.MethodParameterError("Publish","Target",r);if((o=e.call(this,t,s.C.PUBLISH,r,i)||this).type=a.TypeStrings.PublishContext,o.options=i,o.target=r,null==n||""===n)throw new c.Exceptions.MethodParameterError("Publish","Event",n);return o.event=n,o.logger=t.getLogger("sip.publish"),o.pubRequestExpires=o.options.expires,t.on("transportCreated",function(e){e.on("transportError",function(){return o.onTransportError()})}),o}return i(t,e),t.prototype.publish=function(e){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.options.body=e,this.pubRequestBody=this.options.body,0===this.pubRequestExpires&&(this.pubRequestExpires=this.options.expires,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]||(this.ua.publishers[this.target.toString()+":"+this.event]=this),this.sendPublishRequest()},t.prototype.unpublish=function(){this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,void 0!==this.pubRequestEtag&&this.sendPublishRequest()},t.prototype.close=function(){this.options.unpublishOnClose?this.unpublish():(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestExpires=0,this.pubRequestEtag=void 0),this.ua.publishers[this.target.toString()+":"+this.event]&&delete this.ua.publishers[this.target.toString()+":"+this.event]},t.prototype.onRequestTimeout=function(){e.prototype.onRequestTimeout.call(this),this.emit("unpublished",void 0,s.C.causes.REQUEST_TIMEOUT)},t.prototype.onTransportError=function(){e.prototype.onTransportError.call(this),this.emit("unpublished",void 0,s.C.causes.CONNECTION_ERROR)},t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode||0,n=h.Utils.getReasonPhrase(r);switch(!0){case/^1[0-9]{2}$/.test(r.toString()):this.emit("progress",e,n);break;case/^2[0-9]{2}$/.test(r.toString()):if(e.hasHeader("SIP-ETag")?this.pubRequestEtag=e.getHeader("SIP-ETag"):this.logger.warn("SIP-ETag header missing in a 200-class response to PUBLISH"),e.hasHeader("Expires")){var i=Number(e.getHeader("Expires"));"number"==typeof i&&i>=0&&i<=this.pubRequestExpires?this.pubRequestExpires=i:this.logger.warn("Bad Expires header in a 200-class response to PUBLISH")}else this.logger.warn("Expires header missing in a 200-class response to PUBLISH");0!==this.pubRequestExpires?(this.publishRefreshTimer=setTimeout(function(){return t.refreshRequest()},900*this.pubRequestExpires),this.emit("published",e,n)):this.emit("unpublished",e,n);break;case/^412$/.test(r.toString()):void 0!==this.pubRequestEtag&&0!==this.pubRequestExpires?(this.logger.warn("412 response to PUBLISH, recovering"),this.pubRequestEtag=void 0,this.emit("progress",e,n),this.publish(this.options.body)):(this.logger.warn("412 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n));break;case/^423$/.test(r.toString()):if(0!==this.pubRequestExpires&&e.hasHeader("Min-Expires")){var o=Number(e.getHeader("Min-Expires"));"number"==typeof o||o>this.pubRequestExpires?(this.logger.warn("423 code in response to PUBLISH, adjusting the Expires value and trying to recover"),this.pubRequestExpires=o,this.emit("progress",e,n),this.publish(this.options.body)):(this.logger.warn("Bad 423 response Min-Expires header received for PUBLISH"),this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n))}else this.logger.warn("423 response to PUBLISH, recovery failed"),this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n);break;default:this.pubRequestExpires=0,this.emit("failed",e,n),this.emit("unpublished",e,n)}0===this.pubRequestExpires&&(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,this.pubRequestEtag=void 0)},t.prototype.refreshRequest=function(){if(this.publishRefreshTimer&&(clearTimeout(this.publishRefreshTimer),this.publishRefreshTimer=void 0),this.pubRequestBody=void 0,void 0===this.pubRequestEtag)throw new c.Exceptions.MethodParameterError("Publish","Body",void 0);if(0===this.pubRequestExpires)throw new c.Exceptions.MethodParameterError("Publish","Expire",this.pubRequestExpires);this.sendPublishRequest()},t.prototype.sendPublishRequest=function(){var e=Object.create(this.options||Object.prototype);e.extraHeaders=(this.options.extraHeaders||[]).slice(),e.extraHeaders.push("Event: "+this.event),e.extraHeaders.push("Expires: "+this.pubRequestExpires),void 0!==this.pubRequestEtag&&e.extraHeaders.push("SIP-If-Match: "+this.pubRequestEtag),this.request=new u.OutgoingRequest(s.C.PUBLISH,this.target,this.ua,this.options.params,e.extraHeaders),void 0!==this.pubRequestBody&&(this.request.body={body:this.pubRequestBody,contentType:this.options.contentType}),this.send()},t}(o.ClientContext);t.PublishContext=d},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=r(11),a=r(2),c=r(0),u=r(6),h=r(7),d=r(3);function p(e){var t={expires:600,extraContactHeaderParams:[],instanceId:void 0,params:{},regId:void 0,registrar:void 0},r={mandatory:{},optional:{expires:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},extraContactHeaderParams:function(e){if(e instanceof Array)return e.filter(function(e){return"string"==typeof e})},instanceId:function(e){if("string"==typeof e)return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===h.Grammar.parse(e,"uuid")?void 0:e},params:function(e){if("object"==typeof e)return e},regId:function(e){if(d.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},registrar:function(e){if("string"==typeof e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=h.Grammar.URIParse(e);return t?t.user?void 0:t:void 0}}}};for(var n in r.mandatory){if(!e.hasOwnProperty(n))throw new u.Exceptions.ConfigurationError(n);var i=e[n];if(void 0===(o=r.mandatory[n](i)))throw new u.Exceptions.ConfigurationError(n,i);t[n]=o}for(var n in r.optional)if(e.hasOwnProperty(n)){var o;if((i=e[n])instanceof Array&&0===i.length)continue;if(null===i||""===i||void 0===i||"number"==typeof i&&isNaN(i))continue;if(void 0===(o=r.optional[n](i)))throw new u.Exceptions.ConfigurationError(n,i);t[n]=o}return t}var l=function(e){function t(t,r){void 0===r&&(r={});var n=this,i=p(r);if(i.regId&&!i.instanceId?i.instanceId=d.Utils.newUUID():!i.regId&&i.instanceId&&(i.regId=1),i.params.toUri=i.params.toUri||t.configuration.uri,i.params.toDisplayName=i.params.toDisplayName||t.configuration.displayName,i.params.callId=i.params.callId||d.Utils.createRandomToken(22),i.params.cseq=i.params.cseq||Math.floor(1e4*Math.random()),!i.registrar){var o={};"object"==typeof t.configuration.uri?(o=t.configuration.uri.clone()).user=void 0:o=t.configuration.uri,i.registrar=o}for(var s in(n=e.call(this,t,a.C.REGISTER,i.registrar,i)||this).type=c.TypeStrings.RegisterContext,n.options=i,n.logger=t.getLogger("sip.registercontext"),n.logger.log("configuration parameters for RegisterContext after validation:"),i)i.hasOwnProperty(s)&&n.logger.log("· "+s+": "+JSON.stringify(i[s]));return n.expires=i.expires,n.cseq=i.params.cseq,n.contact=t.contact.toString(),n.registered=!1,t.on("transportCreated",function(e){e.on("disconnected",function(){return n.onTransportDisconnected()})}),n}return i(t,e),t.prototype.register=function(e){var t=this;void 0===e&&(e={}),this.options=o({},this.options,e);var r=(this.options.extraHeaders||[]).slice();r.push("Contact: "+this.generateContactHeader(this.expires)),r.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.closeHeaders=this.options.closeWithHeaders?(this.options.extraHeaders||[]).slice():[],this.receiveResponse=function(e){if(e.cseq===t.cseq){void 0!==t.registrationTimer&&(clearTimeout(t.registrationTimer),t.registrationTimer=void 0);var r=(e.statusCode||0).toString();switch(!0){case/^1[0-9]{2}$/.test(r):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(r):t.emit("accepted",e);var n=void 0;e.hasHeader("expires")&&(n=Number(e.getHeader("expires"))),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0);var i=e.getHeaders("contact").length;if(!i){t.logger.warn("no Contact header in response to REGISTER, response ignored");break}for(var o=void 0;i--;){if((o=e.parseHeader("contact",i)).uri.user===t.ua.contact.uri.user){n=o.getParam("expires");break}o=void 0}if(!o){t.logger.warn("no Contact header pointing to us, response ignored");break}void 0===n&&(n=t.expires),t.registrationTimer=setTimeout(function(){t.registrationTimer=void 0,t.register(t.options)},1e3*n-3e3),t.registrationExpiredTimer=setTimeout(function(){t.logger.warn("registration expired"),t.registered&&t.unregistered(void 0,a.C.causes.EXPIRES)},1e3*n),o.hasParam("temp-gruu")&&(t.ua.contact.tempGruu=h.Grammar.URIParse(o.getParam("temp-gruu").replace(/"/g,""))),o.hasParam("pub-gruu")&&(t.ua.contact.pubGruu=h.Grammar.URIParse(o.getParam("pub-gruu").replace(/"/g,""))),t.registered=!0,t.emit("registered",e||void 0);break;case/^423$/.test(r):e.hasHeader("min-expires")?(t.expires=Number(e.getHeader("min-expires")),t.register(t.options)):(t.logger.warn("423 response received for REGISTER without Min-Expires"),t.registrationFailure(e,a.C.causes.SIP_FAILURE_CODE));break;default:t.registrationFailure(e,d.Utils.sipErrorCause(e.statusCode||0))}}},this.onRequestTimeout=function(){t.registrationFailure(void 0,a.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){t.registrationFailure(void 0,a.C.causes.CONNECTION_ERROR)},this.cseq++,this.request&&(this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=r),this.send()},t.prototype.close=function(){var e={all:!1,extraHeaders:this.closeHeaders};this.registeredBefore=this.registered,this.registered&&this.unregister(e)},t.prototype.unregister=function(e){var t=this;void 0===e&&(e={}),this.registered||e.all||this.logger.warn("Already unregistered, but sending an unregister anyways.");var r=(e.extraHeaders||[]).slice();this.registered=!1,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),e.all?(r.push("Contact: *"),r.push("Expires: 0")):r.push("Contact: "+this.generateContactHeader(0)),this.receiveResponse=function(e){var r=e&&e.statusCode?e.statusCode.toString():"";switch(!0){case/^1[0-9]{2}$/.test(r):t.emit("progress",e);break;case/^2[0-9]{2}$/.test(r):t.emit("accepted",e),void 0!==t.registrationExpiredTimer&&(clearTimeout(t.registrationExpiredTimer),t.registrationExpiredTimer=void 0),t.unregistered(e);break;default:t.unregistered(e,d.Utils.sipErrorCause(e.statusCode||0))}},this.onRequestTimeout=function(){},this.cseq++,this.request&&(this.request.cseq=this.cseq,this.request.setHeader("cseq",this.cseq+" REGISTER"),this.request.extraHeaders=r),this.send()},t.prototype.unregistered=function(e,t){this.registered=!1,this.emit("unregistered",e||void 0,t||void 0)},t.prototype.registrationFailure=function(e,t){this.emit("failed",e||void 0,t||void 0)},t.prototype.onTransportDisconnected=function(){this.registeredBefore=this.registered,void 0!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=void 0),void 0!==this.registrationExpiredTimer&&(clearTimeout(this.registrationExpiredTimer),this.registrationExpiredTimer=void 0),this.registered&&this.unregistered(void 0,a.C.causes.CONNECTION_ERROR)},t.prototype.generateContactHeader=function(e){void 0===e&&(e=0);var t=this.contact;return this.options.regId&&this.options.instanceId&&(t+=";reg-id="+this.options.regId,t+=';+sip.instance="<urn:uuid:'+this.options.instanceId+'>"'),this.options.extraContactHeaderParams&&this.options.extraContactHeaderParams.forEach(function(e){t+=";"+e}),t+=";expires="+e},t}(s.ClientContext);t.RegisterContext=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=r(0),o=r(3);!function(e){function t(e,t,r){for(var n=o.Utils.buildStatusLine(e),i=0,s=t.getHeaders("via");i<s.length;i++){n+="Via: "+s[i]+"\r\n"}var a=t.getHeader("To")||"";t.toTag||(a+=";tag="+o.Utils.newTag()),n+="To: "+a+"\r\n",n+="From: "+t.getHeader("From")+"\r\n",n+="Call-ID: "+t.callId+"\r\n",n+="CSeq: "+t.cseq+" "+t.method+"\r\n",n+="\r\n",r.send(n)}function r(e,r,n){return!(!e.ruri||"sip"!==e.ruri.scheme)||(t(416,e,n),!1)}function s(e,r,n){return!(!e.toTag&&e.callId.substr(0,5)===r.configuration.sipjsId)||(t(482,e,n),!1)}function a(e,r,n){var i=o.Utils.str_utf8_length(e.body),s=e.getHeader("content-length");return!(s&&i<Number(s))||(t(400,e,n),!1)}function c(e,r,i){var o=e.fromTag,s=e.callId,a=e.cseq;if(!e.toTag)if(e.method===n.C.INVITE){if(r.transactions.ist[e.viaBranch])return!0;for(var c in r.transactions.ist){if(r.transactions.ist.hasOwnProperty(c))if((u=r.transactions.ist[c])&&u.request.fromTag===o&&u.request.callId===s&&u.request.cseq===a)return t(482,e,i),!1}}else{if(r.transactions.nist[e.viaBranch])return!0;for(var c in r.transactions.nist){var u;if(r.transactions.nist.hasOwnProperty(c))if((u=r.transactions.nist[c])&&u.request.fromTag===o&&u.request.callId===s&&u.request.cseq===a)return t(482,e,i),!1}}return!0}function u(e,t){return!(e.getHeaders("via").length>1)||(t.getLogger("sip.sanitycheck").warn("More than one Via header field present in the response. Dropping the response"),!1)}function h(e,t){return e.via.host===t.configuration.viaHost&&void 0===e.via.port||(t.getLogger("sip.sanitycheck").warn("Via sent-by in the response does not match UA Via host value. Dropping the response"),!1)}function d(e,t){var r=o.Utils.str_utf8_length(e.body),n=e.getHeader("content-length");return!(n&&r<Number(n))||(t.getLogger("sip.sanitycheck").warn("Message body length is lower than the value in Content-Length header field. Dropping the response"),!1)}function p(e,t){for(var r=0,n=["from","to","call_id","cseq","via"];r<n.length;r++){var i=n[r];if(!e.hasHeader(i))return t.getLogger("sip.sanitycheck").warn("Missing mandatory header field : "+i+". Dropping the response"),!1}return!0}e.reply=t,e.rfc3261_8_2_2_1=r,e.rfc3261_16_3_4=s,e.rfc3261_18_3_request=a,e.rfc3261_8_2_2_2=c,e.rfc3261_8_1_3_3=u,e.rfc3261_18_1_2=h,e.rfc3261_18_3_response=d,e.minimumHeaders=p,e.sanityCheck=function(e,t,n){for(var o=[r,s,a,c],l=[u,h,d],f=0,g=[p];f<g.length;f++)if(!(0,g[f])(e,t,n))return!1;if(e.type===i.TypeStrings.IncomingRequest){for(var m=0,v=o;m<v.length;m++)if(!(0,v[m])(e,t,n))return!1}else if(e.type===i.TypeStrings.IncomingResponse)for(var y=0,T=l;y<T.length;y++)if(!(0,T[y])(e,t,n))return!1;return!0}}(t.SanityCheck||(t.SanityCheck={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(11),s=r(2),a=r(21),c=r(0),u=r(16),h=r(3),d=function(e){function t(t,r,n,i){void 0===i&&(i={});var o,a=this;if(!n)throw new TypeError("Event necessary to create a subscription.");return i.extraHeaders=(i.extraHeaders||[]).slice(),"number"!=typeof i.expires?(t.logger.warn("expires must be a number. Using default of 3600."),o=3600):o=i.expires,i.extraHeaders.push("Event: "+n),i.extraHeaders.push("Expires: "+o),i.extraHeaders.push("Contact: "+t.contact.toString()),i.extraHeaders.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),(a=e.call(this,t,s.C.SUBSCRIBE,r,i)||this).type=c.TypeStrings.Subscription,a.event=n,a.requestedExpires=o,a.state="init",a.contact=t.contact.toString(),a.extraHeaders=i.extraHeaders,a.logger=t.getLogger("sip.subscription"),a.expires=o,a.timers={N:void 0,subDuration:void 0},a.errorCodes=[404,405,410,416,480,481,482,483,484,485,489,501,604],a}return i(t,e),t.prototype.subscribe=function(){var e=this;return"active"===this.state?(this.refresh(),this):"notify_wait"===this.state?this:(clearTimeout(this.timers.subDuration),clearTimeout(this.timers.N),this.timers.N=setTimeout(function(){return e.timer_fire()},u.Timers.TIMER_N),this.request&&this.request.from&&(this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event]=this),this.send(),this.state="notify_wait",this)},t.prototype.refresh=function(){"terminated"!==this.state&&"pending"!==this.state&&"notify_wait"!==this.state&&this.dialog&&this.dialog.sendRequest(this,s.C.SUBSCRIBE,{extraHeaders:this.extraHeaders,body:this.body})},t.prototype.receiveResponse=function(e){var t=this,r=e.statusCode?e.statusCode:0,n=h.Utils.getReasonPhrase(r);if("notify_wait"===this.state&&r>=300||"notify_wait"!==this.state&&-1!==this.errorCodes.indexOf(r))this.failed(e,void 0);else if(/^2[0-9]{2}$/.test(r.toString())){this.emit("accepted",e,n);var i=e.getHeader("Expires");i&&Number(i)<=this.requestedExpires?(this.expires=Number(i),this.timers.subDuration=setTimeout(function(){return t.refresh()},900*Number(i))):i?(this.logger.warn("Expires header in a 200-class response to SUBSCRIBE with a higher value than the one in the request"),this.failed(e,"Invalid Expires Header")):(this.logger.warn("Expires header missing in a 200-class response to SUBSCRIBE"),this.failed(e,"Expires Header Missing"))}else r>300&&(this.emit("failed",e,n),this.emit("rejected",e,n))},t.prototype.unsubscribe=function(){var e=this,t=[];this.state="terminated",t.push("Event: "+this.event),t.push("Expires: 0"),t.push("Contact: "+this.contact),t.push("Allow: "+["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"].toString()),this.receiveResponse=function(){},this.dialog&&this.dialog.sendRequest(this,s.C.SUBSCRIBE,{extraHeaders:t,body:this.body}),clearTimeout(this.timers.subDuration),clearTimeout(this.timers.N),this.timers.N=setTimeout(function(){return e.timer_fire()},u.Timers.TIMER_N),this.emit("terminated")},t.prototype.receiveRequest=function(e){var t,r=this,n=function(){t.expires&&(clearTimeout(r.timers.subDuration),t.expires=Math.min(r.expires,Math.max(t.expires,0)),r.timers.subDuration=setTimeout(function(){return r.refresh()},900*t.expires))};if(this.matchEvent(e))if(this.dialog||this.createConfirmedDialog(e,"UAS")&&this.dialog&&(this.id=this.dialog.id.toString(),this.request&&this.request.from&&(delete this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event],this.ua.subscriptions[this.id||""]=this)),t=e.parseHeader("Subscription-State"),e.reply(200),clearTimeout(this.timers.N),this.emit("notify",{request:e}),"terminated"!==this.state)switch(t.state){case"active":this.state="active",n();break;case"pending":"notify_wait"===this.state&&n(),this.state="pending";break;case"terminated":if(clearTimeout(this.timers.subDuration),t.reason)switch(this.logger.log("terminating subscription with reason "+t.reason),t.reason){case"deactivated":case"timeout":return void this.subscribe();case"probation":case"giveup":return void(t.params&&t.params["retry-after"]?this.timers.subDuration=setTimeout(function(){return r.subscribe()},t.params["retry-after"]):this.subscribe())}this.close()}else"terminated"===t.state&&(this.terminateDialog(),clearTimeout(this.timers.N),clearTimeout(this.timers.subDuration),delete this.ua.subscriptions[this.id||""]);else e.reply(489)},t.prototype.close=function(){"notify_wait"===this.state?(this.state="terminated",clearTimeout(this.timers.N),clearTimeout(this.timers.subDuration),this.receiveResponse=function(){},this.request&&this.request.from&&delete this.ua.earlySubscriptions[this.request.callId+this.request.from.parameters.tag+this.event],this.emit("terminated")):"terminated"!==this.state&&this.unsubscribe()},t.prototype.onDialogError=function(e){this.failed(e,s.C.causes.DIALOG_ERROR)},t.prototype.on=function(t,r){return e.prototype.on.call(this,t,r)},t.prototype.timer_fire=function(){"terminated"===this.state?(this.terminateDialog(),clearTimeout(this.timers.N),clearTimeout(this.timers.subDuration),delete this.ua.subscriptions[this.id||""]):"notify_wait"===this.state||"pending"===this.state?this.close():this.refresh()},t.prototype.createConfirmedDialog=function(e,t){this.terminateDialog();var r=new a.Dialog(this,e,t);return this.request&&(r.inviteSeqnum=this.request.cseq,r.localSeqnum=this.request.cseq),!r.error&&(this.dialog=r,!0)},t.prototype.terminateDialog=function(){this.dialog&&(delete this.ua.subscriptions[this.id||""],this.dialog.terminate(),delete this.dialog)},t.prototype.failed=function(e,t){return this.close(),this.emit("failed",e,t),this.emit("rejected",e,t),this},t.prototype.matchEvent=function(e){if(!e.hasHeader("Event"))return this.logger.warn("missing Event header"),!1;if(!e.hasHeader("Subscription-State"))return this.logger.warn("missing Subscription-State header"),!1;var t=e.parseHeader("event").event;return this.event===t||(this.logger.warn("event match failed"),e.reply(481,"Event Match Failed"),!1)},t}(o.ClientContext);t.Subscription=d},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),s=r(0),a=function(e){function t(t,r){var n=e.call(this)||this;return n.type=s.TypeStrings.Transport,n.logger=t,n}return i(t,e),t.prototype.connect=function(e){var t=this;return void 0===e&&(e={}),this.connectPromise(e).then(function(e){e.overrideEvent||t.emit("connected")})},t.prototype.send=function(e,t){var r=this;return void 0===t&&(t={}),this.sendPromise(e).then(function(e){e.overrideEvent||r.emit("messageSent",e.msg)})},t.prototype.disconnect=function(e){var t=this;return void 0===e&&(e={}),this.disconnectPromise(e).then(function(e){e.overrideEvent||t.emit("disconnected")})},t.prototype.afterConnected=function(e){this.isConnected()?e():this.once("connected",e)},t.prototype.waitForConnected=function(){var e=this;return console.warn("DEPRECATION WARNING Transport.waitForConnected(): use afterConnected() instead"),new Promise(function(t){e.afterConnected(t)})},t}(o.EventEmitter);t.Transport=a},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),s=r(11),a=r(2),c=r(32),u=r(0),h=r(6),d=r(7),p=r(33),l=r(34),f=r(35),g=r(36),m=r(37),v=r(22),y=r(14),T=r(9),C=r(38),S=r(8),A=r(17),b=r(3),E=r(41),w=r(42),_=e.window||e,R=function(t){function r(e){var n=t.call(this)||this;if(n.type=u.TypeStrings.UA,n.log=new p.LoggerFactory,n.logger=n.getLogger("sip.ua"),n.cache={credentials:{}},n.configuration={},n.dialogs={},n.applicants={},n.data={},n.sessions={},n.subscriptions={},n.earlySubscriptions={},n.publishers={},n.status=u.UAStatus.STATUS_INIT,n.transactions={nist:{},nict:{},ist:{},ict:{}},void 0===e?e={}:("string"==typeof e||e instanceof String)&&(e={uri:e}),e.log&&(e.log.hasOwnProperty("builtinEnabled")&&(n.log.builtinEnabled=e.log.builtinEnabled),e.log.hasOwnProperty("connector")&&(n.log.connector=e.log.connector),e.log.hasOwnProperty("level"))){var i=e.log.level,o="string"==typeof i?p.Levels[i]:i;o?n.log.level=o:n.logger.error('Invalid "level" parameter value: '+JSON.stringify(i))}try{n.loadConfig(e)}catch(e){throw n.status=u.UAStatus.STATUS_NOT_READY,n.error=r.C.CONFIGURATION_ERROR,e}return n.registerContext=new g.RegisterContext(n,e.registerOptions),n.registerContext.on("failed",n.emit.bind(n,"registrationFailed")),n.registerContext.on("registered",n.emit.bind(n,"registered")),n.registerContext.on("unregistered",n.emit.bind(n,"unregistered")),n.configuration.autostart&&n.start(),n}return i(r,t),Object.defineProperty(r.prototype,"transactionsCount",{get:function(){for(var e=0,t=0,r=["nist","nict","ist","ict"];t<r.length;t++){var n=r[t];e+=Object.keys(this.transactions[n]).length}return e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"nictTransactionsCount",{get:function(){return Object.keys(this.transactions.nict).length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"nistTransactionsCount",{get:function(){return Object.keys(this.transactions.nist).length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ictTransactionsCount",{get:function(){return Object.keys(this.transactions.ict).length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"istTransactionsCount",{get:function(){return Object.keys(this.transactions.ist).length},enumerable:!0,configurable:!0}),r.prototype.register=function(e){return void 0===e&&(e={}),e.register&&(this.configuration.register=!0),this.registerContext.register(e),this},r.prototype.unregister=function(e){var t=this;return this.configuration.register=!1,this.transport&&this.transport.afterConnected(function(){t.registerContext.unregister(e)}),this},r.prototype.isRegistered=function(){return this.registerContext.registered},r.prototype.invite=function(e,t,r){var n=this,i=new y.InviteClientContext(this,e,t,r);return this.transport&&this.transport.afterConnected(function(){i.invite(),n.emit("inviteSent",i)}),i},r.prototype.subscribe=function(e,t,r){var n=new C.Subscription(this,e,t,r);return this.transport&&this.transport.afterConnected(function(){return n.subscribe()}),n},r.prototype.publish=function(e,t,r,n){var i=new f.PublishContext(this,e,t,n);return this.transport&&this.transport.afterConnected(function(){i.publish(r)}),i},r.prototype.message=function(e,t,r){if(void 0===r&&(r={}),void 0===t)throw new TypeError("Not enough arguments");return r.contentType=r.contentType||"text/plain",r.body=t,this.request(a.C.MESSAGE,e,r)},r.prototype.request=function(e,t,r){var n=new s.ClientContext(this,e,t,r);return this.transport&&this.transport.afterConnected(function(){return n.send()}),n},r.prototype.stop=function(){var t=this;if(this.logger.log("user requested closure..."),this.status===u.UAStatus.STATUS_USER_CLOSED)return this.logger.warn("UA already closed"),this;for(var r in this.logger.log("closing registerContext"),this.registerContext.close(),this.sessions)this.sessions[r]&&(this.logger.log("closing session "+r),this.sessions[r].terminate());for(var n in this.subscriptions)this.subscriptions[n]&&(this.logger.log("unsubscribing from subscription "+n),this.subscriptions[n].close());for(var i in this.earlySubscriptions)this.earlySubscriptions[i]&&(this.logger.log("unsubscribing from early subscription "+i),this.earlySubscriptions[i].close());for(var o in this.publishers)this.publishers[o]&&(this.logger.log("unpublish "+o),this.publishers[o].close());for(var s in this.applicants)this.applicants[s]&&this.applicants[s].close();if(this.status=u.UAStatus.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&this.transport)this.transport.disconnect();else{var a=function(){0===t.nistTransactionsCount&&0===t.nictTransactionsCount&&(t.removeListener("transactionDestroyed",a),t.transport&&t.transport.disconnect())};this.on("transactionDestroyed",a)}return"function"==typeof _.removeEventListener&&(e.chrome&&e.chrome.app&&e.chrome.app.runtime||_.removeEventListener("unload",this.environListener)),this},r.prototype.start=function(){var t=this;if(this.logger.log("user requested startup..."),this.status===u.UAStatus.STATUS_INIT){if(this.status=u.UAStatus.STATUS_STARTING,!this.configuration.transportConstructor)throw new h.Exceptions.TransportError("Transport constructor not set");this.transport=new this.configuration.transportConstructor(this.getLogger("sip.transport"),this.configuration.transportOptions),this.setTransportListeners(),this.emit("transportCreated",this.transport),this.transport.connect()}else this.status===u.UAStatus.STATUS_USER_CLOSED?(this.logger.log("resuming"),this.status=u.UAStatus.STATUS_READY,this.transport&&this.transport.connect()):this.status===u.UAStatus.STATUS_STARTING?this.logger.log("UA is in STARTING status, not opening new connection"):this.status===u.UAStatus.STATUS_READY?this.logger.log("UA is in READY status, not resuming"):this.logger.error("Connection is down. Auto-Recovery system is trying to connect");return this.configuration.autostop&&"function"==typeof _.addEventListener&&(e.chrome&&e.chrome.app&&e.chrome.app.runtime||(this.environListener=this.stop,_.addEventListener("unload",function(){return t.environListener()}))),this},r.prototype.normalizeTarget=function(e){return b.Utils.normalizeTarget(e,this.configuration.hostportParams)},r.prototype.getLogger=function(e,t){return this.log.getLogger(e,t)},r.prototype.getLoggerFactory=function(){return this.log},r.prototype.newTransaction=function(e){this.transactions[e.kind][e.id]=e,this.emit("newTransaction",{transaction:e})},r.prototype.destroyTransaction=function(e){delete this.transactions[e.kind][e.id],this.emit("transactionDestroyed",{transaction:e})},r.prototype.findSession=function(e){return this.sessions[e.callId+e.fromTag]||this.sessions[e.callId+e.toTag]||void 0},r.prototype.on=function(e,r){return t.prototype.on.call(this,e,r)},r.prototype.saveCredentials=function(e){return this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e,this},r.prototype.getCredentials=function(e){var t=e.ruri.type===u.TypeStrings.URI?e.ruri.host:"";if(t&&this.cache.credentials[t]&&this.cache.credentials[t][e.ruri.toString()]){var r=this.cache.credentials[t][e.ruri.toString()];return r.method=e.method,r}},r.prototype.onTransportError=function(){this.status!==u.UAStatus.STATUS_USER_CLOSED&&(this.error&&this.error===r.C.NETWORK_ERROR||(this.status=u.UAStatus.STATUS_NOT_READY,this.error=r.C.NETWORK_ERROR))},r.prototype.setTransportListeners=function(){var e=this;this.transport&&(this.transport.on("connected",function(){return e.onTransportConnected()}),this.transport.on("message",function(t){return e.onTransportReceiveMsg(t)}),this.transport.on("transportError",function(){return e.onTransportError()}))},r.prototype.onTransportConnected=function(){var e=this;this.configuration.register&&Promise.resolve().then(function(){return e.registerContext.register()})},r.prototype.onTransportReceiveMsg=function(e){var t=l.Parser.parseMessage(e,this);if(t)if(this.status===u.UAStatus.STATUS_USER_CLOSED&&t instanceof T.IncomingRequest)this.logger.warn("UA received message when status = USER_CLOSED - aborting");else if(this.transport){if(m.SanityCheck.sanityCheck(t,this,this.transport))if(t instanceof T.IncomingRequest)this.receiveRequestFromTransport(t);else{if(!(t instanceof T.IncomingResponse))throw new Error("Invalid message type.");this.receiveResponseFromTransport(t)}}else this.logger.warn("UA received message without transport - aborting");else this.logger.warn("UA failed to parse incoming SIP message - discarding.")},r.prototype.receiveRequestFromTransport=function(e){if(e.transport=this.transport,!(this.configuration.uri instanceof A.URI))throw new Error("Configuration URI not instance of URI.");if(!e.ruri)throw new Error("Request ruri undefined.");if(e.ruri.scheme===a.C.SIP){var t=e.ruri,r=function(e){return!!e&&e.user===t.user};if(!r(this.configuration.uri)&&!(r(this.contact.uri)||r(this.contact.pubGruu)||r(this.contact.tempGruu)))return this.logger.warn("Request-URI does not point to us"),void(e.method!==a.C.ACK&&e.reply_sl(404));var n=this.transactions.ist[e.viaBranch],i=this.transactions.nist[e.viaBranch];e.method!==a.C.CANCEL?e.method===a.C.ACK&&n&&n.state===S.TransactionState.Accepted?this.receiveRequest(e):n?n.receiveRequest(e):i?i.receiveRequest(e):this.receiveRequest(e):n||i?(e.reply_sl(200),n&&n.state===S.TransactionState.Proceeding&&this.receiveRequest(e)):e.reply_sl(481)}else e.reply_sl(416)},r.prototype.receiveResponseFromTransport=function(e){var t;switch(e.method){case a.C.INVITE:t=this.transactions.ict[e.viaBranch];break;case a.C.ACK:break;default:t=this.transactions.nict[e.viaBranch]}if(t)e.transaction=t,t.receiveResponse(e);else{var r="Discarding unmatched "+e.statusCode+" response to "+e.method+" "+e.viaBranch+".";this.logger.warn(r)}},r.prototype.receiveRequest=function(e){var t,n=this,i=e.method;if(i===a.C.OPTIONS){if(!(h=this.transport))throw new Error("Transport undefined.");var o={loggerFactory:this.getLoggerFactory(),onStateChange:function(e){e===S.TransactionState.Terminated&&n.destroyTransaction(s)},onTransportError:function(e){n.logger.error(e.message)}},s=new S.NonInviteServerTransaction(e,h,o);this.newTransaction(s),e.reply(200,void 0,["Allow: "+r.C.ALLOWED_METHODS.toString(),"Accept: "+r.C.ACCEPTED_BODY_TYPES.toString()])}else i===a.C.MESSAGE?((t=new v.ServerContext(this,e)).body=e.body,t.contentType=e.getHeader("Content-Type")||"text/plain",e.reply(200,void 0),this.emit("message",t)):i!==a.C.INVITE&&i!==a.C.ACK&&(t=new v.ServerContext(this,e));if(e.toTag){var c=this.findDialog(e);if(c){if(i===a.C.INVITE){var h;if(!(h=this.transport))throw new Error("Transport undefined.");o={loggerFactory:this.log,onStateChange:function(e){e===S.TransactionState.Terminated&&n.destroyTransaction(d)},onTransportError:function(e){n.logger.error(e.message),c.owner.onTransportError()}};var d=new S.InviteServerTransaction(e,h,o);this.newTransaction(d)}c.receiveRequest(e)}else if(i===a.C.NOTIFY){m=this.findSession(e);var p=this.findEarlySubscription(e);m?m.receiveRequest(e):p?p.receiveRequest(e):(this.logger.warn("received NOTIFY request for a non existent session or subscription"),e.reply(481,"Subscription does not exist"))}else i!==a.C.ACK&&e.reply(481)}else switch(i){case a.C.INVITE:var l=this.configuration.replaces!==a.C.supported.UNSUPPORTED&&e.parseHeader("replaces"),f=void 0;if(l){if(!(f=this.dialogs[l.call_id+l.replaces_to_tag+l.replaces_from_tag]))return void e.reply_sl(481,void 0);if(f.owner.type!==u.TypeStrings.Subscription&&f.owner.status===u.SessionStatus.STATUS_TERMINATED)return void e.reply_sl(603,void 0);if(f.state===u.DialogStatus.STATUS_CONFIRMED&&l.earlyOnly)return void e.reply_sl(486,void 0)}var g=new y.InviteServerContext(this,e);f&&f.owner.type!==u.TypeStrings.Subscription&&(g.replacee=f&&f.owner),this.emit("invite",g);break;case a.C.BYE:e.reply(481);break;case a.C.CANCEL:var m;(m=this.findSession(e))?m.receiveRequest(e):this.logger.warn("received CANCEL request for a non existent session");break;case a.C.ACK:break;case a.C.NOTIFY:this.configuration.allowLegacyNotifications&&this.listeners("notify").length>0?(e.reply(200,void 0),this.emit("notify",{request:e})):e.reply(481,"Subscription does not exist");break;case a.C.REFER:if(this.logger.log("Received an out of dialog refer"),this.configuration.allowOutOfDialogRefers){this.logger.log("Allow out of dialog refers is enabled on the UA");var T=new y.ReferServerContext(this,e);this.listeners("outOfDialogReferRequested").length?this.emit("outOfDialogReferRequested",T):(this.logger.log("No outOfDialogReferRequest listeners, automatically accepting and following the out of dialog refer"),T.accept({followRefer:!0}));break}e.reply(405);break;default:e.reply(405)}},r.prototype.findDialog=function(e){return this.dialogs[e.callId+e.fromTag+e.toTag]||this.dialogs[e.callId+e.toTag+e.fromTag]||void 0},r.prototype.findEarlySubscription=function(e){return this.earlySubscriptions[e.callId+e.toTag+e.getHeader("event")]||void 0},r.prototype.checkAuthenticationFactory=function(e){if(e instanceof Function)return e.initialize||(e.initialize=function(){return Promise.resolve()}),e},r.prototype.loadConfig=function(e){var t=this,r={viaHost:b.Utils.createRandomToken(12)+".invalid",uri:new A.URI("sip","anonymous."+b.Utils.createRandomToken(6),"anonymous.invalid",void 0,void 0),custom:{},displayName:"",password:void 0,register:!0,registerOptions:{},transportConstructor:w.Transport,transportOptions:{},userAgentString:a.C.USER_AGENT,noAnswerTimeout:60,hackViaTcp:!1,hackIpInContact:!1,hackWssInTransport:!1,hackAllowUnregisteredOptionTags:!1,sessionDescriptionHandlerFactoryOptions:{constraints:{},peerConnectionOptions:{}},extraSupported:[],contactName:b.Utils.createRandomToken(8),contactTransport:"ws",forceRport:!1,autostart:!0,autostop:!0,rel100:a.C.supported.UNSUPPORTED,dtmfType:a.C.dtmfType.INFO,replaces:a.C.supported.UNSUPPORTED,sessionDescriptionHandlerFactory:E.SessionDescriptionHandler.defaultFactory,authenticationFactory:this.checkAuthenticationFactory(function(e){return new c.DigestAuthentication(e)}),allowLegacyNotifications:!1,allowOutOfDialogRefers:!1},n=this.getConfigurationCheck();for(var i in n.mandatory){if(!e.hasOwnProperty(i))throw new h.Exceptions.ConfigurationError(i);var o=e[i];if(void 0===(s=n.mandatory[i](o)))throw new h.Exceptions.ConfigurationError(i,o);r[i]=s}for(var i in n.optional)if(e.hasOwnProperty(i)){var s;if((o=e[i])instanceof Array&&0===o.length||null===o||""===o||void 0===o||"number"==typeof o&&isNaN(o))continue;if(void 0===(s=n.optional[i](o)))throw new h.Exceptions.ConfigurationError(i,o);r[i]=s}0===r.displayName&&(r.displayName="0"),r.sipjsId=b.Utils.createRandomToken(5);var u=r.uri.clone();if(u.user=void 0,r.hostportParams=u.toRaw().replace(/^sip:/i,""),r.authorizationUser||(r.authorizationUser=r.uri.user),r.noAnswerTimeout=1e3*r.noAnswerTimeout,r.hackIpInContact)if("boolean"==typeof r.hackIpInContact){var d=Math.floor(254*Math.random()+1);r.viaHost="192.0.2."+d}else"string"==typeof r.hackIpInContact&&(r.viaHost=r.hackIpInContact);r.hackWssInTransport&&(r.contactTransport="wss"),this.contact={pubGruu:void 0,tempGruu:void 0,uri:new A.URI("sip",r.contactName,r.viaHost,void 0,{transport:r.contactTransport}),toString:function(e){void 0===e&&(e={});var n=e.anonymous||!1,i=e.outbound||!1,o="<";return o+=n?(t.contact.tempGruu||"sip:anonymous@anonymous.invalid;transport="+r.contactTransport).toString():(t.contact.pubGruu||t.contact.uri).toString(),i&&(o+=";ob"),o+=">"}};var p={};for(var i in r)r.hasOwnProperty(i)&&(p[i]=r[i]);for(var i in Object.assign(this.configuration,p),this.logger.log("configuration parameters after validation:"),r)if(r.hasOwnProperty(i))switch(i){case"uri":case"sessionDescriptionHandlerFactory":this.logger.log("· "+i+": "+r[i]);break;case"password":this.logger.log("· "+i+": NOT SHOWN");break;case"transportConstructor":this.logger.log("· "+i+": "+r[i].name);break;default:this.logger.log("· "+i+": "+JSON.stringify(r[i]))}},r.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{uri:function(e){/^sip:/i.test(e)||(e=a.C.SIP+":"+e);var t=d.Grammar.URIParse(e);return t&&t.user?t:void 0},transportConstructor:function(e){if(e instanceof Function)return e},transportOptions:function(e){if("object"==typeof e)return e},authorizationUser:function(e){return-1===d.Grammar.parse('"'+e+'"',"quoted_string")?void 0:e},displayName:function(e){return-1===d.Grammar.parse('"'+e+'"',"displayName")?void 0:e},dtmfType:function(e){switch(e){case a.C.dtmfType.RTP:return a.C.dtmfType.RTP;case a.C.dtmfType.INFO:default:return a.C.dtmfType.INFO}},hackViaTcp:function(e){if("boolean"==typeof e)return e},hackIpInContact:function(e){return"boolean"==typeof e?e:"string"==typeof e&&-1!==d.Grammar.parse(e,"host")?e:void 0},hackWssInTransport:function(e){if("boolean"==typeof e)return e},hackAllowUnregisteredOptionTags:function(e){if("boolean"==typeof e)return e},contactTransport:function(e){if("string"==typeof e)return e},extraSupported:function(e){if(e instanceof Array){for(var t=0,r=e;t<r.length;t++){if("string"!=typeof r[t])return}return e}},forceRport:function(e){if("boolean"==typeof e)return e},noAnswerTimeout:function(e){if(b.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},password:function(e){return String(e)},rel100:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},replaces:function(e){return e===a.C.supported.REQUIRED?a.C.supported.REQUIRED:e===a.C.supported.SUPPORTED?a.C.supported.SUPPORTED:a.C.supported.UNSUPPORTED},register:function(e){if("boolean"==typeof e)return e},registerOptions:function(e){if("object"==typeof e)return e},userAgentString:function(e){if("string"==typeof e)return e},autostart:function(e){if("boolean"==typeof e)return e},autostop:function(e){if("boolean"==typeof e)return e},sessionDescriptionHandlerFactory:function(e){if(e instanceof Function)return e},sessionDescriptionHandlerFactoryOptions:function(e){if("object"==typeof e)return e},authenticationFactory:this.checkAuthenticationFactory,allowLegacyNotifications:function(e){if("boolean"==typeof e)return e},custom:function(e){if("object"==typeof e)return e},contactName:function(e){if("string"==typeof e)return e}}}},r.C={STATUS_INIT:0,STATUS_STARTING:1,STATUS_READY:2,STATUS_USER_CLOSED:3,STATUS_NOT_READY:4,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,ALLOWED_METHODS:["ACK","CANCEL","INVITE","MESSAGE","BYE","OPTIONS","INFO","NOTIFY","REFER"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],MAX_FORWARDS:70,TAG_LENGTH:10},r}(o.EventEmitter);t.UA=R,function(e){!function(e){e.RTP="rtp",e.INFO="info"}(e.DtmfType||(e.DtmfType={}))}(R=t.UA||(t.UA={})),t.UA=R}).call(this,r(1))},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),s=r(0),a=r(6),c=r(3),u=r(23),h=r(66),d=function(t){function r(r,n,i){var o=t.call(this)||this;o.type=s.TypeStrings.SessionDescriptionHandler,o.options=i||{},o.logger=r,o.observer=n,o.dtmfSender=void 0,o.shouldAcquireMedia=!0,o.CONTENT_TYPE="application/sdp",o.C={DIRECTION:{NULL:null,SENDRECV:"sendrecv",SENDONLY:"sendonly",RECVONLY:"recvonly",INACTIVE:"inactive"}},o.logger.log("SessionDescriptionHandlerOptions: "+JSON.stringify(o.options)),o.direction=o.C.DIRECTION.NULL,o.modifiers=o.options.modifiers||[],Array.isArray(o.modifiers)||(o.modifiers=[o.modifiers]);var a=e.window||e;return o.WebRTC={MediaStream:a.MediaStream,getUserMedia:a.navigator.mediaDevices.getUserMedia.bind(a.navigator.mediaDevices),RTCPeerConnection:a.RTCPeerConnection},o.iceGatheringTimeout=!1,o.initPeerConnection(o.options.peerConnectionOptions),o.constraints=o.checkAndDefaultConstraints(o.options.constraints),o}return i(r,t),r.defaultFactory=function(e,t){return new r(e.ua.getLogger("sip.invitecontext.sessionDescriptionHandler",e.id),new h.SessionDescriptionHandlerObserver(e,t),t)},r.prototype.close=function(){this.logger.log("closing PeerConnection"),this.peerConnection&&"closed"!==this.peerConnection.signalingState&&(this.peerConnection.getSenders?this.peerConnection.getSenders().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getLocalStreams which is deprecated"),this.peerConnection.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.peerConnection.getReceivers?this.peerConnection.getReceivers().forEach(function(e){e.track&&e.track.stop()}):(this.logger.warn("Using getRemoteStreams which is deprecated"),this.peerConnection.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})})),this.resetIceGatheringComplete(),this.peerConnection.close())},r.prototype.getDescription=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]),e.peerConnectionOptions&&this.initPeerConnection(e.peerConnectionOptions);var n=Object.assign({},this.constraints,e.constraints);return n=this.checkAndDefaultConstraints(n),JSON.stringify(n)!==JSON.stringify(this.constraints)&&(this.constraints=n,this.shouldAcquireMedia=!0),Array.isArray(t)||(t=[t]),t=t.concat(this.modifiers),Promise.resolve().then(function(){if(r.shouldAcquireMedia)return r.acquire(r.constraints).then(function(){r.shouldAcquireMedia=!1})}).then(function(){return r.createOfferOrAnswer(e.RTCOfferOptions,t)}).then(function(e){if(void 0===e.sdp)throw new a.Exceptions.SessionDescriptionHandlerError("getDescription",void 0,"SDP undefined");return r.emit("getDescription",e),{body:e.sdp,contentType:r.CONTENT_TYPE}})},r.prototype.hasDescription=function(e){return e===this.CONTENT_TYPE},r.prototype.holdModifier=function(e){return e.sdp?(/a=(sendrecv|sendonly|recvonly|inactive)/.test(e.sdp)?(e.sdp=e.sdp.replace(/a=sendrecv\r\n/g,"a=sendonly\r\n"),e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n")):e.sdp=e.sdp.replace(/(m=[^\r]*\r\n)/g,"$1a=sendonly\r\n"),Promise.resolve(e)):Promise.resolve(e)},r.prototype.setDescription=function(e,t,r){var n=this;void 0===t&&(t={}),void 0===r&&(r=[]),t.peerConnectionOptions&&this.initPeerConnection(t.peerConnectionOptions),Array.isArray(r)||(r=[r]),r=r.concat(this.modifiers);var i={type:this.hasOffer("local")?"answer":"offer",sdp:e};return Promise.resolve().then(function(){if(n.shouldAcquireMedia&&n.options.alwaysAcquireMediaFirst)return n.acquire(n.constraints).then(function(){n.shouldAcquireMedia=!1})}).then(function(){return c.Utils.reducePromises(r,i)}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("setDescription",e,"The modifiers did not resolve successfully");throw n.logger.error(t.message),n.emit("peerConnection-setRemoteDescriptionFailed",t),t}).then(function(e){return n.emit("setDescription",e),n.peerConnection.setRemoteDescription(e)}).catch(function(i){if(i.type===s.TypeStrings.SessionDescriptionHandlerError)throw i;if(/^m=video.+$/gm.test(e)&&!t.disableAudioFallback)return t.disableAudioFallback=!0,n.setDescription(e,t,[u.stripVideo].concat(r));var o=new a.Exceptions.SessionDescriptionHandlerError("setDescription",i);throw o.error&&n.logger.error(o.error),n.emit("peerConnection-setRemoteDescriptionFailed",o),o}).then(function(){n.peerConnection.getReceivers?n.emit("setRemoteDescription",n.peerConnection.getReceivers()):n.emit("setRemoteDescription",n.peerConnection.getRemoteStreams()),n.emit("confirmed",n)})},r.prototype.sendDtmf=function(e,t){if(void 0===t&&(t={}),!this.dtmfSender&&this.hasBrowserGetSenderSupport()){var r=this.peerConnection.getSenders();r.length>0&&(this.dtmfSender=r[0].dtmf)}if(!this.dtmfSender&&this.hasBrowserTrackSupport()){var n=this.peerConnection.getLocalStreams();if(n.length>0){var i=n[0].getAudioTracks();i.length>0&&(this.dtmfSender=this.peerConnection.createDTMFSender(i[0]))}}if(!this.dtmfSender)return!1;try{this.dtmfSender.insertDTMF(e,t.duration,t.interToneGap)}catch(e){if("InvalidStateError"===e.type||"InvalidCharacterError"===e.type)return this.logger.error(e),!1;throw e}return this.logger.log("DTMF sent via RTP: "+e.toString()),!0},r.prototype.getDirection=function(){return this.direction},r.prototype.on=function(e,r){return t.prototype.on.call(this,e,r)},r.prototype.createOfferOrAnswer=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=[]);var n=this.hasOffer("remote")?"createAnswer":"createOffer",i=this.peerConnection;return this.logger.log(n),i[n](e).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-"+n+"Failed");throw r.emit("peerConnection-"+n+"Failed",t),t}).then(function(e){return c.Utils.reducePromises(t,r.createRTCSessionDescriptionInit(e))}).then(function(e){return r.resetIceGatheringComplete(),r.logger.log("Setting local sdp."),r.logger.log("sdp is "+e.sdp||!1),i.setLocalDescription(e)}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e,"peerConnection-SetLocalDescriptionFailed");throw r.emit("peerConnection-SetLocalDescriptionFailed",t),t}).then(function(){return r.waitForIceGatheringComplete()}).then(function(){var e=r.createRTCSessionDescriptionInit(r.peerConnection.localDescription);return c.Utils.reducePromises(t,e)}).then(function(e){return r.setDirection(e.sdp||""),e}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var t=new a.Exceptions.SessionDescriptionHandlerError("createOfferOrAnswer",e);throw r.logger.error(t.toString()),t})},r.prototype.createRTCSessionDescriptionInit=function(e){return{type:e.type,sdp:e.sdp}},r.prototype.addDefaultIceCheckingTimeout=function(e){return void 0===e.iceCheckingTimeout&&(e.iceCheckingTimeout=5e3),e},r.prototype.addDefaultIceServers=function(e){return e.iceServers||(e.iceServers=[{urls:"stun:stun.l.google.com:19302"}]),e},r.prototype.checkAndDefaultConstraints=function(e){var t={audio:!0,video:!this.options.alwaysAcquireMediaFirst};return e=e||t,0===Object.keys(e).length&&e.constructor===Object?t:e},r.prototype.hasBrowserTrackSupport=function(){return Boolean(this.peerConnection.addTrack)},r.prototype.hasBrowserGetSenderSupport=function(){return Boolean(this.peerConnection.getSenders)},r.prototype.initPeerConnection=function(e){var t=this;void 0===e&&(e={}),(e=this.addDefaultIceCheckingTimeout(e)).rtcConfiguration=e.rtcConfiguration||{},e.rtcConfiguration=this.addDefaultIceServers(e.rtcConfiguration),this.logger.log("initPeerConnection"),this.peerConnection&&(this.logger.log("Already have a peer connection for this session. Tearing down."),this.resetIceGatheringComplete(),this.peerConnection.close()),this.peerConnection=new this.WebRTC.RTCPeerConnection(e.rtcConfiguration),this.logger.log("New peer connection created"),"ontrack"in this.peerConnection?this.peerConnection.addEventListener("track",function(e){t.logger.log("track added"),t.observer.trackAdded(),t.emit("addTrack",e)}):(this.logger.warn("Using onaddstream which is deprecated"),this.peerConnection.onaddstream=function(e){t.logger.log("stream added"),t.emit("addStream",e)}),this.peerConnection.onicecandidate=function(e){t.emit("iceCandidate",e),e.candidate?t.logger.log("ICE candidate received: "+(null===e.candidate.candidate?null:e.candidate.candidate.trim())):null===e.candidate&&(t.logger.log("ICE candidate gathering complete"),t.triggerIceGatheringComplete())},this.peerConnection.onicegatheringstatechange=function(){switch(t.logger.log("RTCIceGatheringState changed: "+t.peerConnection.iceGatheringState),t.peerConnection.iceGatheringState){case"gathering":t.emit("iceGathering",t),!t.iceGatheringTimer&&e.iceCheckingTimeout&&(t.iceGatheringTimeout=!1,t.iceGatheringTimer=setTimeout(function(){t.logger.log("RTCIceChecking Timeout Triggered after "+e.iceCheckingTimeout+" milliseconds"),t.iceGatheringTimeout=!0,t.triggerIceGatheringComplete()},e.iceCheckingTimeout));break;case"complete":t.triggerIceGatheringComplete()}},this.peerConnection.oniceconnectionstatechange=function(){var e;switch(t.peerConnection.iceConnectionState){case"new":e="iceConnection";break;case"checking":e="iceConnectionChecking";break;case"connected":e="iceConnectionConnected";break;case"completed":e="iceConnectionCompleted";break;case"failed":e="iceConnectionFailed";break;case"disconnected":e="iceConnectionDisconnected";break;case"closed":e="iceConnectionClosed";break;default:return void t.logger.warn("Unknown iceConnection state: "+t.peerConnection.iceConnectionState)}t.logger.log("ICE Connection State changed to "+e),t.emit(e,t)}},r.prototype.acquire=function(e){var t=this;return e=this.checkAndDefaultConstraints(e),new Promise(function(r,n){t.logger.log("acquiring local media"),t.emit("userMediaRequest",e),e.audio||e.video?t.WebRTC.getUserMedia(e).then(function(e){t.observer.trackAdded(),t.emit("userMedia",e),r(e)}).catch(function(e){t.emit("userMediaFailed",e),n(e)}):r([])}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"unable to acquire streams");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r}).then(function(e){t.logger.log("acquired local media streams");try{return t.peerConnection.removeTrack&&t.peerConnection.getSenders().forEach(function(e){t.peerConnection.removeTrack(e)}),e}catch(e){return Promise.reject(e)}}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error removing streams");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r}).then(function(e){try{(e=[].concat(e)).forEach(function(e){t.peerConnection.addTrack?e.getTracks().forEach(function(r){t.peerConnection.addTrack(r,e)}):t.peerConnection.addStream(e)})}catch(e){return Promise.reject(e)}return Promise.resolve()}).catch(function(e){if(e.type===s.TypeStrings.SessionDescriptionHandlerError)throw e;var r=new a.Exceptions.SessionDescriptionHandlerError("acquire",e,"error adding stream");throw t.logger.error(r.message),r.error&&t.logger.error(r.error),r})},r.prototype.hasOffer=function(e){var t="have-"+e+"-offer";return this.peerConnection.signalingState===t},r.prototype.isIceGatheringComplete=function(){return"complete"===this.peerConnection.iceGatheringState||this.iceGatheringTimeout},r.prototype.resetIceGatheringComplete=function(){this.iceGatheringTimeout=!1,this.logger.log("resetIceGatheringComplete"),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.reject(),this.iceGatheringDeferred=void 0)},r.prototype.setDirection=function(e){var t=e.match(/a=(sendrecv|sendonly|recvonly|inactive)/);if(null===t)return this.direction=this.C.DIRECTION.NULL,void this.observer.directionChanged();var r=t[1];switch(r){case this.C.DIRECTION.SENDRECV:case this.C.DIRECTION.SENDONLY:case this.C.DIRECTION.RECVONLY:case this.C.DIRECTION.INACTIVE:this.direction=r;break;default:this.direction=this.C.DIRECTION.NULL}this.observer.directionChanged()},r.prototype.triggerIceGatheringComplete=function(){this.isIceGatheringComplete()&&(this.emit("iceGatheringComplete",this),this.iceGatheringTimer&&(clearTimeout(this.iceGatheringTimer),this.iceGatheringTimer=void 0),this.iceGatheringDeferred&&(this.iceGatheringDeferred.resolve(),this.iceGatheringDeferred=void 0))},r.prototype.waitForIceGatheringComplete=function(){return this.logger.log("waitForIceGatheringComplete"),this.isIceGatheringComplete()?(this.logger.log("ICE is already complete. Return resolved."),Promise.resolve()):(this.iceGatheringDeferred||(this.iceGatheringDeferred=c.Utils.defer()),this.logger.log("ICE is not complete. Returning promise"),this.iceGatheringDeferred?this.iceGatheringDeferred.promise:Promise.resolve())},r}(o.EventEmitter);t.SessionDescriptionHandler=d}).call(this,r(1))},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(0),a=r(6),c=r(7),u=r(39),h=r(3);!function(e){e[e.STATUS_CONNECTING=0]="STATUS_CONNECTING",e[e.STATUS_OPEN=1]="STATUS_OPEN",e[e.STATUS_CLOSING=2]="STATUS_CLOSING",e[e.STATUS_CLOSED=3]="STATUS_CLOSED"}(o=t.TransportStatus||(t.TransportStatus={}));var d=function(t){function r(r,n){void 0===n&&(n={});var i=t.call(this,r,n)||this;return i.WebSocket=(e.window||e).WebSocket,i.type=s.TypeStrings.Transport,i.reconnectionAttempts=0,i.status=o.STATUS_CONNECTING,i.configuration=i.loadConfig(n),i.server=i.configuration.wsServers[0],i}return i(r,t),r.prototype.isConnected=function(){return this.status===o.STATUS_OPEN},r.prototype.sendPromise=function(e,t){if(void 0===t&&(t={}),!this.statusAssert(o.STATUS_OPEN,t.force))return this.onError("unable to send message - WebSocket not open"),Promise.reject();var r=e.toString();return this.ws?(!0===this.configuration.traceSip&&this.logger.log("sending WebSocket message:\n\n"+r+"\n"),this.ws.send(r),Promise.resolve({msg:r})):(this.onError("unable to send message - WebSocket does not exist"),Promise.reject())},r.prototype.disconnectPromise=function(e){var t=this;return void 0===e&&(e={}),this.disconnectionPromise?this.disconnectionPromise:(e.code=e.code||1e3,this.statusTransition(o.STATUS_CLOSING,e.force)?(this.emit("disconnecting"),this.disconnectionPromise=new Promise(function(r,n){t.disconnectDeferredResolve=r,t.reconnectTimer&&(clearTimeout(t.reconnectTimer),t.reconnectTimer=void 0),t.ws?(t.stopSendingKeepAlives(),t.logger.log("closing WebSocket "+t.server.wsUri),t.ws.close(e.code,e.reason)):n("Attempted to disconnect but the websocket doesn't exist")}),this.disconnectionPromise):this.status===o.STATUS_CLOSED?Promise.resolve({overrideEvent:!0}):this.connectionPromise?this.connectionPromise.then(function(){return Promise.reject("The websocket did not disconnect")}).catch(function(){return Promise.resolve({overrideEvent:!0})}):Promise.reject("The websocket did not disconnect"))},r.prototype.connectPromise=function(e){var t=this;return void 0===e&&(e={}),this.status!==o.STATUS_CLOSING||e.force?this.connectionPromise?this.connectionPromise:(this.server=this.server||this.getNextWsServer(e.force),this.connectionPromise=new Promise(function(r,n){if((t.status===o.STATUS_OPEN||t.status===o.STATUS_CLOSING)&&!e.force)return t.logger.warn("WebSocket "+t.server.wsUri+" is already connected"),void n("Failed status check - attempted to open a connection but already open/closing");t.connectDeferredResolve=r,t.status=o.STATUS_CONNECTING,t.emit("connecting"),t.logger.log("connecting to WebSocket "+t.server.wsUri),t.disposeWs();try{t.ws=new WebSocket(t.server.wsUri,"sip")}catch(e){return t.ws=null,t.status=o.STATUS_CLOSED,t.onError("error connecting to WebSocket "+t.server.wsUri+":"+e),void n("Failed to create a websocket")}t.ws?(t.connectionTimeout=setTimeout(function(){t.statusTransition(o.STATUS_CLOSED),t.logger.warn("took too long to connect - exceeded time set in configuration.connectionTimeout: "+t.configuration.connectionTimeout+"s"),t.emit("disconnected",{code:1e3}),t.connectionPromise=void 0,n("Connection timeout")},1e3*t.configuration.connectionTimeout),t.boundOnOpen=t.onOpen.bind(t),t.boundOnMessage=t.onMessage.bind(t),t.boundOnClose=t.onClose.bind(t),t.boundOnError=t.onWebsocketError.bind(t),t.ws.addEventListener("open",t.boundOnOpen),t.ws.addEventListener("message",t.boundOnMessage),t.ws.addEventListener("close",t.boundOnClose),t.ws.addEventListener("error",t.boundOnError)):n("Unexpected instance websocket not set")}),this.connectionPromise):Promise.reject("WebSocket "+this.server.wsUri+" is closing")},r.prototype.onMessage=function(e){var t,r=e.data;if(/^(\r\n)+$/.test(r))return this.clearKeepAliveTimeout(),void(!0===this.configuration.traceSip&&this.logger.log("received WebSocket message with CRLF Keep Alive response"));if(r){if("string"!=typeof r){try{t=String.fromCharCode.apply(null,new Uint8Array(r))}catch(e){return void this.logger.warn("received WebSocket binary message failed to be converted into string, message discarded")}!0===this.configuration.traceSip&&this.logger.log("received WebSocket binary message:\n\n"+r+"\n")}else!0===this.configuration.traceSip&&this.logger.log("received WebSocket text message:\n\n"+r+"\n"),t=r;this.emit("message",t)}else this.logger.warn("received empty message, message discarded")},r.prototype.onOpen=function(){if(this.status===o.STATUS_CLOSED){var e=this.ws;return this.disposeWs(),void e.close(1e3)}this.status=o.STATUS_OPEN,this.emit("connected"),this.connectionTimeout&&(clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0),this.logger.log("WebSocket "+this.server.wsUri+" connected"),void 0!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0),this.reconnectionAttempts=0,this.disconnectionPromise=void 0,this.disconnectDeferredResolve=void 0,this.startSendingKeepAlives(),this.connectDeferredResolve?this.connectDeferredResolve({overrideEvent:!0}):this.logger.warn("Unexpected websocket.onOpen with no connectDeferredResolve")},r.prototype.onClose=function(e){if(this.logger.log("WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),this.status!==o.STATUS_CLOSING&&(this.logger.warn("WebSocket closed without SIP.js requesting it"),this.emit("transportError")),this.stopSendingKeepAlives(),this.connectionTimeout&&clearTimeout(this.connectionTimeout),this.connectionTimeout=void 0,this.connectionPromise=void 0,this.connectDeferredResolve=void 0,this.disconnectDeferredResolve)return this.disconnectDeferredResolve({overrideEvent:!0}),this.statusTransition(o.STATUS_CLOSED),void(this.disconnectDeferredResolve=void 0);this.status=o.STATUS_CLOSED,this.emit("disconnected",{code:e.code,reason:e.reason}),this.reconnect()},r.prototype.disposeWs=function(){this.ws&&(this.ws.removeEventListener("open",this.boundOnOpen),this.ws.removeEventListener("message",this.boundOnMessage),this.ws.removeEventListener("close",this.boundOnClose),this.ws.removeEventListener("error",this.boundOnError),this.ws=void 0)},r.prototype.onError=function(e){this.logger.warn("Transport error: "+e),this.emit("transportError")},r.prototype.onWebsocketError=function(){this.onError("The Websocket had an error")},r.prototype.reconnect=function(){var e=this;if(this.reconnectionAttempts>0&&this.logger.log("Reconnection attempt "+this.reconnectionAttempts+" failed"),this.noAvailableServers())return this.logger.warn("attempted to get next ws server but there are no available ws servers left"),this.logger.warn("no available ws servers left - going to closed state"),this.status=o.STATUS_CLOSED,this.emit("closed"),void this.resetServerErrorStatus();this.isConnected()&&(this.logger.warn("attempted to reconnect while connected - forcing disconnect"),this.disconnect({force:!0})),this.reconnectionAttempts+=1,this.reconnectionAttempts>this.configuration.maxReconnectionAttempts?(this.logger.warn("maximum reconnection attempts for WebSocket "+this.server.wsUri),this.logger.log("transport "+this.server.wsUri+" failed | connection state set to 'error'"),this.server.isError=!0,this.emit("transportError"),this.noAvailableServers()||(this.server=this.getNextWsServer()),this.reconnectionAttempts=0,this.reconnect()):(this.logger.log("trying to reconnect to WebSocket "+this.server.wsUri+" (reconnection attempt "+this.reconnectionAttempts+")"),this.reconnectTimer=setTimeout(function(){e.connect(),e.reconnectTimer=void 0},1===this.reconnectionAttempts?0:1e3*this.configuration.reconnectionTimeout))},r.prototype.resetServerErrorStatus=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){t[e].isError=!1}},r.prototype.getNextWsServer=function(e){if(void 0===e&&(e=!1),this.noAvailableServers())throw this.logger.warn("attempted to get next ws server but there are no available ws servers left"),new Error("Attempted to get next ws server, but there are no available ws servers left.");for(var t=[],r=0,n=this.configuration.wsServers;r<n.length;r++){var i=n[r];i.isError&&!e||(0===t.length?t.push(i):i.weight>t[0].weight?t=[i]:i.weight===t[0].weight&&t.push(i))}return t[Math.floor(Math.random()*t.length)]},r.prototype.noAvailableServers=function(){for(var e=0,t=this.configuration.wsServers;e<t.length;e++){if(!t[e].isError)return!1}return!0},r.prototype.sendKeepAlive=function(){var e=this;if(!this.keepAliveDebounceTimeout)return this.keepAliveDebounceTimeout=setTimeout(function(){e.emit("keepAliveDebounceTimeout"),e.clearKeepAliveTimeout()},1e3*this.configuration.keepAliveDebounce),this.send("\r\n\r\n")},r.prototype.clearKeepAliveTimeout=function(){this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveDebounceTimeout=void 0},r.prototype.startSendingKeepAlives=function(){var e,t,r=this;this.configuration.keepAliveInterval&&!this.keepAliveInterval&&(this.keepAliveInterval=setInterval(function(){r.sendKeepAlive(),r.startSendingKeepAlives()},(e=this.configuration.keepAliveInterval,t=.8*e,1e3*(Math.random()*(e-t)+t))))},r.prototype.stopSendingKeepAlives=function(){this.keepAliveInterval&&clearInterval(this.keepAliveInterval),this.keepAliveDebounceTimeout&&clearTimeout(this.keepAliveDebounceTimeout),this.keepAliveInterval=void 0,this.keepAliveDebounceTimeout=void 0},r.prototype.statusAssert=function(e,t){return e===this.status||(t?(this.logger.warn("Attempted to assert "+Object.keys(o)[this.status]+" as "+Object.keys(o)[e]+"- continuing with option: 'force'"),!0):(this.logger.warn("Tried to assert "+Object.keys(o)[e]+" but is currently "+Object.keys(o)[this.status]),!1))},r.prototype.statusTransition=function(e,t){return void 0===t&&(t=!1),this.logger.log("Attempting to transition status from "+Object.keys(o)[this.status]+" to "+Object.keys(o)[e]),e===o.STATUS_CONNECTING&&this.statusAssert(o.STATUS_CLOSED,t)||e===o.STATUS_OPEN&&this.statusAssert(o.STATUS_CONNECTING,t)||e===o.STATUS_CLOSING&&this.statusAssert(o.STATUS_OPEN,t)||e===o.STATUS_CLOSED?(this.status=e,!0):(this.logger.warn("Status transition failed - result: no-op - reason: either gave an nonexistent status or attempted illegal transition"),!1)},r.prototype.loadConfig=function(e){var t={wsServers:[{scheme:"WSS",sipUri:"<sip:edge.sip.onsip.com;transport=ws;lr>",weight:0,wsUri:"wss://edge.sip.onsip.com",isError:!1}],connectionTimeout:5,maxReconnectionAttempts:3,reconnectionTimeout:4,keepAliveInterval:0,keepAliveDebounce:10,traceSip:!1},r=this.getConfigurationCheck();for(var n in r.mandatory){if(!e.hasOwnProperty(n))throw new a.Exceptions.ConfigurationError(n);var i=e[n];if(void 0===(o=r.mandatory[n](i)))throw new a.Exceptions.ConfigurationError(n,i);t[n]=o}for(var n in r.optional)if(e.hasOwnProperty(n)){var o;if((i=e[n])instanceof Array&&0===i.length||null===i||""===i||void 0===i||"number"==typeof i&&isNaN(i))continue;if(void 0===(o=r.optional[n](i)))throw new a.Exceptions.ConfigurationError(n,i);t[n]=o}var s={};for(var n in t)t.hasOwnProperty(n)&&(s[n]={value:t[n]});var c=Object.defineProperties({},s);for(var n in this.logger.log("configuration parameters after validation:"),t)t.hasOwnProperty(n)&&this.logger.log("· "+n+": "+JSON.stringify(t[n]));return c},r.prototype.getConfigurationCheck=function(){return{mandatory:{},optional:{wsServers:function(e){if("string"==typeof e)e=[{wsUri:e}];else{if(!(e instanceof Array))return;for(var t=0;t<e.length;t++)"string"==typeof e[t]&&(e[t]={wsUri:e[t]})}if(0===e.length)return!1;for(var r=0,n=e;r<n.length;r++){var i=n[r];if(!i.wsUri)return;if(i.weight&&!Number(i.weight))return;var o=c.Grammar.parse(i.wsUri,"absoluteURI");if(-1===o)return;if(["wss","ws","udp"].indexOf(o.scheme)<0)return;i.sipUri="<sip:"+o.host+(o.port?":"+o.port:"")+";transport="+o.scheme.replace(/^wss$/i,"ws")+";lr>",i.weight||(i.weight=0),i.isError=!1,i.scheme=o.scheme.toUpperCase()}return e},keepAliveInterval:function(e){if(h.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},keepAliveDebounce:function(e){if(h.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},traceSip:function(e){if("boolean"==typeof e)return e},connectionTimeout:function(e){if(h.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}},maxReconnectionAttempts:function(e){if(h.Utils.isDecimal(e)){var t=Number(e);if(t>=0)return t}},reconnectionTimeout:function(e){if(h.Utils.isDecimal(e)){var t=Number(e);if(t>0)return t}}}}},r.C=o,r}(u.Transport);t.Transport=d}).call(this,r(1))},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},function(e,t,r){"use strict";var n=r(4),i=r(73),o=r(75),s=r(76),a=r(77),c=r(45),u="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||r(78);e.exports=function(e){return new Promise(function(t,h){var d=e.data,p=e.headers;n.isFormData(d)&&delete p["Content-Type"];var l=new XMLHttpRequest,f="onreadystatechange",g=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in l||a(e.url)||(l=new window.XDomainRequest,f="onload",g=!0,l.onprogress=function(){},l.ontimeout=function(){}),e.auth){var m=e.auth.username||"",v=e.auth.password||"";p.Authorization="Basic "+u(m+":"+v)}if(l.open(e.method.toUpperCase(),o(e.url,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,l[f]=function(){if(l&&(4===l.readyState||g)&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in l?s(l.getAllResponseHeaders()):null,n={data:e.responseType&&"text"!==e.responseType?l.response:l.responseText,status:1223===l.status?204:l.status,statusText:1223===l.status?"No Content":l.statusText,headers:r,config:e,request:l};i(t,h,n),l=null}},l.onerror=function(){h(c("Network Error",e,null,l)),l=null},l.ontimeout=function(){h(c("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",l)),l=null},n.isStandardBrowserEnv()){var y=r(79),T=(e.withCredentials||a(e.url))&&e.xsrfCookieName?y.read(e.xsrfCookieName):void 0;T&&(p[e.xsrfHeaderName]=T)}if("setRequestHeader"in l&&n.forEach(p,function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete p[t]:l.setRequestHeader(t,e)}),e.withCredentials&&(l.withCredentials=!0),e.responseType)try{l.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){l&&(l.abort(),h(e),l=null)}),void 0===d&&(d=null),l.send(d)})}},function(e,t,r){"use strict";var n=r(74);e.exports=function(e,t,r,i,o){var s=new Error(e);return n(s,t,r,i,o)}},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,n=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=r.exec(e||""),a={},c=14;c--;)a[n[c]]=s[c]||"";return-1!=i&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t,r){(function(t){e.exports=function(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,r(1))},function(e,t,r){var n=r(97),i=r(58),o=r(13),s=r(25),a=r(59),c=r(60),u=r(18)("socket.io-client:manager"),h=r(57),d=r(115),p=Object.prototype.hasOwnProperty;function l(e,t){if(!(this instanceof l))return new l(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=l,l.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},l.prototype.updateSocketIds=function(){for(var e in this.nsps)p.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},o(l.prototype),l.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},l.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},l.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},l.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},l.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},l.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},l.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},l.prototype.open=l.prototype.connect=function(e,t){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=a(r,"open",function(){i.onopen(),e&&e()}),s=a(r,"error",function(t){if(u("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var h=setTimeout(function(){u("connect attempt timed out after %d",c),o.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",c)},c);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(o),this.subs.push(s),this},l.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(e,"ping",c(this,"onping"))),this.subs.push(a(e,"pong",c(this,"onpong"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},l.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},l.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},l.prototype.ondata=function(e){this.decoder.add(e)},l.prototype.ondecoded=function(e){this.emit("packet",e)},l.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},l.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new i(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",o),r.on("connect",function(){r.id=n.engine.id}),this.autoConnect&&o()}function o(){~h(n.connecting,r)||n.connecting.push(r)}return r},l.prototype.destroy=function(e){var t=h(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},l.prototype.packet=function(e){u("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()}))},l.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},l.prototype.cleanup=function(){u("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},l.prototype.close=l.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},l.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},l.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout(function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(r)}})}},l.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,r){(function(e){var n=r(26),i=r(101),o=r(110),s=r(111);t.polling=function(t){var r=!1,s=!1,a=!1!==t.jsonp;if(e.location){var c="https:"===location.protocol,u=location.port;u||(u=c?443:80),r=t.hostname!==location.hostname||u!==t.port,s=t.secure!==c}if(t.xdomain=r,t.xscheme=s,"open"in new n(t)&&!t.forceJSONP)return new i(t);if(!a)throw new Error("JSONP disabled");return new o(t)},t.websocket=s}).call(this,r(1))},function(e,t,r){var n=r(27),i=r(28),o=r(12),s=r(19),a=r(56),c=r(20)("engine.io-client:polling");e.exports=h;var u=null!=new(r(26))({xdomain:!1}).responseType;function h(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),n.call(this,e)}s(h,n),h.prototype.name="polling",h.prototype.doOpen=function(){this.poll()},h.prototype.pause=function(e){var t=this;function r(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(c("we are currently polling - waiting to pause"),n++,this.once("pollComplete",function(){c("pre-pause polling complete"),--n||r()})),this.writable||(c("we are currently writing - waiting to pause"),n++,this.once("drain",function(){c("pre-pause writing complete"),--n||r()}))}else r()},h.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},h.prototype.onData=function(e){var t=this;c("polling got data %s",e);o.decodePayload(e,this.socket.binaryType,function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},h.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},h.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,r)})},h.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},function(e,t,r){(function(t){var n=r(50);e.exports=function(e){return function e(r){if(!r)return!1;if(t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(r)||t.ArrayBuffer&&r instanceof ArrayBuffer||t.Blob&&r instanceof Blob||t.File&&r instanceof File)return!0;if(n(r)){for(var i=0;i<r.length;i++)if(e(r[i]))return!0}else if(r&&"object"==typeof r)for(var o in r.toJSON&&"function"==typeof r.toJSON&&(r=r.toJSON()),r)if(Object.prototype.hasOwnProperty.call(r,o)&&e(r[o]))return!0;return!1}(e)}}).call(this,r(1))},function(e,t,r){"use strict";var n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},a=0,c=0;function u(e){var t="";do{t=i[e%o]+t,e=Math.floor(e/o)}while(e>0);return t}function h(){var e=u(+new Date);return e!==n?(a=0,n=e):e+"."+u(a++)}for(;c<o;c++)s[i[c]]=c;h.encode=u,h.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=t*o+s[e.charAt(c)];return t},e.exports=h},function(e,t){var r=[].indexOf;e.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,r){var n=r(25),i=r(13),o=r(114),s=r(59),a=r(60),c=r(18)("socket.io-client:socket"),u=r(55);e.exports=p;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=i.prototype.emit;function p(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",a(this,"onopen")),s(e,"packet",a(this,"onpacket")),s(e,"close",a(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var e=o(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(h.hasOwnProperty(e))return d.apply(this,arguments),this;var t=o(arguments),r=n.EVENT;u(t)&&(r=n.BINARY_EVENT);var i={type:r,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){c("transport is open - connecting"),"/"!==this.nsp&&(this.query?this.packet({type:n.CONNECT,query:this.query}):this.packet({type:n.CONNECT}))},p.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},p.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},p.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?d.apply(this,t):this.receiveBuffer.push(t)},p.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=o(arguments);c("sending ack %j",i);var s=u(i)?n.BINARY_ACK:n.ACK;t.packet({type:s,id:e,data:i})}}},p.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)d.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},function(e,t){e.exports=function(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}},function(e,t){var r=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},function(e,t,r){var n=r(87),i=r(25),o=r(52),s=r(18)("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,i=n(e),c=i.source,u=i.id,h=i.path,d=a[u]&&h in a[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||d?(s("ignoring socket cache for %s",c),r=o(c,t)):(a[u]||(s("new io instance for %s",c),a[u]=o(c,t)),r=a[u]),i.query&&!t.query?t.query=i.query:t&&"object"==typeof t.query&&(t.query=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}(t.query)),r.socket(i.path,t)}t.protocol=i.protocol,t.connect=c,t.Manager=r(52),t.Socket=r(58)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(31),s=r(17),a=function(e){function t(r,n,i,o){var s=e.call(this)||this;return s.message=r,s.expected=n,s.found=i,s.location=o,s.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(s,t),s}return i(t,e),t.buildMessage=function(e,t){function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function i(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+r(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+r(e)})}function o(e){switch(e.type){case"literal":return'"'+n(e.text)+'"';case"class":var t=e.parts.map(function(e){return Array.isArray(e)?i(e[0])+"-"+i(e[1]):i(e)});return"["+(e.inverted?"^":"")+t+"]";case"any":return"any character";case"end":return"end of input";case"other":return e.description}}return"Expected "+function(e){var t,r,n=e.map(o);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+((s=t)?'"'+n(s)+'"':"end of input")+" found.";var s},t}(Error);t.SyntaxError=a,t.parse=function(e,t){t=void 0!==t?t:{};var r,n={},i={Contact:ja,Name_Addr_Header:function(){var e,t,r,i,o,s,a;for(e=vs,t=[],r=Ka();r!==n;)t.push(r),r=Ka();if(t!==n)if((r=ra())!==n)if(pa()!==n)if(ta()!==n){for(i=[],o=vs,(s=ia())!==n&&(a=za())!==n?o=s=[s,a]:(vs=o,o=n);o!==n;)i.push(o),o=vs,(s=ia())!==n&&(a=za())!==n?o=s=[s,a]:(vs=o,o=n);i!==n?(ys=e,t=Gn(),e=t):(vs=e,e=n)}else vs=e,e=n;else vs=e,e=n;else vs=e,e=n;else vs=e,e=n;return e},Record_Route:function(){var e,t,r,i,o,s;if(e=vs,(t=sc())!==n){for(r=[],i=vs,(o=na())!==n&&(s=sc())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=na())!==n&&(s=sc())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=wi(),e=t):(vs=e,e=n)}else vs=e,e=n;return e},Request_Response:Da,SIP_URI:pa,Subscription_State:function(){var t,r,i,o,s,a;if(t=vs,(r=function(){var t,r;return t=vs,e.substr(vs,6).toLowerCase()===ji?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(Gi)),r===n&&(e.substr(vs,7).toLowerCase()===Wi?(r=e.substr(vs,7),vs+=7):(r=n,0===As&&Os(Ki)),r===n&&(e.substr(vs,10).toLowerCase()===Vi?(r=e.substr(vs,10),vs+=10):(r=n,0===As&&Os(Yi)),r===n&&(r=Js()))),r!==n&&(ys=t,r=zi()),t=r}())!==n){for(i=[],o=vs,(s=ia())!==n&&(a=cc())!==n?o=s=[s,a]:(vs=o,o=n);o!==n;)i.push(o),o=vs,(s=ia())!==n&&(a=cc())!==n?o=s=[s,a]:(vs=o,o=n);i!==n?t=r=[r,i]:(vs=t,t=n)}else vs=t,t=n;return t},Supported:function(){var e,t,r,i,o,s,a;if(e=vs,t=vs,(r=Js())!==n){for(i=[],o=vs,(s=na())!==n&&(a=Js())!==n?(ys=o,s=Mi(r,a),o=s):(vs=o,o=n);o!==n;)i.push(o),o=vs,(s=na())!==n&&(a=Js())!==n?(ys=o,s=Mi(r,a),o=s):(vs=o,o=n);i!==n?(ys=t,r=Bi(r,i),t=r):(vs=t,t=n)}else vs=t,t=n;return t===n&&(t=null),t!==n&&(ys=e,t=vo(t)),e=t},Require:function(){var e,t,r,i,o,s,a;if(e=vs,t=vs,(r=Js())!==n){for(i=[],o=vs,(s=na())!==n&&(a=Js())!==n?(ys=o,s=Mi(r,a),o=s):(vs=o,o=n);o!==n;)i.push(o),o=vs,(s=na())!==n&&(a=Js())!==n?(ys=o,s=Mi(r,a),o=s):(vs=o,o=n);i!==n?(ys=t,r=Bi(r,i),t=r):(vs=t,t=n)}else vs=t,t=n;return t===n&&(t=null),t!==n&&(ys=e,t=Fi(t)),e=t},Via:function(){var e,t,r,i,o,s;if(e=vs,(t=hc())!==n){for(r=[],i=vs,(o=na())!==n&&(s=hc())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=na())!==n&&(s=hc())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?e=t=[t,r]:(vs=e,e=n)}else vs=e,e=n;return e},absoluteURI:ka,Call_ID:Fa,Content_Disposition:function(){var t,r,i,o,s,a;if(t=vs,(r=function(){var t,r;return t=vs,e.substr(vs,6).toLowerCase()===rn?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(nn)),r===n&&(e.substr(vs,7).toLowerCase()===on?(r=e.substr(vs,7),vs+=7):(r=n,0===As&&Os(sn)),r===n&&(e.substr(vs,4).toLowerCase()===an?(r=e.substr(vs,4),vs+=4):(r=n,0===As&&Os(cn)),r===n&&(e.substr(vs,5).toLowerCase()===un?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(hn)),r===n&&(r=Js())))),r!==n&&(ys=t,r=dn()),t=r}())!==n){for(i=[],o=vs,(s=ia())!==n&&(a=$a())!==n?o=s=[s,a]:(vs=o,o=n);o!==n;)i.push(o),o=vs,(s=ia())!==n&&(a=$a())!==n?o=s=[s,a]:(vs=o,o=n);i!==n?t=r=[r,i]:(vs=t,t=n)}else vs=t,t=n;return t},Content_Length:function(){var e,t,r;if(e=vs,t=[],(r=ks())!==n)for(;r!==n;)t.push(r),r=ks();else t=n;return t!==n&&(ys=e,t=yn(t)),e=t},Content_Type:function(){var t,r;return t=vs,(r=function(){var t,r,i,o,s,a,c,u;if(t=vs,(r=function(){var t;return(t=function(){var t;return e.substr(vs,4).toLowerCase()===Cn?(t=e.substr(vs,4),vs+=4):(t=n,0===As&&Os(Sn)),t===n&&(e.substr(vs,5).toLowerCase()===An?(t=e.substr(vs,5),vs+=5):(t=n,0===As&&Os(bn)),t===n&&(e.substr(vs,5).toLowerCase()===En?(t=e.substr(vs,5),vs+=5):(t=n,0===As&&Os(wn)),t===n&&(e.substr(vs,5).toLowerCase()===_n?(t=e.substr(vs,5),vs+=5):(t=n,0===As&&Os(Rn)),t===n&&(e.substr(vs,11).toLowerCase()===In?(t=e.substr(vs,11),vs+=11):(t=n,0===As&&Os(On)),t===n&&(t=Ja()))))),t}())===n&&(t=function(){var t;return e.substr(vs,7).toLowerCase()===Nn?(t=e.substr(vs,7),vs+=7):(t=n,0===As&&Os(Dn)),t===n&&(e.substr(vs,9).toLowerCase()===kn?(t=e.substr(vs,9),vs+=9):(t=n,0===As&&Os(xn)),t===n&&(t=Ja())),t}()),t}())!==n)if((i=Zs())!==n)if((o=function(){var e;return(e=Ja())===n&&(e=Js()),e}())!==n){for(s=[],a=vs,(c=ia())!==n&&(u=Xa())!==n?a=c=[c,u]:(vs=a,a=n);a!==n;)s.push(a),a=vs,(c=ia())!==n&&(u=Xa())!==n?a=c=[c,u]:(vs=a,a=n);s!==n?t=r=[r,i,o,s]:(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;else vs=t,t=n;return t}())!==n&&(ys=t,r=Tn()),t=r},CSeq:function(){var e,t,r,i;return e=vs,(t=function(){var e,t,r;if(e=vs,t=[],(r=ks())!==n)for(;r!==n;)t.push(r),r=ks();else t=n;return t!==n&&(ys=e,t=Ln(t)),e=t}())!==n&&(r=Ks())!==n&&(i=Ba())!==n?e=t=[t,r,i]:(vs=e,e=n),e},displayName:Ka,Event:function(){var e,t,r,i,o,s;if(e=vs,(t=Qa())!==n){for(r=[],i=vs,(o=ia())!==n&&(s=za())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=za())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=Hn(t),e=t):(vs=e,e=n)}else vs=e,e=n;return e},From:function(){var e,t,r,i,o,s;if(e=vs,(t=da())===n&&(t=Wa()),t!==n){for(r=[],i=vs,(o=ia())!==n&&(s=Za())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=Za())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=qn(),e=t):(vs=e,e=n)}else vs=e,e=n;return e},host:va,Max_Forwards:function(){var e,t,r;if(e=vs,t=[],(r=ks())!==n)for(;r!==n;)t.push(r),r=ks();else t=n;return t!==n&&(ys=e,t=jn(t)),e=t},Min_SE:function(){var e,t,r,i,o,s;if(e=vs,(t=Ya())!==n){for(r=[],i=vs,(o=ia())!==n&&(s=za())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=za())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=Xo(t),e=t):(vs=e,e=n)}else vs=e,e=n;return e},Proxy_Authenticate:function(){return tc()},quoted_string:aa,Refer_To:function(){var e,t,r,i,o,s;if(e=vs,(t=da())===n&&(t=Wa())===n&&(t=vs,(r=ra())===n&&(r=null),r!==n&&(i=ka())!==n?((o=ta())===n&&(o=null),o!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n)),t!==n){for(r=[],i=vs,(o=ia())!==n&&(s=za())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=za())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=Ri(),e=t):(vs=e,e=n)}else vs=e,e=n;return e},Replaces:function(){var e,t,r,i,o,s;if(e=vs,(t=function(){var e,t;return e=vs,(t=Fa())!==n&&(ys=e,t=Oi()),e=t}())!==n){for(r=[],i=vs,(o=ia())!==n&&(s=ac())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=ac())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=Ii(),e=t):(vs=e,e=n)}else vs=e,e=n;return e},Session_Expires:function(){var e,t,r,i,o,s;if(e=vs,(t=Ya())!==n){for(r=[],i=vs,(o=ia())!==n&&(s=fc())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=fc())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=Go(t),e=t):(vs=e,e=n)}else vs=e,e=n;return e},stun_URI:function(){var t,r,i,o;return t=vs,(r=function(){var t,r;return t=vs,e.substr(vs,5).toLowerCase()===Qo?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(Zo)),r===n&&(e.substr(vs,4).toLowerCase()===es?(r=e.substr(vs,4),vs+=4):(r=n,0===As&&Os(ts))),r!==n&&(ys=t,r=rs(r)),t=r}())!==n?(58===e.charCodeAt(vs)?(i=x,vs++):(i=n,0===As&&Os(U)),i!==n&&(o=gc())!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n),t},To:function(){var e,t,r,i,o,s;if(e=vs,(t=da())===n&&(t=Wa()),t!==n){for(r=[],i=vs,(o=ia())!==n&&(s=uc())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=uc())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,t=yo(),e=t):(vs=e,e=n)}else vs=e,e=n;return e},turn_URI:function(){var t,r,i,o,s,a,c;return t=vs,(r=function(){var t,r;return t=vs,e.substr(vs,5).toLowerCase()===ss?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(as)),r===n&&(e.substr(vs,4).toLowerCase()===cs?(r=e.substr(vs,4),vs+=4):(r=n,0===As&&Os(us))),r!==n&&(ys=t,r=rs(r)),t=r}())!==n?(58===e.charCodeAt(vs)?(i=x,vs++):(i=n,0===As&&Os(U)),i!==n&&(o=gc())!==n?(s=vs,e.substr(vs,11)===is?(a=is,vs+=11):(a=n,0===As&&Os(os)),a!==n&&(c=pc())!==n?s=a=[a,c]:(vs=s,s=n),s===n&&(s=null),s!==n?t=r=[r,i,o,s]:(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t},uuid:function(){var t,r,i,o,s,a;return t=vs,(r=function(){var e,t,r;return e=vs,(t=mc())!==n&&(r=mc())!==n?e=t=[t,r]:(vs=e,e=n),e}())!==n?(45===e.charCodeAt(vs)?(i=Y,vs++):(i=n,0===As&&Os(z)),i!==n&&mc()!==n?(45===e.charCodeAt(vs)?(o=Y,vs++):(o=n,0===As&&Os(z)),o!==n&&mc()!==n?(45===e.charCodeAt(vs)?(s=Y,vs++):(s=n,0===As&&Os(z)),s!==n&&mc()!==n?(45===e.charCodeAt(vs)?(a=Y,vs++):(a=n,0===As&&Os(z)),a!==n&&function(){var e,t,r,i;return e=vs,(t=mc())!==n&&(r=mc())!==n&&(i=mc())!==n?e=t=[t,r,i]:(vs=e,e=n),e}()!==n?(ys=t,r=hs(),t=r):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t},WWW_Authenticate:function(){return tc()},challenge:tc,sipfrag:function(){var e,t,r,i,o,s;if(e=vs,(t=Da())!==n){for(r=[],i=Oa();i!==n;)r.push(i),i=Oa();r!==n?(i=vs,(o=Ds())!==n&&(s=function(){var e,t;for(e=[],t=Ls();t!==n;)e.push(t),t=Ls();return e}())!==n?i=o=[o,s]:(vs=i,i=n),i===n&&(i=null),i!==n?e=t=[t,r,i]:(vs=e,e=n)):(vs=e,e=n)}else vs=e,e=n;return e},Referred_By:function(){var t,r,i,o,s,a,c,u;if(t=vs,e.substr(vs,11)===ds?(r=ds,vs+=11):(r=n,0===As&&Os(ps)),r===n&&(98===e.charCodeAt(vs)?(r=ls,vs++):(r=n,0===As&&Os(fs))),r!==n)if((i=Ys())!==n)if((o=function(){var e;return(e=Wa())===n&&(e=da()),e}())!==n){for(s=[],a=vs,(c=ia())!==n?((u=vc())===n&&(u=za()),u!==n?a=c=[c,u]:(vs=a,a=n)):(vs=a,a=n);a!==n;)s.push(a),a=vs,(c=ia())!==n?((u=vc())===n&&(u=za()),u!==n?a=c=[c,u]:(vs=a,a=n)):(vs=a,a=n);s!==n?t=r=[r,i,o,s]:(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;else vs=t,t=n;return t}},c=ja,u="\r\n",h=ws("\r\n",!1),d=/^[0-9]/,p=_s([["0","9"]],!1,!1),l=/^[a-zA-Z]/,f=_s([["a","z"],["A","Z"]],!1,!1),g=/^[0-9a-fA-F]/,m=_s([["0","9"],["a","f"],["A","F"]],!1,!1),v=/^[\0-\xFF]/,y=_s([["\0","ÿ"]],!1,!1),T=/^["]/,C=_s(['"'],!1,!1),S=" ",A=ws(" ",!1),b="\t",E=ws("\t",!1),w=/^[a-zA-Z0-9]/,_=_s([["a","z"],["A","Z"],["0","9"]],!1,!1),R=";",I=ws(";",!1),O="/",N=ws("/",!1),D="?",k=ws("?",!1),x=":",U=ws(":",!1),P="@",L=ws("@",!1),H="&",q=ws("&",!1),M="=",B=ws("=",!1),F="+",j=ws("+",!1),G="$",W=ws("$",!1),K=",",V=ws(",",!1),Y="-",z=ws("-",!1),$="_",J=ws("_",!1),X=".",Q=ws(".",!1),Z="!",ee=ws("!",!1),te="~",re=ws("~",!1),ne="*",ie=ws("*",!1),oe="'",se=ws("'",!1),ae="(",ce=ws("(",!1),ue=")",he=ws(")",!1),de="%",pe=ws("%",!1),le=function(){return" "},fe=function(){return":"},ge=(_s([["!","~"]],!1,!1),/^[\x80-\uFFFF]/),me=_s([["","￿"]],!1,!1),ve=/^[\x80-\xBF]/,ye=_s([["","¿"]],!1,!1),Te=(_s([["a","f"]],!1,!1),"`"),Ce=ws("`",!1),Se="<",Ae=ws("<",!1),be=">",Ee=ws(">",!1),we="\\",_e=ws("\\",!1),Re="[",Ie=ws("[",!1),Oe="]",Ne=ws("]",!1),De="{",ke=ws("{",!1),xe="}",Ue=ws("}",!1),Pe=function(){return"*"},Le=function(){return"/"},He=function(){return"="},qe=function(){return">"},Me=function(){return"<"},Be=function(){return","},Fe=function(){return";"},je=function(){return":"},Ge=function(){return'"'},We=(_s([["!","'"]],!1,!1),_s([["*","["]],!1,!1),/^[\]-~]/),Ke=_s([["]","~"]],!1,!1),Ve=function(e){return e},Ye=/^[#-[]/,ze=_s([["#","["]],!1,!1),$e=/^[\0-\t]/,Je=_s([["\0","\t"]],!1,!1),Xe=/^[\x0B-\f]/,Qe=_s([["\v","\f"]],!1,!1),Ze=/^[\x0E-\x7F]/,et=_s([["",""]],!1,!1),tt=function(){(t=t||{data:{}}).data.uri=new s.URI(t.data.scheme,t.data.user,t.data.host,t.data.port),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port},rt=function(){(t=t||{data:{}}).data.uri=new s.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params,"SIP_URI"===t.startRule&&(t.data=t.data.uri)},nt="sips",it=ws("sips",!0),ot="sip",st=ws("sip",!0),at=function(e){(t=t||{data:{}}).data.scheme=e},ct=function(){(t=t||{data:{}}).data.user=decodeURIComponent(bs().slice(0,-1))},ut=function(){(t=t||{data:{}}).data.password=bs()},ht=function(){return(t=t||{data:{}}).data.host=bs(),t.data.host},dt=function(){return(t=t||{data:{}}).data.host_type="domain",bs()},pt=/^[a-zA-Z0-9_\-]/,lt=_s([["a","z"],["A","Z"],["0","9"],"_","-"],!1,!1),ft=/^[a-zA-Z0-9\-]/,gt=_s([["a","z"],["A","Z"],["0","9"],"-"],!1,!1),mt=function(){return(t=t||{data:{}}).data.host_type="IPv6",bs()},vt="::",yt=ws("::",!1),Tt=function(){return(t=t||{data:{}}).data.host_type="IPv6",bs()},Ct=function(){return(t=t||{data:{}}).data.host_type="IPv4",bs()},St="25",At=ws("25",!1),bt=/^[0-5]/,Et=_s([["0","5"]],!1,!1),wt="2",_t=ws("2",!1),Rt=/^[0-4]/,It=_s([["0","4"]],!1,!1),Ot="1",Nt=ws("1",!1),Dt=/^[1-9]/,kt=_s([["1","9"]],!1,!1),xt=function(e){return t=t||{data:{}},e=parseInt(e.join("")),t.data.port=e,e},Ut="transport=",Pt=ws("transport=",!0),Lt="udp",Ht=ws("udp",!0),qt="tcp",Mt=ws("tcp",!0),Bt="sctp",Ft=ws("sctp",!0),jt="tls",Gt=ws("tls",!0),Wt=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.transport=e.toLowerCase()},Kt="user=",Vt=ws("user=",!0),Yt="phone",zt=ws("phone",!0),$t="ip",Jt=ws("ip",!0),Xt=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.user=e.toLowerCase()},Qt="method=",Zt=ws("method=",!0),er=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.method=e},tr="ttl=",rr=ws("ttl=",!0),nr=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.ttl=e},ir="maddr=",or=ws("maddr=",!0),sr=function(e){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.maddr=e},ar="lr",cr=ws("lr",!0),ur=function(){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),t.data.uri_params.lr=void 0},hr=function(e,r){(t=t||{data:{}}).data.uri_params||(t.data.uri_params={}),r=null===r?void 0:r[1],t.data.uri_params[e.toLowerCase()]=r},dr=function(e,r){e=e.join("").toLowerCase(),r=r.join(""),(t=t||{data:{}}).data.uri_headers||(t.data.uri_headers={}),t.data.uri_headers[e]?t.data.uri_headers[e].push(r):t.data.uri_headers[e]=[r]},pr=function(){"Refer_To"===(t=t||{data:{}}).startRule&&(t.data.uri=new s.URI(t.data.scheme,t.data.user,t.data.host,t.data.port,t.data.uri_params,t.data.uri_headers),delete t.data.scheme,delete t.data.user,delete t.data.host,delete t.data.host_type,delete t.data.port,delete t.data.uri_params)},lr="//",fr=ws("//",!1),gr=function(){(t=t||{data:{}}).data.scheme=bs()},mr=ws("SIP",!0),vr=function(){(t=t||{data:{}}).data.sip_version=bs()},yr="INVITE",Tr=ws("INVITE",!1),Cr="ACK",Sr=ws("ACK",!1),Ar=(ws("VXACH",!1),"OPTIONS"),br=ws("OPTIONS",!1),Er="BYE",wr=ws("BYE",!1),_r="CANCEL",Rr=ws("CANCEL",!1),Ir="REGISTER",Or=ws("REGISTER",!1),Nr="SUBSCRIBE",Dr=ws("SUBSCRIBE",!1),kr="NOTIFY",xr=ws("NOTIFY",!1),Ur="REFER",Pr=ws("REFER",!1),Lr="PUBLISH",Hr=ws("PUBLISH",!1),qr=function(){return(t=t||{data:{}}).data.method=bs(),t.data.method},Mr=function(e){(t=t||{data:{}}).data.status_code=parseInt(e.join(""))},Br=function(){(t=t||{data:{}}).data.reason_phrase=bs()},Fr=function(){(t=t||{data:{}}).data=bs()},jr=function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},Gr=function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:vs,offset:Es().start.offset,parsed:e})},Wr=function(e){'"'===(e=bs().trim())[0]&&(e=e.substring(1,e.length-1)),(t=t||{data:{}}).data.displayName=e},Kr="q",Vr=ws("q",!0),Yr=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.q=e},zr="expires",$r=ws("expires",!0),Jr=function(e){(t=t||{data:{}}).data.params||(t.data.params={}),t.data.params.expires=e},Xr=function(e){return parseInt(e.join(""))},Qr="0",Zr=ws("0",!1),en=function(){return parseFloat(bs())},tn=function(e,r){(t=t||{data:{}}).data.params||(t.data.params={}),r=null===r?void 0:r[1],t.data.params[e.toLowerCase()]=r},rn="render",nn=ws("render",!0),on="session",sn=ws("session",!0),an="icon",cn=ws("icon",!0),un="alert",hn=ws("alert",!0),dn=function(){"Content_Disposition"===(t=t||{data:{}}).startRule&&(t.data.type=bs().toLowerCase())},pn="handling",ln=ws("handling",!0),fn="optional",gn=ws("optional",!0),mn="required",vn=ws("required",!0),yn=function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},Tn=function(){(t=t||{data:{}}).data=bs()},Cn="text",Sn=ws("text",!0),An="image",bn=ws("image",!0),En="audio",wn=ws("audio",!0),_n="video",Rn=ws("video",!0),In="application",On=ws("application",!0),Nn="message",Dn=ws("message",!0),kn="multipart",xn=ws("multipart",!0),Un="x-",Pn=ws("x-",!0),Ln=function(e){(t=t||{data:{}}).data.value=parseInt(e.join(""))},Hn=function(e){(t=t||{data:{}}).data.event=e.toLowerCase()},qn=function(){var e=(t=t||{data:{}}).data.tag;t.data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},Mn="tag",Bn=ws("tag",!0),Fn=function(e){(t=t||{data:{}}).data.tag=e},jn=function(e){(t=t||{data:{}}).data=parseInt(e.join(""))},Gn=function(){(t=t||{data:{}}).data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},Wn="digest",Kn=ws("Digest",!0),Vn="realm",Yn=ws("realm",!0),zn=function(e){(t=t||{data:{}}).data.realm=e},$n="domain",Jn=ws("domain",!0),Xn="nonce",Qn=ws("nonce",!0),Zn=function(e){(t=t||{data:{}}).data.nonce=e},ei="opaque",ti=ws("opaque",!0),ri=function(e){(t=t||{data:{}}).data.opaque=e},ni="stale",ii=ws("stale",!0),oi="true",si=ws("true",!0),ai=function(){(t=t||{data:{}}).data.stale=!0},ci="false",ui=ws("false",!0),hi=function(){(t=t||{data:{}}).data.stale=!1},di="algorithm",pi=ws("algorithm",!0),li="md5",fi=ws("MD5",!0),gi="md5-sess",mi=ws("MD5-sess",!0),vi=function(e){(t=t||{data:{}}).data.algorithm=e.toUpperCase()},yi="qop",Ti=ws("qop",!0),Ci="auth-int",Si=ws("auth-int",!0),Ai="auth",bi=ws("auth",!0),Ei=function(e){(t=t||{data:{}}).data.qop||(t.data.qop=[]),t.data.qop.push(e.toLowerCase())},wi=function(){var e,r;for(r=(t=t||{data:{}}).data.multi_header.length,e=0;e<r;e++)if(null===t.data.multi_header[e].parsed){t.data=null;break}null!==t.data?t.data=t.data.multi_header:t.data=-1},_i=function(){var e;(t=t||{data:{}}).data.multi_header||(t.data.multi_header=[]);try{e=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),delete t.data.uri,delete t.data.displayName,delete t.data.params}catch(t){e=null}t.data.multi_header.push({position:vs,offset:Es().start.offset,parsed:e})},Ri=function(){(t=t||{data:{}}).data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params)},Ii=function(){(t=t||{data:{}}).data.replaces_from_tag&&t.data.replaces_to_tag||(t.data=-1)},Oi=function(){(t=t||{data:{}}).data={call_id:t.data}},Ni="from-tag",Di=ws("from-tag",!0),ki=function(e){(t=t||{data:{}}).data.replaces_from_tag=e},xi="to-tag",Ui=ws("to-tag",!0),Pi=function(e){(t=t||{data:{}}).data.replaces_to_tag=e},Li="early-only",Hi=ws("early-only",!0),qi=function(){(t=t||{data:{}}).data.early_only=!0},Mi=function(e,t){return t},Bi=function(e,t){return function(e,t){return[e].concat(t)}(e,t)},Fi=function(e){"Require"===(t=t||{data:{}}).startRule&&(t.data=e||[])},ji="active",Gi=ws("active",!0),Wi="pending",Ki=ws("pending",!0),Vi="terminated",Yi=ws("terminated",!0),zi=function(){(t=t||{data:{}}).data.state=bs()},$i="reason",Ji=ws("reason",!0),Xi=function(e){t=t||{data:{}},void 0!==e&&(t.data.reason=e)},Qi=function(e){t=t||{data:{}},void 0!==e&&(t.data.expires=e)},Zi="retry_after",eo=ws("retry_after",!0),to=function(e){t=t||{data:{}},void 0!==e&&(t.data.retry_after=e)},ro="deactivated",no=ws("deactivated",!0),io="probation",oo=ws("probation",!0),so="rejected",ao=ws("rejected",!0),co="timeout",uo=ws("timeout",!0),ho="giveup",po=ws("giveup",!0),lo="noresource",fo=ws("noresource",!0),go="invariant",mo=ws("invariant",!0),vo=function(e){"Supported"===(t=t||{data:{}}).startRule&&(t.data=e||[])},yo=function(){var e=(t=t||{data:{}}).data.tag;t.data=new o.NameAddrHeader(t.data.uri,t.data.displayName,t.data.params),e&&t.data.setParam("tag",e)},To="ttl",Co=ws("ttl",!0),So=function(e){(t=t||{data:{}}).data.ttl=e},Ao="maddr",bo=ws("maddr",!0),Eo=function(e){(t=t||{data:{}}).data.maddr=e},wo="received",_o=ws("received",!0),Ro=function(e){(t=t||{data:{}}).data.received=e},Io="branch",Oo=ws("branch",!0),No=function(e){(t=t||{data:{}}).data.branch=e},Do="rport",ko=ws("rport",!0),xo=function(e){t=t||{data:{}},void 0!==e&&(t.data.rport=e.join(""))},Uo=function(e){(t=t||{data:{}}).data.protocol=e},Po=ws("UDP",!0),Lo=ws("TCP",!0),Ho=ws("TLS",!0),qo=ws("SCTP",!0),Mo=function(e){(t=t||{data:{}}).data.transport=e},Bo=function(){(t=t||{data:{}}).data.host=bs()},Fo=function(e){(t=t||{data:{}}).data.port=parseInt(e.join(""))},jo=function(e){return parseInt(e.join(""))},Go=function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.deltaSeconds=e)},Wo="refresher",Ko=ws("refresher",!1),Vo="uas",Yo=ws("uas",!1),zo="uac",$o=ws("uac",!1),Jo=function(e){"Session_Expires"===(t=t||{data:{}}).startRule&&(t.data.refresher=e)},Xo=function(e){"Min_SE"===(t=t||{data:{}}).startRule&&(t.data=e)},Qo="stuns",Zo=ws("stuns",!0),es="stun",ts=ws("stun",!0),rs=function(e){(t=t||{data:{}}).data.scheme=e},ns=function(e){(t=t||{data:{}}).data.host=e},is="?transport=",os=ws("?transport=",!1),ss="turns",as=ws("turns",!0),cs="turn",us=ws("turn",!0),hs=function(){(t=t||{data:{}}).data=bs()},ds="Referred-By",ps=ws("Referred-By",!1),ls="b",fs=ws("b",!1),gs="cid",ms=ws("cid",!1),vs=0,ys=0,Ts=[{line:1,column:1}],Cs=0,Ss=[],As=0;if(void 0!==t.startRule){if(!(t.startRule in i))throw new Error("Can't start parsing from rule \""+t.startRule+'".');c=i[t.startRule]}function bs(){return e.substring(ys,vs)}function Es(){return Is(ys,vs)}function ws(e,t){return{type:"literal",text:e,ignoreCase:t}}function _s(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function Rs(t){var r,n=Ts[t];if(n)return n;for(r=t-1;!Ts[r];)r--;for(n={line:(n=Ts[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Ts[t]=n,n}function Is(e,t){var r=Rs(e),n=Rs(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function Os(e){vs<Cs||(vs>Cs&&(Cs=vs,Ss=[]),Ss.push(e))}function Ns(e,t,r){return new a(a.buildMessage(e,t),e,t,r)}function Ds(){var t;return e.substr(vs,2)===u?(t=u,vs+=2):(t=n,0===As&&Os(h)),t}function ks(){var t;return d.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(p)),t}function xs(){var t;return l.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(f)),t}function Us(){var t;return g.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(m)),t}function Ps(){var e;return(e=qs())===n&&(e=Ms()),e}function Ls(){var t;return v.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(y)),t}function Hs(){var t;return T.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(C)),t}function qs(){var t;return 32===e.charCodeAt(vs)?(t=S,vs++):(t=n,0===As&&Os(A)),t}function Ms(){var t;return 9===e.charCodeAt(vs)?(t=b,vs++):(t=n,0===As&&Os(E)),t}function Bs(){var t;return w.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(_)),t}function Fs(){var t;return 59===e.charCodeAt(vs)?(t=R,vs++):(t=n,0===As&&Os(I)),t===n&&(47===e.charCodeAt(vs)?(t=O,vs++):(t=n,0===As&&Os(N)),t===n&&(63===e.charCodeAt(vs)?(t=D,vs++):(t=n,0===As&&Os(k)),t===n&&(58===e.charCodeAt(vs)?(t=x,vs++):(t=n,0===As&&Os(U)),t===n&&(64===e.charCodeAt(vs)?(t=P,vs++):(t=n,0===As&&Os(L)),t===n&&(38===e.charCodeAt(vs)?(t=H,vs++):(t=n,0===As&&Os(q)),t===n&&(61===e.charCodeAt(vs)?(t=M,vs++):(t=n,0===As&&Os(B)),t===n&&(43===e.charCodeAt(vs)?(t=F,vs++):(t=n,0===As&&Os(j)),t===n&&(36===e.charCodeAt(vs)?(t=G,vs++):(t=n,0===As&&Os(W)),t===n&&(44===e.charCodeAt(vs)?(t=K,vs++):(t=n,0===As&&Os(V))))))))))),t}function js(){var e;return(e=Bs())===n&&(e=Gs()),e}function Gs(){var t;return 45===e.charCodeAt(vs)?(t=Y,vs++):(t=n,0===As&&Os(z)),t===n&&(95===e.charCodeAt(vs)?(t=$,vs++):(t=n,0===As&&Os(J)),t===n&&(46===e.charCodeAt(vs)?(t=X,vs++):(t=n,0===As&&Os(Q)),t===n&&(33===e.charCodeAt(vs)?(t=Z,vs++):(t=n,0===As&&Os(ee)),t===n&&(126===e.charCodeAt(vs)?(t=te,vs++):(t=n,0===As&&Os(re)),t===n&&(42===e.charCodeAt(vs)?(t=ne,vs++):(t=n,0===As&&Os(ie)),t===n&&(39===e.charCodeAt(vs)?(t=oe,vs++):(t=n,0===As&&Os(se)),t===n&&(40===e.charCodeAt(vs)?(t=ae,vs++):(t=n,0===As&&Os(ce)),t===n&&(41===e.charCodeAt(vs)?(t=ue,vs++):(t=n,0===As&&Os(he)))))))))),t}function Ws(){var t,r,i,o,s;return t=vs,r=vs,37===e.charCodeAt(vs)?(i=de,vs++):(i=n,0===As&&Os(pe)),i!==n&&(o=Us())!==n&&(s=Us())!==n?r=i=[i,o,s]:(vs=r,r=n),t=r!==n?e.substring(t,vs):r}function Ks(){var e,t,r,i;for(e=vs,t=vs,r=[],i=Ps();i!==n;)r.push(i),i=Ps();if(r!==n&&(i=Ds())!==n?t=r=[r,i]:(vs=t,t=n),t===n&&(t=null),t!==n){if(r=[],(i=Ps())!==n)for(;i!==n;)r.push(i),i=Ps();else r=n;r!==n?(ys=e,e=t=le()):(vs=e,e=n)}else vs=e,e=n;return e}function Vs(){var e;return(e=Ks())===n&&(e=null),e}function Ys(){var t,r,i;for(t=vs,r=[],(i=qs())===n&&(i=Ms());i!==n;)r.push(i),(i=qs())===n&&(i=Ms());return r!==n?(58===e.charCodeAt(vs)?(i=x,vs++):(i=n,0===As&&Os(U)),i!==n&&Vs()!==n?(ys=t,t=r=fe()):(vs=t,t=n)):(vs=t,t=n),t}function zs(){var t;return ge.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(me)),t}function $s(){var t;return ve.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(ye)),t}function Js(){var t,r,i;if(t=vs,r=[],(i=Bs())===n&&(45===e.charCodeAt(vs)?(i=Y,vs++):(i=n,0===As&&Os(z)),i===n&&(46===e.charCodeAt(vs)?(i=X,vs++):(i=n,0===As&&Os(Q)),i===n&&(33===e.charCodeAt(vs)?(i=Z,vs++):(i=n,0===As&&Os(ee)),i===n&&(37===e.charCodeAt(vs)?(i=de,vs++):(i=n,0===As&&Os(pe)),i===n&&(42===e.charCodeAt(vs)?(i=ne,vs++):(i=n,0===As&&Os(ie)),i===n&&(95===e.charCodeAt(vs)?(i=$,vs++):(i=n,0===As&&Os(J)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(96===e.charCodeAt(vs)?(i=Te,vs++):(i=n,0===As&&Os(Ce)),i===n&&(39===e.charCodeAt(vs)?(i=oe,vs++):(i=n,0===As&&Os(se)),i===n&&(126===e.charCodeAt(vs)?(i=te,vs++):(i=n,0===As&&Os(re)))))))))))),i!==n)for(;i!==n;)r.push(i),(i=Bs())===n&&(45===e.charCodeAt(vs)?(i=Y,vs++):(i=n,0===As&&Os(z)),i===n&&(46===e.charCodeAt(vs)?(i=X,vs++):(i=n,0===As&&Os(Q)),i===n&&(33===e.charCodeAt(vs)?(i=Z,vs++):(i=n,0===As&&Os(ee)),i===n&&(37===e.charCodeAt(vs)?(i=de,vs++):(i=n,0===As&&Os(pe)),i===n&&(42===e.charCodeAt(vs)?(i=ne,vs++):(i=n,0===As&&Os(ie)),i===n&&(95===e.charCodeAt(vs)?(i=$,vs++):(i=n,0===As&&Os(J)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(96===e.charCodeAt(vs)?(i=Te,vs++):(i=n,0===As&&Os(Ce)),i===n&&(39===e.charCodeAt(vs)?(i=oe,vs++):(i=n,0===As&&Os(se)),i===n&&(126===e.charCodeAt(vs)?(i=te,vs++):(i=n,0===As&&Os(re))))))))))));else r=n;return t=r!==n?e.substring(t,vs):r}function Xs(){var t,r,i;if(t=vs,r=[],(i=Bs())===n&&(45===e.charCodeAt(vs)?(i=Y,vs++):(i=n,0===As&&Os(z)),i===n&&(33===e.charCodeAt(vs)?(i=Z,vs++):(i=n,0===As&&Os(ee)),i===n&&(37===e.charCodeAt(vs)?(i=de,vs++):(i=n,0===As&&Os(pe)),i===n&&(42===e.charCodeAt(vs)?(i=ne,vs++):(i=n,0===As&&Os(ie)),i===n&&(95===e.charCodeAt(vs)?(i=$,vs++):(i=n,0===As&&Os(J)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(96===e.charCodeAt(vs)?(i=Te,vs++):(i=n,0===As&&Os(Ce)),i===n&&(39===e.charCodeAt(vs)?(i=oe,vs++):(i=n,0===As&&Os(se)),i===n&&(126===e.charCodeAt(vs)?(i=te,vs++):(i=n,0===As&&Os(re))))))))))),i!==n)for(;i!==n;)r.push(i),(i=Bs())===n&&(45===e.charCodeAt(vs)?(i=Y,vs++):(i=n,0===As&&Os(z)),i===n&&(33===e.charCodeAt(vs)?(i=Z,vs++):(i=n,0===As&&Os(ee)),i===n&&(37===e.charCodeAt(vs)?(i=de,vs++):(i=n,0===As&&Os(pe)),i===n&&(42===e.charCodeAt(vs)?(i=ne,vs++):(i=n,0===As&&Os(ie)),i===n&&(95===e.charCodeAt(vs)?(i=$,vs++):(i=n,0===As&&Os(J)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(96===e.charCodeAt(vs)?(i=Te,vs++):(i=n,0===As&&Os(Ce)),i===n&&(39===e.charCodeAt(vs)?(i=oe,vs++):(i=n,0===As&&Os(se)),i===n&&(126===e.charCodeAt(vs)?(i=te,vs++):(i=n,0===As&&Os(re)))))))))));else r=n;return t=r!==n?e.substring(t,vs):r}function Qs(){var t,r,i;if(t=vs,r=[],(i=Bs())===n&&(45===e.charCodeAt(vs)?(i=Y,vs++):(i=n,0===As&&Os(z)),i===n&&(46===e.charCodeAt(vs)?(i=X,vs++):(i=n,0===As&&Os(Q)),i===n&&(33===e.charCodeAt(vs)?(i=Z,vs++):(i=n,0===As&&Os(ee)),i===n&&(37===e.charCodeAt(vs)?(i=de,vs++):(i=n,0===As&&Os(pe)),i===n&&(42===e.charCodeAt(vs)?(i=ne,vs++):(i=n,0===As&&Os(ie)),i===n&&(95===e.charCodeAt(vs)?(i=$,vs++):(i=n,0===As&&Os(J)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(96===e.charCodeAt(vs)?(i=Te,vs++):(i=n,0===As&&Os(Ce)),i===n&&(39===e.charCodeAt(vs)?(i=oe,vs++):(i=n,0===As&&Os(se)),i===n&&(126===e.charCodeAt(vs)?(i=te,vs++):(i=n,0===As&&Os(re)),i===n&&(40===e.charCodeAt(vs)?(i=ae,vs++):(i=n,0===As&&Os(ce)),i===n&&(41===e.charCodeAt(vs)?(i=ue,vs++):(i=n,0===As&&Os(he)),i===n&&(60===e.charCodeAt(vs)?(i=Se,vs++):(i=n,0===As&&Os(Ae)),i===n&&(62===e.charCodeAt(vs)?(i=be,vs++):(i=n,0===As&&Os(Ee)),i===n&&(58===e.charCodeAt(vs)?(i=x,vs++):(i=n,0===As&&Os(U)),i===n&&(92===e.charCodeAt(vs)?(i=we,vs++):(i=n,0===As&&Os(_e)),i===n&&(i=Hs())===n&&(47===e.charCodeAt(vs)?(i=O,vs++):(i=n,0===As&&Os(N)),i===n&&(91===e.charCodeAt(vs)?(i=Re,vs++):(i=n,0===As&&Os(Ie)),i===n&&(93===e.charCodeAt(vs)?(i=Oe,vs++):(i=n,0===As&&Os(Ne)),i===n&&(63===e.charCodeAt(vs)?(i=D,vs++):(i=n,0===As&&Os(k)),i===n&&(123===e.charCodeAt(vs)?(i=De,vs++):(i=n,0===As&&Os(ke)),i===n&&(125===e.charCodeAt(vs)?(i=xe,vs++):(i=n,0===As&&Os(Ue)))))))))))))))))))))))),i!==n)for(;i!==n;)r.push(i),(i=Bs())===n&&(45===e.charCodeAt(vs)?(i=Y,vs++):(i=n,0===As&&Os(z)),i===n&&(46===e.charCodeAt(vs)?(i=X,vs++):(i=n,0===As&&Os(Q)),i===n&&(33===e.charCodeAt(vs)?(i=Z,vs++):(i=n,0===As&&Os(ee)),i===n&&(37===e.charCodeAt(vs)?(i=de,vs++):(i=n,0===As&&Os(pe)),i===n&&(42===e.charCodeAt(vs)?(i=ne,vs++):(i=n,0===As&&Os(ie)),i===n&&(95===e.charCodeAt(vs)?(i=$,vs++):(i=n,0===As&&Os(J)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(96===e.charCodeAt(vs)?(i=Te,vs++):(i=n,0===As&&Os(Ce)),i===n&&(39===e.charCodeAt(vs)?(i=oe,vs++):(i=n,0===As&&Os(se)),i===n&&(126===e.charCodeAt(vs)?(i=te,vs++):(i=n,0===As&&Os(re)),i===n&&(40===e.charCodeAt(vs)?(i=ae,vs++):(i=n,0===As&&Os(ce)),i===n&&(41===e.charCodeAt(vs)?(i=ue,vs++):(i=n,0===As&&Os(he)),i===n&&(60===e.charCodeAt(vs)?(i=Se,vs++):(i=n,0===As&&Os(Ae)),i===n&&(62===e.charCodeAt(vs)?(i=be,vs++):(i=n,0===As&&Os(Ee)),i===n&&(58===e.charCodeAt(vs)?(i=x,vs++):(i=n,0===As&&Os(U)),i===n&&(92===e.charCodeAt(vs)?(i=we,vs++):(i=n,0===As&&Os(_e)),i===n&&(i=Hs())===n&&(47===e.charCodeAt(vs)?(i=O,vs++):(i=n,0===As&&Os(N)),i===n&&(91===e.charCodeAt(vs)?(i=Re,vs++):(i=n,0===As&&Os(Ie)),i===n&&(93===e.charCodeAt(vs)?(i=Oe,vs++):(i=n,0===As&&Os(Ne)),i===n&&(63===e.charCodeAt(vs)?(i=D,vs++):(i=n,0===As&&Os(k)),i===n&&(123===e.charCodeAt(vs)?(i=De,vs++):(i=n,0===As&&Os(ke)),i===n&&(125===e.charCodeAt(vs)?(i=xe,vs++):(i=n,0===As&&Os(Ue))))))))))))))))))))))));else r=n;return t=r!==n?e.substring(t,vs):r}function Zs(){var t,r;return t=vs,Vs()!==n?(47===e.charCodeAt(vs)?(r=O,vs++):(r=n,0===As&&Os(N)),r!==n&&Vs()!==n?(ys=t,t=Le()):(vs=t,t=n)):(vs=t,t=n),t}function ea(){var t,r;return t=vs,Vs()!==n?(61===e.charCodeAt(vs)?(r=M,vs++):(r=n,0===As&&Os(B)),r!==n&&Vs()!==n?(ys=t,t=He()):(vs=t,t=n)):(vs=t,t=n),t}function ta(){var t,r;return t=vs,62===e.charCodeAt(vs)?(r=be,vs++):(r=n,0===As&&Os(Ee)),r!==n&&Vs()!==n?(ys=t,t=r=qe()):(vs=t,t=n),t}function ra(){var t,r;return t=vs,Vs()!==n?(60===e.charCodeAt(vs)?(r=Se,vs++):(r=n,0===As&&Os(Ae)),r!==n?(ys=t,t=Me()):(vs=t,t=n)):(vs=t,t=n),t}function na(){var t,r;return t=vs,Vs()!==n?(44===e.charCodeAt(vs)?(r=K,vs++):(r=n,0===As&&Os(V)),r!==n&&Vs()!==n?(ys=t,t=Be()):(vs=t,t=n)):(vs=t,t=n),t}function ia(){var t,r;return t=vs,Vs()!==n?(59===e.charCodeAt(vs)?(r=R,vs++):(r=n,0===As&&Os(I)),r!==n&&Vs()!==n?(ys=t,t=Fe()):(vs=t,t=n)):(vs=t,t=n),t}function oa(){var e;return e=vs,Vs()!==n&&Hs()!==n?(ys=e,e=Ge()):(vs=e,e=n),e}function sa(){var e;return e=vs,Hs()!==n&&Vs()!==n?(ys=e,e=Ge()):(vs=e,e=n),e}function aa(){var t,r,i,o,s,a;if(t=vs,r=vs,(i=Vs())!==n)if((o=Hs())!==n){for(s=[],(a=ua())===n&&(a=ha());a!==n;)s.push(a),(a=ua())===n&&(a=ha());s!==n&&(a=Hs())!==n?r=i=[i,o,s,a]:(vs=r,r=n)}else vs=r,r=n;else vs=r,r=n;return t=r!==n?e.substring(t,vs):r}function ca(){var t,r,i,o;if(t=vs,Vs()!==n)if(Hs()!==n){for(r=vs,i=[],(o=ua())===n&&(o=ha());o!==n;)i.push(o),(o=ua())===n&&(o=ha());(r=i!==n?e.substring(r,vs):i)!==n&&(i=Hs())!==n?(ys=t,t=Ve(r)):(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;return t}function ua(){var t;return(t=Ks())===n&&(33===e.charCodeAt(vs)?(t=Z,vs++):(t=n,0===As&&Os(ee)),t===n&&(Ye.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(ze)),t===n&&(We.test(e.charAt(vs))?(t=e.charAt(vs),vs++):(t=n,0===As&&Os(Ke)),t===n&&(t=zs())))),t}function ha(){var t,r,i;return t=vs,92===e.charCodeAt(vs)?(r=we,vs++):(r=n,0===As&&Os(_e)),r!==n?($e.test(e.charAt(vs))?(i=e.charAt(vs),vs++):(i=n,0===As&&Os(Je)),i===n&&(Xe.test(e.charAt(vs))?(i=e.charAt(vs),vs++):(i=n,0===As&&Os(Qe)),i===n&&(Ze.test(e.charAt(vs))?(i=e.charAt(vs),vs++):(i=n,0===As&&Os(et)))),i!==n?t=r=[r,i]:(vs=t,t=n)):(vs=t,t=n),t}function da(){var t,r,i;return t=vs,la()!==n?(58===e.charCodeAt(vs)?(r=x,vs++):(r=n,0===As&&Os(U)),r!==n?((i=fa())===n&&(i=null),i!==n&&ma()!==n?(ys=t,t=tt()):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t}function pa(){var t,r,i,o;return t=vs,la()!==n?(58===e.charCodeAt(vs)?(r=x,vs++):(r=n,0===As&&Os(U)),r!==n?((i=fa())===n&&(i=null),i!==n&&ma()!==n&&function(){var t,r,i,o;for(t=[],r=vs,59===e.charCodeAt(vs)?(i=R,vs++):(i=n,0===As&&Os(I)),i!==n&&(o=Ra())!==n?r=i=[i,o]:(vs=r,r=n);r!==n;)t.push(r),r=vs,59===e.charCodeAt(vs)?(i=R,vs++):(i=n,0===As&&Os(I)),i!==n&&(o=Ra())!==n?r=i=[i,o]:(vs=r,r=n);return t}()!==n?((o=function(){var t,r,i,o,s,a,c;if(t=vs,63===e.charCodeAt(vs)?(r=D,vs++):(r=n,0===As&&Os(k)),r!==n)if((i=Oa())!==n){for(o=[],s=vs,38===e.charCodeAt(vs)?(a=H,vs++):(a=n,0===As&&Os(q)),a!==n&&(c=Oa())!==n?s=a=[a,c]:(vs=s,s=n);s!==n;)o.push(s),s=vs,38===e.charCodeAt(vs)?(a=H,vs++):(a=n,0===As&&Os(q)),a!==n&&(c=Oa())!==n?s=a=[a,c]:(vs=s,s=n);o!==n?t=r=[r,i,o]:(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;return t}())===n&&(o=null),o!==n?(ys=t,t=rt()):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t}function la(){var t,r;return t=vs,e.substr(vs,4).toLowerCase()===nt?(r=e.substr(vs,4),vs+=4):(r=n,0===As&&Os(it)),r===n&&(e.substr(vs,3).toLowerCase()===ot?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(st))),r!==n&&(ys=t,r=at(r)),t=r}function fa(){var t,r,i,o;return t=vs,function(){var e,t;if(e=[],(t=js())===n&&(t=Ws())===n&&(t=ga()),t!==n)for(;t!==n;)e.push(t),(t=js())===n&&(t=Ws())===n&&(t=ga());else e=n;return e}()!==n?(r=vs,58===e.charCodeAt(vs)?(i=x,vs++):(i=n,0===As&&Os(U)),i!==n&&(o=function(){var t,r,i;for(t=vs,r=[],(i=js())===n&&(i=Ws())===n&&(38===e.charCodeAt(vs)?(i=H,vs++):(i=n,0===As&&Os(q)),i===n&&(61===e.charCodeAt(vs)?(i=M,vs++):(i=n,0===As&&Os(B)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(36===e.charCodeAt(vs)?(i=G,vs++):(i=n,0===As&&Os(W)),i===n&&(44===e.charCodeAt(vs)?(i=K,vs++):(i=n,0===As&&Os(V)))))));i!==n;)r.push(i),(i=js())===n&&(i=Ws())===n&&(38===e.charCodeAt(vs)?(i=H,vs++):(i=n,0===As&&Os(q)),i===n&&(61===e.charCodeAt(vs)?(i=M,vs++):(i=n,0===As&&Os(B)),i===n&&(43===e.charCodeAt(vs)?(i=F,vs++):(i=n,0===As&&Os(j)),i===n&&(36===e.charCodeAt(vs)?(i=G,vs++):(i=n,0===As&&Os(W)),i===n&&(44===e.charCodeAt(vs)?(i=K,vs++):(i=n,0===As&&Os(V)))))));return r!==n&&(ys=t,r=ut()),t=r}())!==n?r=i=[i,o]:(vs=r,r=n),r===n&&(r=null),r!==n?(64===e.charCodeAt(vs)?(i=P,vs++):(i=n,0===As&&Os(L)),i!==n?(ys=t,t=ct()):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t}function ga(){var t;return 38===e.charCodeAt(vs)?(t=H,vs++):(t=n,0===As&&Os(q)),t===n&&(61===e.charCodeAt(vs)?(t=M,vs++):(t=n,0===As&&Os(B)),t===n&&(43===e.charCodeAt(vs)?(t=F,vs++):(t=n,0===As&&Os(j)),t===n&&(36===e.charCodeAt(vs)?(t=G,vs++):(t=n,0===As&&Os(W)),t===n&&(44===e.charCodeAt(vs)?(t=K,vs++):(t=n,0===As&&Os(V)),t===n&&(59===e.charCodeAt(vs)?(t=R,vs++):(t=n,0===As&&Os(I)),t===n&&(63===e.charCodeAt(vs)?(t=D,vs++):(t=n,0===As&&Os(k)),t===n&&(47===e.charCodeAt(vs)?(t=O,vs++):(t=n,0===As&&Os(N))))))))),t}function ma(){var t,r,i,o,s;return t=vs,(r=va())!==n?(i=vs,58===e.charCodeAt(vs)?(o=x,vs++):(o=n,0===As&&Os(U)),o!==n&&(s=_a())!==n?i=o=[o,s]:(vs=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(vs=t,t=n)):(vs=t,t=n),t}function va(){var e,t;return e=vs,(t=ya())===n&&(t=Ea())===n&&(t=Ca()),t!==n&&(ys=e,t=ht()),e=t}function ya(){var t,r,i,o,s;for(t=vs,r=[],i=vs,(o=Ta())!==n?(46===e.charCodeAt(vs)?(s=X,vs++):(s=n,0===As&&Os(Q)),s!==n?i=o=[o,s]:(vs=i,i=n)):(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=Ta())!==n?(46===e.charCodeAt(vs)?(s=X,vs++):(s=n,0===As&&Os(Q)),s!==n?i=o=[o,s]:(vs=i,i=n)):(vs=i,i=n);return r!==n&&(i=function(){var t,r,i,o;if(t=vs,l.test(e.charAt(vs))?(r=e.charAt(vs),vs++):(r=n,0===As&&Os(f)),r!==n){for(i=[],ft.test(e.charAt(vs))?(o=e.charAt(vs),vs++):(o=n,0===As&&Os(gt));o!==n;)i.push(o),ft.test(e.charAt(vs))?(o=e.charAt(vs),vs++):(o=n,0===As&&Os(gt));i!==n?t=r=[r,i]:(vs=t,t=n)}else vs=t,t=n;return t}())!==n?(46===e.charCodeAt(vs)?(o=X,vs++):(o=n,0===As&&Os(Q)),o===n&&(o=null),o!==n?(ys=t,t=r=dt()):(vs=t,t=n)):(vs=t,t=n),t}function Ta(){var t,r;if(t=[],pt.test(e.charAt(vs))?(r=e.charAt(vs),vs++):(r=n,0===As&&Os(lt)),r!==n)for(;r!==n;)t.push(r),pt.test(e.charAt(vs))?(r=e.charAt(vs),vs++):(r=n,0===As&&Os(lt));else t=n;return t}function Ca(){var t,r,i;return t=vs,91===e.charCodeAt(vs)?(r=Re,vs++):(r=n,0===As&&Os(Ie)),r!==n&&Sa()!==n?(93===e.charCodeAt(vs)?(i=Oe,vs++):(i=n,0===As&&Os(Ne)),i!==n?(ys=t,t=r=mt()):(vs=t,t=n)):(vs=t,t=n),t}function Sa(){var t,r,i,o,s,a,c,u,h,d,p,l,f,g,m;return t=vs,r=vs,(i=Aa())!==n?(58===e.charCodeAt(vs)?(o=x,vs++):(o=n,0===As&&Os(U)),o!==n&&(s=Aa())!==n?(58===e.charCodeAt(vs)?(a=x,vs++):(a=n,0===As&&Os(U)),a!==n&&(c=Aa())!==n?(58===e.charCodeAt(vs)?(u=x,vs++):(u=n,0===As&&Os(U)),u!==n&&(h=Aa())!==n?(58===e.charCodeAt(vs)?(d=x,vs++):(d=n,0===As&&Os(U)),d!==n&&(p=Aa())!==n?(58===e.charCodeAt(vs)?(l=x,vs++):(l=n,0===As&&Os(U)),l!==n&&(f=Aa())!==n?(58===e.charCodeAt(vs)?(g=x,vs++):(g=n,0===As&&Os(U)),g!==n&&(m=ba())!==n?r=i=[i,o,s,a,c,u,h,d,p,l,f,g,m]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,e.substr(vs,2)===vt?(i=vt,vs+=2):(i=n,0===As&&Os(yt)),i!==n&&(o=Aa())!==n?(58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?(58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?(58===e.charCodeAt(vs)?(h=x,vs++):(h=n,0===As&&Os(U)),h!==n&&(d=Aa())!==n?(58===e.charCodeAt(vs)?(p=x,vs++):(p=n,0===As&&Os(U)),p!==n&&(l=Aa())!==n?(58===e.charCodeAt(vs)?(f=x,vs++):(f=n,0===As&&Os(U)),f!==n&&(g=ba())!==n?r=i=[i,o,s,a,c,u,h,d,p,l,f,g]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,e.substr(vs,2)===vt?(i=vt,vs+=2):(i=n,0===As&&Os(yt)),i!==n&&(o=Aa())!==n?(58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?(58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?(58===e.charCodeAt(vs)?(h=x,vs++):(h=n,0===As&&Os(U)),h!==n&&(d=Aa())!==n?(58===e.charCodeAt(vs)?(p=x,vs++):(p=n,0===As&&Os(U)),p!==n&&(l=ba())!==n?r=i=[i,o,s,a,c,u,h,d,p,l]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,e.substr(vs,2)===vt?(i=vt,vs+=2):(i=n,0===As&&Os(yt)),i!==n&&(o=Aa())!==n?(58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?(58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?(58===e.charCodeAt(vs)?(h=x,vs++):(h=n,0===As&&Os(U)),h!==n&&(d=ba())!==n?r=i=[i,o,s,a,c,u,h,d]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,e.substr(vs,2)===vt?(i=vt,vs+=2):(i=n,0===As&&Os(yt)),i!==n&&(o=Aa())!==n?(58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?(58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=ba())!==n?r=i=[i,o,s,a,c,u]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,e.substr(vs,2)===vt?(i=vt,vs+=2):(i=n,0===As&&Os(yt)),i!==n&&(o=Aa())!==n?(58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=ba())!==n?r=i=[i,o,s,a]:(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,e.substr(vs,2)===vt?(i=vt,vs+=2):(i=n,0===As&&Os(yt)),i!==n&&(o=ba())!==n?r=i=[i,o]:(vs=r,r=n),r===n&&(r=vs,e.substr(vs,2)===vt?(i=vt,vs+=2):(i=n,0===As&&Os(yt)),i!==n&&(o=Aa())!==n?r=i=[i,o]:(vs=r,r=n),r===n&&(r=vs,(i=Aa())!==n?(e.substr(vs,2)===vt?(o=vt,vs+=2):(o=n,0===As&&Os(yt)),o!==n&&(s=Aa())!==n?(58===e.charCodeAt(vs)?(a=x,vs++):(a=n,0===As&&Os(U)),a!==n&&(c=Aa())!==n?(58===e.charCodeAt(vs)?(u=x,vs++):(u=n,0===As&&Os(U)),u!==n&&(h=Aa())!==n?(58===e.charCodeAt(vs)?(d=x,vs++):(d=n,0===As&&Os(U)),d!==n&&(p=Aa())!==n?(58===e.charCodeAt(vs)?(l=x,vs++):(l=n,0===As&&Os(U)),l!==n&&(f=ba())!==n?r=i=[i,o,s,a,c,u,h,d,p,l,f]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,(i=Aa())!==n?(o=vs,58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?o=s=[s,a]:(vs=o,o=n),o===n&&(o=null),o!==n?(e.substr(vs,2)===vt?(s=vt,vs+=2):(s=n,0===As&&Os(yt)),s!==n&&(a=Aa())!==n?(58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?(58===e.charCodeAt(vs)?(h=x,vs++):(h=n,0===As&&Os(U)),h!==n&&(d=Aa())!==n?(58===e.charCodeAt(vs)?(p=x,vs++):(p=n,0===As&&Os(U)),p!==n&&(l=ba())!==n?r=i=[i,o,s,a,c,u,h,d,p,l]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,(i=Aa())!==n?(o=vs,58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?o=s=[s,a]:(vs=o,o=n),o===n&&(o=null),o!==n?(s=vs,58===e.charCodeAt(vs)?(a=x,vs++):(a=n,0===As&&Os(U)),a!==n&&(c=Aa())!==n?s=a=[a,c]:(vs=s,s=n),s===n&&(s=null),s!==n?(e.substr(vs,2)===vt?(a=vt,vs+=2):(a=n,0===As&&Os(yt)),a!==n&&(c=Aa())!==n?(58===e.charCodeAt(vs)?(u=x,vs++):(u=n,0===As&&Os(U)),u!==n&&(h=Aa())!==n?(58===e.charCodeAt(vs)?(d=x,vs++):(d=n,0===As&&Os(U)),d!==n&&(p=ba())!==n?r=i=[i,o,s,a,c,u,h,d,p]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,(i=Aa())!==n?(o=vs,58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?o=s=[s,a]:(vs=o,o=n),o===n&&(o=null),o!==n?(s=vs,58===e.charCodeAt(vs)?(a=x,vs++):(a=n,0===As&&Os(U)),a!==n&&(c=Aa())!==n?s=a=[a,c]:(vs=s,s=n),s===n&&(s=null),s!==n?(a=vs,58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?a=c=[c,u]:(vs=a,a=n),a===n&&(a=null),a!==n?(e.substr(vs,2)===vt?(c=vt,vs+=2):(c=n,0===As&&Os(yt)),c!==n&&(u=Aa())!==n?(58===e.charCodeAt(vs)?(h=x,vs++):(h=n,0===As&&Os(U)),h!==n&&(d=ba())!==n?r=i=[i,o,s,a,c,u,h,d]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,(i=Aa())!==n?(o=vs,58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?o=s=[s,a]:(vs=o,o=n),o===n&&(o=null),o!==n?(s=vs,58===e.charCodeAt(vs)?(a=x,vs++):(a=n,0===As&&Os(U)),a!==n&&(c=Aa())!==n?s=a=[a,c]:(vs=s,s=n),s===n&&(s=null),s!==n?(a=vs,58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?a=c=[c,u]:(vs=a,a=n),a===n&&(a=null),a!==n?(c=vs,58===e.charCodeAt(vs)?(u=x,vs++):(u=n,0===As&&Os(U)),u!==n&&(h=Aa())!==n?c=u=[u,h]:(vs=c,c=n),c===n&&(c=null),c!==n?(e.substr(vs,2)===vt?(u=vt,vs+=2):(u=n,0===As&&Os(yt)),u!==n&&(h=ba())!==n?r=i=[i,o,s,a,c,u,h]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,(i=Aa())!==n?(o=vs,58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?o=s=[s,a]:(vs=o,o=n),o===n&&(o=null),o!==n?(s=vs,58===e.charCodeAt(vs)?(a=x,vs++):(a=n,0===As&&Os(U)),a!==n&&(c=Aa())!==n?s=a=[a,c]:(vs=s,s=n),s===n&&(s=null),s!==n?(a=vs,58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?a=c=[c,u]:(vs=a,a=n),a===n&&(a=null),a!==n?(c=vs,58===e.charCodeAt(vs)?(u=x,vs++):(u=n,0===As&&Os(U)),u!==n&&(h=Aa())!==n?c=u=[u,h]:(vs=c,c=n),c===n&&(c=null),c!==n?(u=vs,58===e.charCodeAt(vs)?(h=x,vs++):(h=n,0===As&&Os(U)),h!==n&&(d=Aa())!==n?u=h=[h,d]:(vs=u,u=n),u===n&&(u=null),u!==n?(e.substr(vs,2)===vt?(h=vt,vs+=2):(h=n,0===As&&Os(yt)),h!==n&&(d=Aa())!==n?r=i=[i,o,s,a,c,u,h,d]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n),r===n&&(r=vs,(i=Aa())!==n?(o=vs,58===e.charCodeAt(vs)?(s=x,vs++):(s=n,0===As&&Os(U)),s!==n&&(a=Aa())!==n?o=s=[s,a]:(vs=o,o=n),o===n&&(o=null),o!==n?(s=vs,58===e.charCodeAt(vs)?(a=x,vs++):(a=n,0===As&&Os(U)),a!==n&&(c=Aa())!==n?s=a=[a,c]:(vs=s,s=n),s===n&&(s=null),s!==n?(a=vs,58===e.charCodeAt(vs)?(c=x,vs++):(c=n,0===As&&Os(U)),c!==n&&(u=Aa())!==n?a=c=[c,u]:(vs=a,a=n),a===n&&(a=null),a!==n?(c=vs,58===e.charCodeAt(vs)?(u=x,vs++):(u=n,0===As&&Os(U)),u!==n&&(h=Aa())!==n?c=u=[u,h]:(vs=c,c=n),c===n&&(c=null),c!==n?(u=vs,58===e.charCodeAt(vs)?(h=x,vs++):(h=n,0===As&&Os(U)),h!==n&&(d=Aa())!==n?u=h=[h,d]:(vs=u,u=n),u===n&&(u=null),u!==n?(h=vs,58===e.charCodeAt(vs)?(d=x,vs++):(d=n,0===As&&Os(U)),d!==n&&(p=Aa())!==n?h=d=[d,p]:(vs=h,h=n),h===n&&(h=null),h!==n?(e.substr(vs,2)===vt?(d=vt,vs+=2):(d=n,0===As&&Os(yt)),d!==n?r=i=[i,o,s,a,c,u,h,d]:(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n)):(vs=r,r=n))))))))))))))),r!==n&&(ys=t,r=Tt()),t=r}function Aa(){var e,t,r,i,o;return e=vs,(t=Us())!==n?((r=Us())===n&&(r=null),r!==n?((i=Us())===n&&(i=null),i!==n?((o=Us())===n&&(o=null),o!==n?e=t=[t,r,i,o]:(vs=e,e=n)):(vs=e,e=n)):(vs=e,e=n)):(vs=e,e=n),e}function ba(){var t,r,i,o;return t=vs,(r=Aa())!==n?(58===e.charCodeAt(vs)?(i=x,vs++):(i=n,0===As&&Os(U)),i!==n&&(o=Aa())!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n),t===n&&(t=Ea()),t}function Ea(){var t,r,i,o;return t=vs,wa()!==n?(46===e.charCodeAt(vs)?(r=X,vs++):(r=n,0===As&&Os(Q)),r!==n&&wa()!==n?(46===e.charCodeAt(vs)?(i=X,vs++):(i=n,0===As&&Os(Q)),i!==n&&wa()!==n?(46===e.charCodeAt(vs)?(o=X,vs++):(o=n,0===As&&Os(Q)),o!==n&&wa()!==n?(ys=t,t=Ct()):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t}function wa(){var t,r,i,o;return t=vs,e.substr(vs,2)===St?(r=St,vs+=2):(r=n,0===As&&Os(At)),r!==n?(bt.test(e.charAt(vs))?(i=e.charAt(vs),vs++):(i=n,0===As&&Os(Et)),i!==n?t=r=[r,i]:(vs=t,t=n)):(vs=t,t=n),t===n&&(t=vs,50===e.charCodeAt(vs)?(r=wt,vs++):(r=n,0===As&&Os(_t)),r!==n?(Rt.test(e.charAt(vs))?(i=e.charAt(vs),vs++):(i=n,0===As&&Os(It)),i!==n&&(o=ks())!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n),t===n&&(t=vs,49===e.charCodeAt(vs)?(r=Ot,vs++):(r=n,0===As&&Os(Nt)),r!==n&&(i=ks())!==n&&(o=ks())!==n?t=r=[r,i,o]:(vs=t,t=n),t===n&&(t=vs,Dt.test(e.charAt(vs))?(r=e.charAt(vs),vs++):(r=n,0===As&&Os(kt)),r!==n&&(i=ks())!==n?t=r=[r,i]:(vs=t,t=n),t===n&&(t=ks())))),t}function _a(){var e,t,r,i,o,s,a;return e=vs,t=vs,(r=ks())===n&&(r=null),r!==n?((i=ks())===n&&(i=null),i!==n?((o=ks())===n&&(o=null),o!==n?((s=ks())===n&&(s=null),s!==n?((a=ks())===n&&(a=null),a!==n?t=r=[r,i,o,s,a]:(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t!==n&&(ys=e,t=xt(t)),e=t}function Ra(){var t;return(t=function(){var t,r,i;return t=vs,e.substr(vs,10).toLowerCase()===Ut?(r=e.substr(vs,10),vs+=10):(r=n,0===As&&Os(Pt)),r!==n?(e.substr(vs,3).toLowerCase()===Lt?(i=e.substr(vs,3),vs+=3):(i=n,0===As&&Os(Ht)),i===n&&(e.substr(vs,3).toLowerCase()===qt?(i=e.substr(vs,3),vs+=3):(i=n,0===As&&Os(Mt)),i===n&&(e.substr(vs,4).toLowerCase()===Bt?(i=e.substr(vs,4),vs+=4):(i=n,0===As&&Os(Ft)),i===n&&(e.substr(vs,3).toLowerCase()===jt?(i=e.substr(vs,3),vs+=3):(i=n,0===As&&Os(Gt)),i===n&&(i=Js())))),i!==n?(ys=t,r=Wt(i),t=r):(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,5).toLowerCase()===Kt?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(Vt)),r!==n?(e.substr(vs,5).toLowerCase()===Yt?(i=e.substr(vs,5),vs+=5):(i=n,0===As&&Os(zt)),i===n&&(e.substr(vs,2).toLowerCase()===$t?(i=e.substr(vs,2),vs+=2):(i=n,0===As&&Os(Jt)),i===n&&(i=Js())),i!==n?(ys=t,r=Xt(i),t=r):(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,7).toLowerCase()===Qt?(r=e.substr(vs,7),vs+=7):(r=n,0===As&&Os(Zt)),r!==n&&(i=Ba())!==n?(ys=t,r=er(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,4).toLowerCase()===tr?(r=e.substr(vs,4),vs+=4):(r=n,0===As&&Os(rr)),r!==n&&(i=lc())!==n?(ys=t,r=nr(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,6).toLowerCase()===ir?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(or)),r!==n&&(i=va())!==n?(ys=t,r=sr(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s;return t=vs,e.substr(vs,2).toLowerCase()===ar?(r=e.substr(vs,2),vs+=2):(r=n,0===As&&Os(cr)),r!==n?(i=vs,61===e.charCodeAt(vs)?(o=M,vs++):(o=n,0===As&&Os(B)),o!==n&&(s=Js())!==n?i=o=[o,s]:(vs=i,i=n),i===n&&(i=null),i!==n?(ys=t,r=ur(),t=r):(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s;return t=vs,(r=function(){var t,r,i;if(t=vs,r=[],(i=Ia())!==n)for(;i!==n;)r.push(i),i=Ia();else r=n;return t=r!==n?e.substring(t,vs):r}())!==n?(i=vs,61===e.charCodeAt(vs)?(o=M,vs++):(o=n,0===As&&Os(B)),o!==n&&(s=function(){var t,r,i;if(t=vs,r=[],(i=Ia())!==n)for(;i!==n;)r.push(i),i=Ia();else r=n;return t=r!==n?e.substring(t,vs):r}())!==n?i=o=[o,s]:(vs=i,i=n),i===n&&(i=null),i!==n?(ys=t,r=hr(r,i),t=r):(vs=t,t=n)):(vs=t,t=n),t}()),t}function Ia(){var t;return(t=function(){var t;return 91===e.charCodeAt(vs)?(t=Re,vs++):(t=n,0===As&&Os(Ie)),t===n&&(93===e.charCodeAt(vs)?(t=Oe,vs++):(t=n,0===As&&Os(Ne)),t===n&&(47===e.charCodeAt(vs)?(t=O,vs++):(t=n,0===As&&Os(N)),t===n&&(58===e.charCodeAt(vs)?(t=x,vs++):(t=n,0===As&&Os(U)),t===n&&(38===e.charCodeAt(vs)?(t=H,vs++):(t=n,0===As&&Os(q)),t===n&&(43===e.charCodeAt(vs)?(t=F,vs++):(t=n,0===As&&Os(j)),t===n&&(36===e.charCodeAt(vs)?(t=G,vs++):(t=n,0===As&&Os(W)))))))),t}())===n&&(t=js())===n&&(t=Ws()),t}function Oa(){var t,r,i,o;return t=vs,(r=function(){var e,t;if(e=[],(t=Na())===n&&(t=js())===n&&(t=Ws()),t!==n)for(;t!==n;)e.push(t),(t=Na())===n&&(t=js())===n&&(t=Ws());else e=n;return e}())!==n?(61===e.charCodeAt(vs)?(i=M,vs++):(i=n,0===As&&Os(B)),i!==n&&(o=function(){var e,t;for(e=[],(t=Na())===n&&(t=js())===n&&(t=Ws());t!==n;)e.push(t),(t=Na())===n&&(t=js())===n&&(t=Ws());return e}())!==n?(ys=t,t=r=dr(r,o)):(vs=t,t=n)):(vs=t,t=n),t}function Na(){var t;return 91===e.charCodeAt(vs)?(t=Re,vs++):(t=n,0===As&&Os(Ie)),t===n&&(93===e.charCodeAt(vs)?(t=Oe,vs++):(t=n,0===As&&Os(Ne)),t===n&&(47===e.charCodeAt(vs)?(t=O,vs++):(t=n,0===As&&Os(N)),t===n&&(63===e.charCodeAt(vs)?(t=D,vs++):(t=n,0===As&&Os(k)),t===n&&(58===e.charCodeAt(vs)?(t=x,vs++):(t=n,0===As&&Os(U)),t===n&&(43===e.charCodeAt(vs)?(t=F,vs++):(t=n,0===As&&Os(j)),t===n&&(36===e.charCodeAt(vs)?(t=G,vs++):(t=n,0===As&&Os(W)))))))),t}function Da(){var e;return(e=function(){var e,t,r,i,o,s;return e=vs,(t=Ma())!==n&&(r=qs())!==n&&(i=function(){var e,t;return e=vs,(t=function(){var e,t,r,i;return e=vs,(t=ks())!==n&&(r=ks())!==n&&(i=ks())!==n?e=t=[t,r,i]:(vs=e,e=n),e}())!==n&&(ys=e,t=Mr(t)),e=t}())!==n&&(o=qs())!==n&&(s=function(){var e,t,r;for(e=vs,t=[],(r=Fs())===n&&(r=js())===n&&(r=Ws())===n&&(r=zs())===n&&(r=$s())===n&&(r=qs())===n&&(r=Ms());r!==n;)t.push(r),(r=Fs())===n&&(r=js())===n&&(r=Ws())===n&&(r=zs())===n&&(r=$s())===n&&(r=qs())===n&&(r=Ms());return t!==n&&(ys=e,t=Br()),e=t}())!==n?e=t=[t,r,i,o,s]:(vs=e,e=n),e}())===n&&(e=function(){var e,t,r,i,o,s;return e=vs,(t=Ba())!==n&&(r=qs())!==n&&(i=function(){var e;return(e=pa())===n&&(e=ka()),e}())!==n&&(o=qs())!==n&&(s=Ma())!==n?e=t=[t,r,i,o,s]:(vs=e,e=n),e}()),e}function ka(){var t,r,i;return t=vs,function(){var t,r,i,o,s;if(t=vs,r=vs,(i=xs())!==n){for(o=[],(s=xs())===n&&(s=ks())===n&&(43===e.charCodeAt(vs)?(s=F,vs++):(s=n,0===As&&Os(j)),s===n&&(45===e.charCodeAt(vs)?(s=Y,vs++):(s=n,0===As&&Os(z)),s===n&&(46===e.charCodeAt(vs)?(s=X,vs++):(s=n,0===As&&Os(Q)))));s!==n;)o.push(s),(s=xs())===n&&(s=ks())===n&&(43===e.charCodeAt(vs)?(s=F,vs++):(s=n,0===As&&Os(j)),s===n&&(45===e.charCodeAt(vs)?(s=Y,vs++):(s=n,0===As&&Os(z)),s===n&&(46===e.charCodeAt(vs)?(s=X,vs++):(s=n,0===As&&Os(Q)))));o!==n?r=i=[i,o]:(vs=r,r=n)}else vs=r,r=n;return r!==n&&(ys=t,r=gr()),t=r}()!==n?(58===e.charCodeAt(vs)?(r=x,vs++):(r=n,0===As&&Os(U)),r!==n?((i=function(){var t,r,i,o,s;return t=vs,(r=function(){var t,r,i,o;return t=vs,e.substr(vs,2)===lr?(r=lr,vs+=2):(r=n,0===As&&Os(fr)),r!==n&&(i=function(){var t;return(t=function(){var t,r,i,o;return t=vs,r=vs,(i=fa())!==n?(64===e.charCodeAt(vs)?(o=P,vs++):(o=n,0===As&&Os(L)),o!==n?r=i=[i,o]:(vs=r,r=n)):(vs=r,r=n),r===n&&(r=null),r!==n&&(i=ma())!==n?t=r=[r,i]:(vs=t,t=n),t===n&&(t=null),t}())===n&&(t=qa()),t}())!==n?((o=xa())===n&&(o=null),o!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n),t}())===n&&(r=xa()),r!==n?(i=vs,63===e.charCodeAt(vs)?(o=D,vs++):(o=n,0===As&&Os(k)),o!==n&&(s=function(){var e,t;for(e=[],t=Ua();t!==n;)e.push(t),t=Ua();return e}())!==n?i=o=[o,s]:(vs=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(vs=t,t=n)):(vs=t,t=n),t}())===n&&(i=function(){var t,r,i,o;if(t=vs,(r=function(){var t;return(t=js())===n&&(t=Ws())===n&&(59===e.charCodeAt(vs)?(t=R,vs++):(t=n,0===As&&Os(I)),t===n&&(63===e.charCodeAt(vs)?(t=D,vs++):(t=n,0===As&&Os(k)),t===n&&(58===e.charCodeAt(vs)?(t=x,vs++):(t=n,0===As&&Os(U)),t===n&&(64===e.charCodeAt(vs)?(t=P,vs++):(t=n,0===As&&Os(L)),t===n&&(38===e.charCodeAt(vs)?(t=H,vs++):(t=n,0===As&&Os(q)),t===n&&(61===e.charCodeAt(vs)?(t=M,vs++):(t=n,0===As&&Os(B)),t===n&&(43===e.charCodeAt(vs)?(t=F,vs++):(t=n,0===As&&Os(j)),t===n&&(36===e.charCodeAt(vs)?(t=G,vs++):(t=n,0===As&&Os(W)),t===n&&(44===e.charCodeAt(vs)?(t=K,vs++):(t=n,0===As&&Os(V))))))))))),t}())!==n){for(i=[],o=Ua();o!==n;)i.push(o),o=Ua();i!==n?t=r=[r,i]:(vs=t,t=n)}else vs=t,t=n;return t}()),i!==n?(ys=t,t=pr()):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t}function xa(){var t,r,i;return t=vs,47===e.charCodeAt(vs)?(r=O,vs++):(r=n,0===As&&Os(N)),r!==n&&(i=function(){var t,r,i,o,s,a;if(t=vs,(r=Pa())!==n){for(i=[],o=vs,47===e.charCodeAt(vs)?(s=O,vs++):(s=n,0===As&&Os(N)),s!==n&&(a=Pa())!==n?o=s=[s,a]:(vs=o,o=n);o!==n;)i.push(o),o=vs,47===e.charCodeAt(vs)?(s=O,vs++):(s=n,0===As&&Os(N)),s!==n&&(a=Pa())!==n?o=s=[s,a]:(vs=o,o=n);i!==n?t=r=[r,i]:(vs=t,t=n)}else vs=t,t=n;return t}())!==n?t=r=[r,i]:(vs=t,t=n),t}function Ua(){var e;return(e=Fs())===n&&(e=js())===n&&(e=Ws()),e}function Pa(){var t,r,i,o,s,a;for(t=vs,r=[],i=Ha();i!==n;)r.push(i),i=Ha();if(r!==n){for(i=[],o=vs,59===e.charCodeAt(vs)?(s=R,vs++):(s=n,0===As&&Os(I)),s!==n&&(a=La())!==n?o=s=[s,a]:(vs=o,o=n);o!==n;)i.push(o),o=vs,59===e.charCodeAt(vs)?(s=R,vs++):(s=n,0===As&&Os(I)),s!==n&&(a=La())!==n?o=s=[s,a]:(vs=o,o=n);i!==n?t=r=[r,i]:(vs=t,t=n)}else vs=t,t=n;return t}function La(){var e,t;for(e=[],t=Ha();t!==n;)e.push(t),t=Ha();return e}function Ha(){var t;return(t=js())===n&&(t=Ws())===n&&(58===e.charCodeAt(vs)?(t=x,vs++):(t=n,0===As&&Os(U)),t===n&&(64===e.charCodeAt(vs)?(t=P,vs++):(t=n,0===As&&Os(L)),t===n&&(38===e.charCodeAt(vs)?(t=H,vs++):(t=n,0===As&&Os(q)),t===n&&(61===e.charCodeAt(vs)?(t=M,vs++):(t=n,0===As&&Os(B)),t===n&&(43===e.charCodeAt(vs)?(t=F,vs++):(t=n,0===As&&Os(j)),t===n&&(36===e.charCodeAt(vs)?(t=G,vs++):(t=n,0===As&&Os(W)),t===n&&(44===e.charCodeAt(vs)?(t=K,vs++):(t=n,0===As&&Os(V))))))))),t}function qa(){var t,r;if(t=[],(r=js())===n&&(r=Ws())===n&&(36===e.charCodeAt(vs)?(r=G,vs++):(r=n,0===As&&Os(W)),r===n&&(44===e.charCodeAt(vs)?(r=K,vs++):(r=n,0===As&&Os(V)),r===n&&(59===e.charCodeAt(vs)?(r=R,vs++):(r=n,0===As&&Os(I)),r===n&&(58===e.charCodeAt(vs)?(r=x,vs++):(r=n,0===As&&Os(U)),r===n&&(64===e.charCodeAt(vs)?(r=P,vs++):(r=n,0===As&&Os(L)),r===n&&(38===e.charCodeAt(vs)?(r=H,vs++):(r=n,0===As&&Os(q)),r===n&&(61===e.charCodeAt(vs)?(r=M,vs++):(r=n,0===As&&Os(B)),r===n&&(43===e.charCodeAt(vs)?(r=F,vs++):(r=n,0===As&&Os(j)))))))))),r!==n)for(;r!==n;)t.push(r),(r=js())===n&&(r=Ws())===n&&(36===e.charCodeAt(vs)?(r=G,vs++):(r=n,0===As&&Os(W)),r===n&&(44===e.charCodeAt(vs)?(r=K,vs++):(r=n,0===As&&Os(V)),r===n&&(59===e.charCodeAt(vs)?(r=R,vs++):(r=n,0===As&&Os(I)),r===n&&(58===e.charCodeAt(vs)?(r=x,vs++):(r=n,0===As&&Os(U)),r===n&&(64===e.charCodeAt(vs)?(r=P,vs++):(r=n,0===As&&Os(L)),r===n&&(38===e.charCodeAt(vs)?(r=H,vs++):(r=n,0===As&&Os(q)),r===n&&(61===e.charCodeAt(vs)?(r=M,vs++):(r=n,0===As&&Os(B)),r===n&&(43===e.charCodeAt(vs)?(r=F,vs++):(r=n,0===As&&Os(j))))))))));else t=n;return t}function Ma(){var t,r,i,o,s,a,c;if(t=vs,e.substr(vs,3).toLowerCase()===ot?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(mr)),r!==n)if(47===e.charCodeAt(vs)?(i=O,vs++):(i=n,0===As&&Os(N)),i!==n){if(o=[],(s=ks())!==n)for(;s!==n;)o.push(s),s=ks();else o=n;if(o!==n)if(46===e.charCodeAt(vs)?(s=X,vs++):(s=n,0===As&&Os(Q)),s!==n){if(a=[],(c=ks())!==n)for(;c!==n;)a.push(c),c=ks();else a=n;a!==n?(ys=t,t=r=vr()):(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n}else vs=t,t=n;else vs=t,t=n;return t}function Ba(){var t,r;return t=vs,(r=function(){var t;return e.substr(vs,6)===yr?(t=yr,vs+=6):(t=n,0===As&&Os(Tr)),t}())===n&&(r=function(){var t;return e.substr(vs,3)===Cr?(t=Cr,vs+=3):(t=n,0===As&&Os(Sr)),t}())===n&&(r=function(){var t;return e.substr(vs,7)===Ar?(t=Ar,vs+=7):(t=n,0===As&&Os(br)),t}())===n&&(r=function(){var t;return e.substr(vs,3)===Er?(t=Er,vs+=3):(t=n,0===As&&Os(wr)),t}())===n&&(r=function(){var t;return e.substr(vs,6)===_r?(t=_r,vs+=6):(t=n,0===As&&Os(Rr)),t}())===n&&(r=function(){var t;return e.substr(vs,8)===Ir?(t=Ir,vs+=8):(t=n,0===As&&Os(Or)),t}())===n&&(r=function(){var t;return e.substr(vs,9)===Nr?(t=Nr,vs+=9):(t=n,0===As&&Os(Dr)),t}())===n&&(r=function(){var t;return e.substr(vs,7)===Lr?(t=Lr,vs+=7):(t=n,0===As&&Os(Hr)),t}())===n&&(r=function(){var t;return e.substr(vs,6)===kr?(t=kr,vs+=6):(t=n,0===As&&Os(xr)),t}())===n&&(r=function(){var t;return e.substr(vs,5)===Ur?(t=Ur,vs+=5):(t=n,0===As&&Os(Pr)),t}())===n&&(r=Js()),r!==n&&(ys=t,r=qr()),t=r}function Fa(){var t,r,i,o;return t=vs,Qs()!==n?(r=vs,64===e.charCodeAt(vs)?(i=P,vs++):(i=n,0===As&&Os(L)),i!==n&&(o=Qs())!==n?r=i=[i,o]:(vs=r,r=n),r===n&&(r=null),r!==n?(ys=t,t=Fr()):(vs=t,t=n)):(vs=t,t=n),t}function ja(){var t,r,i,o,s,a,c;if(t=vs,(r=function(){var t,r;return t=vs,Vs()!==n?(42===e.charCodeAt(vs)?(r=ne,vs++):(r=n,0===As&&Os(ie)),r!==n&&Vs()!==n?(ys=t,t=Pe()):(vs=t,t=n)):(vs=t,t=n),t}())===n)if(r=vs,(i=Ga())!==n){for(o=[],s=vs,(a=na())!==n&&(c=Ga())!==n?s=a=[a,c]:(vs=s,s=n);s!==n;)o.push(s),s=vs,(a=na())!==n&&(c=Ga())!==n?s=a=[a,c]:(vs=s,s=n);o!==n?r=i=[i,o]:(vs=r,r=n)}else vs=r,r=n;return r!==n&&(ys=t,r=jr()),t=r}function Ga(){var e,t,r,i,o,s;if(e=vs,(t=da())===n&&(t=Wa()),t!==n){for(r=[],i=vs,(o=ia())!==n&&(s=Va())!==n?i=o=[o,s]:(vs=i,i=n);i!==n;)r.push(i),i=vs,(o=ia())!==n&&(s=Va())!==n?i=o=[o,s]:(vs=i,i=n);r!==n?(ys=e,e=t=Gr()):(vs=e,e=n)}else vs=e,e=n;return e}function Wa(){var e,t,r,i,o;return e=vs,(t=Ka())===n&&(t=null),t!==n&&(r=ra())!==n&&(i=pa())!==n&&(o=ta())!==n?e=t=[t,r,i,o]:(vs=e,e=n),e}function Ka(){var e,t,r,i,o,s,a;if(e=vs,t=vs,(r=Js())!==n){for(i=[],o=vs,(s=Ks())!==n&&(a=Js())!==n?o=s=[s,a]:(vs=o,o=n);o!==n;)i.push(o),o=vs,(s=Ks())!==n&&(a=Js())!==n?o=s=[s,a]:(vs=o,o=n);i!==n?t=r=[r,i]:(vs=t,t=n)}else vs=t,t=n;return t===n&&(t=aa()),t!==n&&(ys=e,t=Wr(t)),e=t}function Va(){var t;return(t=function(){var t,r,i;return t=vs,e.substr(vs,1).toLowerCase()===Kr?(r=e.charAt(vs),vs++):(r=n,0===As&&Os(Vr)),r!==n&&ea()!==n&&(i=function(){var t,r,i,o,s,a,c;return t=vs,48===e.charCodeAt(vs)?(r=Qr,vs++):(r=n,0===As&&Os(Zr)),r!==n?(i=vs,46===e.charCodeAt(vs)?(o=X,vs++):(o=n,0===As&&Os(Q)),o!==n?((s=ks())===n&&(s=null),s!==n?((a=ks())===n&&(a=null),a!==n?((c=ks())===n&&(c=null),c!==n?i=o=[o,s,a,c]:(vs=i,i=n)):(vs=i,i=n)):(vs=i,i=n)):(vs=i,i=n),i===n&&(i=null),i!==n?(ys=t,r=en(),t=r):(vs=t,t=n)):(vs=t,t=n),t}())!==n?(ys=t,r=Yr(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,7).toLowerCase()===zr?(r=e.substr(vs,7),vs+=7):(r=n,0===As&&Os($r)),r!==n&&ea()!==n&&(i=Ya())!==n?(ys=t,r=Jr(i),t=r):(vs=t,t=n),t}())===n&&(t=za()),t}function Ya(){var e,t,r;if(e=vs,t=[],(r=ks())!==n)for(;r!==n;)t.push(r),r=ks();else t=n;return t!==n&&(ys=e,t=Xr(t)),e=t}function za(){var e,t,r,i,o;return e=vs,(t=Js())!==n?(r=vs,(i=ea())!==n&&(o=function(){var e;return(e=Js())===n&&(e=va())===n&&(e=aa()),e}())!==n?r=i=[i,o]:(vs=r,r=n),r===n&&(r=null),r!==n?(ys=e,e=t=tn(t,r)):(vs=e,e=n)):(vs=e,e=n),e}function $a(){var t;return(t=function(){var t,r,i,o;return t=vs,e.substr(vs,8).toLowerCase()===pn?(r=e.substr(vs,8),vs+=8):(r=n,0===As&&Os(ln)),r!==n&&(i=ea())!==n?(e.substr(vs,8).toLowerCase()===fn?(o=e.substr(vs,8),vs+=8):(o=n,0===As&&Os(gn)),o===n&&(e.substr(vs,8).toLowerCase()===mn?(o=e.substr(vs,8),vs+=8):(o=n,0===As&&Os(vn)),o===n&&(o=Js())),o!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=za()),t}function Ja(){var t;return(t=Js())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,2).toLowerCase()===Un?(r=e.substr(vs,2),vs+=2):(r=n,0===As&&Os(Pn)),r!==n&&(i=Js())!==n?t=r=[r,i]:(vs=t,t=n),t}()),t}function Xa(){var e,t,r,i;return e=vs,(t=Js())!==n&&(r=ea())!==n&&(i=function(){var e;return(e=Js())===n&&(e=aa()),e}())!==n?e=t=[t,r,i]:(vs=e,e=n),e}function Qa(){var t,r,i,o,s,a,c;if(t=vs,r=vs,(i=Xs())!==n){for(o=[],s=vs,46===e.charCodeAt(vs)?(a=X,vs++):(a=n,0===As&&Os(Q)),a!==n&&(c=Xs())!==n?s=a=[a,c]:(vs=s,s=n);s!==n;)o.push(s),s=vs,46===e.charCodeAt(vs)?(a=X,vs++):(a=n,0===As&&Os(Q)),a!==n&&(c=Xs())!==n?s=a=[a,c]:(vs=s,s=n);o!==n?r=i=[i,o]:(vs=r,r=n)}else vs=r,r=n;return t=r!==n?e.substring(t,vs):r}function Za(){var e;return(e=ec())===n&&(e=za()),e}function ec(){var t,r,i;return t=vs,e.substr(vs,3).toLowerCase()===Mn?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(Bn)),r!==n&&ea()!==n&&(i=Js())!==n?(ys=t,t=r=Fn(i)):(vs=t,t=n),t}function tc(){var t,r,i,o,s,a,c,u;if(t=vs,e.substr(vs,6).toLowerCase()===Wn?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(Kn)),r!==n)if((i=Ks())!==n)if((o=nc())!==n){for(s=[],a=vs,(c=na())!==n&&(u=nc())!==n?a=c=[c,u]:(vs=a,a=n);a!==n;)s.push(a),a=vs,(c=na())!==n&&(u=nc())!==n?a=c=[c,u]:(vs=a,a=n);s!==n?t=r=[r,i,o,s]:(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;else vs=t,t=n;return t===n&&(t=function(){var e,t,r,i,o,s,a,c;if(e=vs,(t=Js())!==n)if((r=Ks())!==n)if((i=rc())!==n){for(o=[],s=vs,(a=na())!==n&&(c=rc())!==n?s=a=[a,c]:(vs=s,s=n);s!==n;)o.push(s),s=vs,(a=na())!==n&&(c=rc())!==n?s=a=[a,c]:(vs=s,s=n);o!==n?e=t=[t,r,i,o]:(vs=e,e=n)}else vs=e,e=n;else vs=e,e=n;else vs=e,e=n;return e}()),t}function rc(){var e,t,r,i;return e=vs,(t=Js())!==n&&(r=ea())!==n?((i=Js())===n&&(i=aa()),i!==n?e=t=[t,r,i]:(vs=e,e=n)):(vs=e,e=n),e}function nc(){var t;return(t=function(){var t,r,i,o;return t=vs,e.substr(vs,5).toLowerCase()===Vn?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(Yn)),r!==n&&(i=ea())!==n&&(o=function(){var e,t;return e=vs,(t=ca())!==n&&(ys=e,t=zn(t)),e=t}())!==n?t=r=[r,i,o]:(vs=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s,a,c,u,h;if(t=vs,e.substr(vs,6).toLowerCase()===$n?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(Jn)),r!==n)if((i=ea())!==n)if((o=oa())!==n)if((s=ic())!==n){if(a=[],c=vs,u=[],(h=qs())!==n)for(;h!==n;)u.push(h),h=qs();else u=n;for(u!==n&&(h=ic())!==n?c=u=[u,h]:(vs=c,c=n);c!==n;){if(a.push(c),c=vs,u=[],(h=qs())!==n)for(;h!==n;)u.push(h),h=qs();else u=n;u!==n&&(h=ic())!==n?c=u=[u,h]:(vs=c,c=n)}a!==n&&(c=sa())!==n?t=r=[r,i,o,s,a,c]:(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;else vs=t,t=n;else vs=t,t=n;return t}())===n&&(t=function(){var t,r,i,o;return t=vs,e.substr(vs,5).toLowerCase()===Xn?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(Qn)),r!==n&&(i=ea())!==n&&(o=function(){var e,t;return e=vs,(t=ca())!==n&&(ys=e,t=Zn(t)),e=t}())!==n?t=r=[r,i,o]:(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,6).toLowerCase()===ei?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(ti)),r!==n&&ea()!==n&&(i=ca())!==n?(ys=t,r=ri(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s;return t=vs,e.substr(vs,5).toLowerCase()===ni?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(ii)),r!==n&&(i=ea())!==n?(o=vs,e.substr(vs,4).toLowerCase()===oi?(s=e.substr(vs,4),vs+=4):(s=n,0===As&&Os(si)),s!==n&&(ys=o,s=ai()),(o=s)===n&&(o=vs,e.substr(vs,5).toLowerCase()===ci?(s=e.substr(vs,5),vs+=5):(s=n,0===As&&Os(ui)),s!==n&&(ys=o,s=hi()),o=s),o!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,9).toLowerCase()===di?(r=e.substr(vs,9),vs+=9):(r=n,0===As&&Os(pi)),r!==n&&ea()!==n?(e.substr(vs,3).toLowerCase()===li?(i=e.substr(vs,3),vs+=3):(i=n,0===As&&Os(fi)),i===n&&(e.substr(vs,8).toLowerCase()===gi?(i=e.substr(vs,8),vs+=8):(i=n,0===As&&Os(mi)),i===n&&(i=Js())),i!==n?(ys=t,r=vi(i),t=r):(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i,o,s,a,c,u,h,d;if(t=vs,e.substr(vs,3).toLowerCase()===yi?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(Ti)),r!==n)if((i=ea())!==n)if((o=oa())!==n){if(s=vs,(a=oc())!==n){for(c=[],u=vs,44===e.charCodeAt(vs)?(h=K,vs++):(h=n,0===As&&Os(V)),h!==n&&(d=oc())!==n?u=h=[h,d]:(vs=u,u=n);u!==n;)c.push(u),u=vs,44===e.charCodeAt(vs)?(h=K,vs++):(h=n,0===As&&Os(V)),h!==n&&(d=oc())!==n?u=h=[h,d]:(vs=u,u=n);c!==n?s=a=[a,c]:(vs=s,s=n)}else vs=s,s=n;s!==n&&(a=sa())!==n?t=r=[r,i,o,s,a]:(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;else vs=t,t=n;return t}())===n&&(t=rc()),t}function ic(){var e;return(e=ka())===n&&(e=xa()),e}function oc(){var t,r;return t=vs,e.substr(vs,8).toLowerCase()===Ci?(r=e.substr(vs,8),vs+=8):(r=n,0===As&&Os(Si)),r===n&&(e.substr(vs,4).toLowerCase()===Ai?(r=e.substr(vs,4),vs+=4):(r=n,0===As&&Os(bi)),r===n&&(r=Js())),r!==n&&(ys=t,r=Ei(r)),t=r}function sc(){var e,t,r,i,o;if(e=vs,Wa()!==n){for(t=[],r=vs,(i=ia())!==n&&(o=za())!==n?r=i=[i,o]:(vs=r,r=n);r!==n;)t.push(r),r=vs,(i=ia())!==n&&(o=za())!==n?r=i=[i,o]:(vs=r,r=n);t!==n?(ys=e,e=_i()):(vs=e,e=n)}else vs=e,e=n;return e}function ac(){var t,r,i;return t=vs,e.substr(vs,8).toLowerCase()===Ni?(r=e.substr(vs,8),vs+=8):(r=n,0===As&&Os(Di)),r!==n&&ea()!==n&&(i=Js())!==n?(ys=t,t=r=ki(i)):(vs=t,t=n),t===n&&(t=vs,e.substr(vs,6).toLowerCase()===xi?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(Ui)),r!==n&&ea()!==n&&(i=Js())!==n?(ys=t,t=r=Pi(i)):(vs=t,t=n),t===n&&(t=vs,e.substr(vs,10).toLowerCase()===Li?(r=e.substr(vs,10),vs+=10):(r=n,0===As&&Os(Hi)),r!==n&&(ys=t,r=qi()),(t=r)===n&&(t=za()))),t}function cc(){var t,r,i;return t=vs,e.substr(vs,6).toLowerCase()===$i?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(Ji)),r!==n&&ea()!==n&&(i=function(){var t;return e.substr(vs,11).toLowerCase()===ro?(t=e.substr(vs,11),vs+=11):(t=n,0===As&&Os(no)),t===n&&(e.substr(vs,9).toLowerCase()===io?(t=e.substr(vs,9),vs+=9):(t=n,0===As&&Os(oo)),t===n&&(e.substr(vs,8).toLowerCase()===so?(t=e.substr(vs,8),vs+=8):(t=n,0===As&&Os(ao)),t===n&&(e.substr(vs,7).toLowerCase()===co?(t=e.substr(vs,7),vs+=7):(t=n,0===As&&Os(uo)),t===n&&(e.substr(vs,6).toLowerCase()===ho?(t=e.substr(vs,6),vs+=6):(t=n,0===As&&Os(po)),t===n&&(e.substr(vs,10).toLowerCase()===lo?(t=e.substr(vs,10),vs+=10):(t=n,0===As&&Os(fo)),t===n&&(e.substr(vs,9).toLowerCase()===go?(t=e.substr(vs,9),vs+=9):(t=n,0===As&&Os(mo)),t===n&&(t=Js()))))))),t}())!==n?(ys=t,t=r=Xi(i)):(vs=t,t=n),t===n&&(t=vs,e.substr(vs,7).toLowerCase()===zr?(r=e.substr(vs,7),vs+=7):(r=n,0===As&&Os($r)),r!==n&&ea()!==n&&(i=Ya())!==n?(ys=t,t=r=Qi(i)):(vs=t,t=n),t===n&&(t=vs,e.substr(vs,11).toLowerCase()===Zi?(r=e.substr(vs,11),vs+=11):(r=n,0===As&&Os(eo)),r!==n&&ea()!==n&&(i=Ya())!==n?(ys=t,t=r=to(i)):(vs=t,t=n),t===n&&(t=za()))),t}function uc(){var e;return(e=ec())===n&&(e=za()),e}function hc(){var t,r,i,o,s,a,c,u;if(t=vs,(r=function(){var t,r,i,o,s,a;return t=vs,(r=function(){var t,r;return t=vs,e.substr(vs,3).toLowerCase()===ot?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(mr)),r===n&&(r=Js()),r!==n&&(ys=t,r=Uo(r)),t=r}())!==n&&(i=Zs())!==n&&(o=Js())!==n&&(s=Zs())!==n&&(a=pc())!==n?t=r=[r,i,o,s,a]:(vs=t,t=n),t}())!==n)if((i=Ks())!==n)if((o=function(){var t,r,i,o,s;return t=vs,(r=function(){var e,t;return e=vs,(t=ya())===n&&(t=Ea())===n&&(t=Ca()),t!==n&&(ys=e,t=Bo()),e=t}())!==n?(i=vs,(o=function(){var t,r;return t=vs,Vs()!==n?(58===e.charCodeAt(vs)?(r=x,vs++):(r=n,0===As&&Os(U)),r!==n&&Vs()!==n?(ys=t,t=je()):(vs=t,t=n)):(vs=t,t=n),t}())!==n&&(s=function(){var e,t,r,i,o,s,a;return e=vs,t=vs,(r=ks())===n&&(r=null),r!==n?((i=ks())===n&&(i=null),i!==n?((o=ks())===n&&(o=null),o!==n?((s=ks())===n&&(s=null),s!==n?((a=ks())===n&&(a=null),a!==n?t=r=[r,i,o,s,a]:(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t!==n&&(ys=e,t=Fo(t)),e=t}())!==n?i=o=[o,s]:(vs=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(vs=t,t=n)):(vs=t,t=n),t}())!==n){for(s=[],a=vs,(c=ia())!==n&&(u=dc())!==n?a=c=[c,u]:(vs=a,a=n);a!==n;)s.push(a),a=vs,(c=ia())!==n&&(u=dc())!==n?a=c=[c,u]:(vs=a,a=n);s!==n?t=r=[r,i,o,s]:(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;else vs=t,t=n;return t}function dc(){var t;return(t=function(){var t,r,i;return t=vs,e.substr(vs,3).toLowerCase()===To?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(Co)),r!==n&&ea()!==n&&(i=lc())!==n?(ys=t,r=So(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,5).toLowerCase()===Ao?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(bo)),r!==n&&ea()!==n&&(i=va())!==n?(ys=t,r=Eo(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,8).toLowerCase()===wo?(r=e.substr(vs,8),vs+=8):(r=n,0===As&&Os(_o)),r!==n&&ea()!==n?((i=Ea())===n&&(i=Sa())===n&&(i=Ca()),i!==n?(ys=t,r=Ro(i),t=r):(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i;return t=vs,e.substr(vs,6).toLowerCase()===Io?(r=e.substr(vs,6),vs+=6):(r=n,0===As&&Os(Oo)),r!==n&&ea()!==n&&(i=Js())!==n?(ys=t,r=No(i),t=r):(vs=t,t=n),t}())===n&&(t=function(){var t,r,i,o;if(t=vs,e.substr(vs,5).toLowerCase()===Do?(r=e.substr(vs,5),vs+=5):(r=n,0===As&&Os(ko)),r!==n)if(ea()!==n){for(i=[],o=ks();o!==n;)i.push(o),o=ks();i!==n?(ys=t,r=xo(i),t=r):(vs=t,t=n)}else vs=t,t=n;else vs=t,t=n;return t}())===n&&(t=za()),t}function pc(){var t,r;return t=vs,e.substr(vs,3).toLowerCase()===Lt?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(Po)),r===n&&(e.substr(vs,3).toLowerCase()===qt?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(Lo)),r===n&&(e.substr(vs,3).toLowerCase()===jt?(r=e.substr(vs,3),vs+=3):(r=n,0===As&&Os(Ho)),r===n&&(e.substr(vs,4).toLowerCase()===Bt?(r=e.substr(vs,4),vs+=4):(r=n,0===As&&Os(qo)),r===n&&(r=Js())))),r!==n&&(ys=t,r=Mo(r)),t=r}function lc(){var e,t,r,i,o;return e=vs,t=vs,(r=ks())!==n?((i=ks())===n&&(i=null),i!==n?((o=ks())===n&&(o=null),o!==n?t=r=[r,i,o]:(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t!==n&&(ys=e,t=jo(t)),e=t}function fc(){var t;return(t=function(){var t,r,i;return t=vs,e.substr(vs,9)===Wo?(r=Wo,vs+=9):(r=n,0===As&&Os(Ko)),r!==n&&ea()!==n?(e.substr(vs,3)===Vo?(i=Vo,vs+=3):(i=n,0===As&&Os(Yo)),i===n&&(e.substr(vs,3)===zo?(i=zo,vs+=3):(i=n,0===As&&Os($o))),i!==n?(ys=t,r=Jo(i),t=r):(vs=t,t=n)):(vs=t,t=n),t}())===n&&(t=za()),t}function gc(){var t,r,i,o,s;return t=vs,(r=function(){var e,t;return e=vs,(t=Ea())===n&&(t=Ca())===n&&(t=qa()),t!==n&&(ys=e,t=ns(t)),e=t}())!==n?(i=vs,58===e.charCodeAt(vs)?(o=x,vs++):(o=n,0===As&&Os(U)),o!==n&&(s=_a())!==n?i=o=[o,s]:(vs=i,i=n),i===n&&(i=null),i!==n?t=r=[r,i]:(vs=t,t=n)):(vs=t,t=n),t}function mc(){var e,t,r,i,o;return e=vs,(t=Us())!==n&&(r=Us())!==n&&(i=Us())!==n&&(o=Us())!==n?e=t=[t,r,i,o]:(vs=e,e=n),e}function vc(){var t,r,i,o;return t=vs,e.substr(vs,3)===gs?(r=gs,vs+=3):(r=n,0===As&&Os(ms)),r!==n&&(i=ea())!==n&&(o=function(){var t,r,i,o,s,a;return t=vs,(r=oa())!==n&&(i=Gs())!==n?(64===e.charCodeAt(vs)?(o=P,vs++):(o=n,0===As&&Os(L)),o!==n?((s=Gs())===n&&(s=va()),s!==n&&(a=sa())!==n?t=r=[r,i,o,s,a]:(vs=t,t=n)):(vs=t,t=n)):(vs=t,t=n),t}())!==n?t=r=[r,i,o]:(vs=t,t=n),t}if(t.data={},(r=c())!==n&&vs===e.length)return r;throw r!==n&&vs<e.length&&Os({type:"end"}),Ns(Ss,Cs<e.length?e.charAt(Cs):null,Cs<e.length?Is(Cs,Cs+1):Is(Cs,Cs))}},function(e,t,r){var n;e.exports=(n=r(64),function(e){var t=n,r=t.lib,i=r.WordArray,o=r.Hasher,s=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=s.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,s=e[t+0],c=e[t+1],l=e[t+2],f=e[t+3],g=e[t+4],m=e[t+5],v=e[t+6],y=e[t+7],T=e[t+8],C=e[t+9],S=e[t+10],A=e[t+11],b=e[t+12],E=e[t+13],w=e[t+14],_=e[t+15],R=o[0],I=o[1],O=o[2],N=o[3];R=u(R,I,O,N,s,7,a[0]),N=u(N,R,I,O,c,12,a[1]),O=u(O,N,R,I,l,17,a[2]),I=u(I,O,N,R,f,22,a[3]),R=u(R,I,O,N,g,7,a[4]),N=u(N,R,I,O,m,12,a[5]),O=u(O,N,R,I,v,17,a[6]),I=u(I,O,N,R,y,22,a[7]),R=u(R,I,O,N,T,7,a[8]),N=u(N,R,I,O,C,12,a[9]),O=u(O,N,R,I,S,17,a[10]),I=u(I,O,N,R,A,22,a[11]),R=u(R,I,O,N,b,7,a[12]),N=u(N,R,I,O,E,12,a[13]),O=u(O,N,R,I,w,17,a[14]),R=h(R,I=u(I,O,N,R,_,22,a[15]),O,N,c,5,a[16]),N=h(N,R,I,O,v,9,a[17]),O=h(O,N,R,I,A,14,a[18]),I=h(I,O,N,R,s,20,a[19]),R=h(R,I,O,N,m,5,a[20]),N=h(N,R,I,O,S,9,a[21]),O=h(O,N,R,I,_,14,a[22]),I=h(I,O,N,R,g,20,a[23]),R=h(R,I,O,N,C,5,a[24]),N=h(N,R,I,O,w,9,a[25]),O=h(O,N,R,I,f,14,a[26]),I=h(I,O,N,R,T,20,a[27]),R=h(R,I,O,N,E,5,a[28]),N=h(N,R,I,O,l,9,a[29]),O=h(O,N,R,I,y,14,a[30]),R=d(R,I=h(I,O,N,R,b,20,a[31]),O,N,m,4,a[32]),N=d(N,R,I,O,T,11,a[33]),O=d(O,N,R,I,A,16,a[34]),I=d(I,O,N,R,w,23,a[35]),R=d(R,I,O,N,c,4,a[36]),N=d(N,R,I,O,g,11,a[37]),O=d(O,N,R,I,y,16,a[38]),I=d(I,O,N,R,S,23,a[39]),R=d(R,I,O,N,E,4,a[40]),N=d(N,R,I,O,s,11,a[41]),O=d(O,N,R,I,f,16,a[42]),I=d(I,O,N,R,v,23,a[43]),R=d(R,I,O,N,C,4,a[44]),N=d(N,R,I,O,b,11,a[45]),O=d(O,N,R,I,_,16,a[46]),R=p(R,I=d(I,O,N,R,l,23,a[47]),O,N,s,6,a[48]),N=p(N,R,I,O,y,10,a[49]),O=p(O,N,R,I,w,15,a[50]),I=p(I,O,N,R,m,21,a[51]),R=p(R,I,O,N,b,6,a[52]),N=p(N,R,I,O,f,10,a[53]),O=p(O,N,R,I,S,15,a[54]),I=p(I,O,N,R,c,21,a[55]),R=p(R,I,O,N,T,6,a[56]),N=p(N,R,I,O,_,10,a[57]),O=p(O,N,R,I,v,15,a[58]),I=p(I,O,N,R,E,21,a[59]),R=p(R,I,O,N,g,6,a[60]),N=p(N,R,I,O,A,10,a[61]),O=p(O,N,R,I,l,15,a[62]),I=p(I,O,N,R,C,21,a[63]),o[0]=o[0]+R|0,o[1]=o[1]+I|0,o[2]=o[2]+O|0,o[3]=o[3]+N|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;r[i>>>5]|=128<<24-i%32;var o=e.floor(n/4294967296),s=n;r[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),r[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,c=a.words,u=0;u<4;u++){var h=c[u];c[u]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,i,o,s){var a=e+(t&r|~t&n)+i+s;return(a<<o|a>>>32-o)+t}function h(e,t,r,n,i,o,s){var a=e+(t&n|r&~n)+i+s;return(a<<o|a>>>32-o)+t}function d(e,t,r,n,i,o,s){var a=e+(t^r^n)+i+s;return(a<<o|a>>>32-o)+t}function p(e,t,r,n,i,o,s){var a=e+(r^(t|~n))+i+s;return(a<<o|a>>>32-o)+t}t.MD5=o._createHelper(c),t.HmacMD5=o._createHmacHelper(c)}(Math),n.MD5)},function(e,t,r){var n;e.exports=(n=n||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var s=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=s<<24-(n+o)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],i=function(t){var t=t,r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var a=i(4294967296*(r||e.random()));r=987654071*a(),n.push(4294967296*a()|0)}return new s.init(n,t)}}),a=n.enc={},c=a.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},u=a.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},h=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,a=4*o,c=i/a,u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*o,h=e.min(4*u,i);if(u){for(var d=0;d<u;d+=o)this._doProcessBlock(n,d);var p=n.splice(0,u);r.sigBytes-=h}return new s.init(p,h)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(i.Hasher=d.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),n)},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(5),s=r(2),a=r(0),c=r(6),u=r(3),h=function(e){function t(t,r,n){void 0===n&&(n={});var i=e.call(this)||this;if(i.C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500},i.type=a.TypeStrings.DTMF,void 0===r)throw new TypeError("Not enough arguments");if(i.logger=t.ua.getLogger("sip.invitecontext.dtmf",t.id),i.owner=t,"string"==typeof r)r=r.toUpperCase();else{if("number"!=typeof r)throw new TypeError("Invalid tone: "+r);r=r.toString()}if(!r.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+r);i.tone=r;var o=n.duration,s=n.interToneGap;if(o&&!u.Utils.isDecimal(o))throw new TypeError("Invalid tone duration: "+o);if(o?o<i.C.MIN_DURATION?(i.logger.warn("'duration' value is lower than the minimum allowed, setting it to "+i.C.MIN_DURATION+" milliseconds"),o=i.C.MIN_DURATION):o>i.C.MAX_DURATION?(i.logger.warn("'duration' value is greater than the maximum allowed, setting it to "+i.C.MAX_DURATION+" milliseconds"),o=i.C.MAX_DURATION):o=Math.abs(o):o=i.C.DEFAULT_DURATION,i.duration=o,s&&!u.Utils.isDecimal(s))throw new TypeError("Invalid interToneGap: "+s);return s?s<i.C.MIN_INTER_TONE_GAP?(i.logger.warn("'interToneGap' value is lower than the minimum allowed, setting it to "+i.C.MIN_INTER_TONE_GAP+" milliseconds"),s=i.C.MIN_INTER_TONE_GAP):s=Math.abs(s):s=i.C.DEFAULT_INTER_TONE_GAP,i.interToneGap=s,i}return i(t,e),t.prototype.send=function(e){if(void 0===e&&(e={}),this.owner.status!==a.SessionStatus.STATUS_CONFIRMED&&this.owner.status!==a.SessionStatus.STATUS_WAITING_FOR_ACK)throw new c.Exceptions.InvalidStateError(this.owner.status);var t=e.extraHeaders?e.extraHeaders.slice():[],r={contentType:"application/dtmf-relay",body:"Signal= "+this.tone+"\r\nDuration= "+this.duration};if(this.owner.dialog){var n=this.owner.dialog.sendRequest(this,s.C.INFO,{extraHeaders:t,body:r});this.owner.emit("dtmf",n,this)}},t.prototype.init_incoming=function(e){e.reply(200),this.tone&&this.duration?this.owner.emit("dtmf",e,this):this.logger.warn("invalid INFO DTMF received, discarded")},t.prototype.receiveResponse=function(e){var t=e&&e.statusCode?e.statusCode:0;switch(!0){case/^1[0-9]{2}$/.test(t.toString()):break;case/^2[0-9]{2}$/.test(t.toString()):this.emit("succeeded",{originator:"remote",response:e});break;default:var r=u.Utils.sipErrorCause(t);this.emit("failed",e,r)}},t.prototype.onRequestTimeout=function(){this.emit("failed",void 0,s.C.causes.REQUEST_TIMEOUT),this.owner.onRequestTimeout()},t.prototype.onTransportError=function(){this.emit("failed",void 0,s.C.causes.CONNECTION_ERROR),this.owner.onTransportError()},t.prototype.onDialogError=function(e){this.emit("failed",e,s.C.causes.DIALOG_ERROR),this.owner.onDialogError(e)},t}(o.EventEmitter);t.DTMF=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(e,t){this.type=n.TypeStrings.SessionDescriptionHandlerObserver,this.session=e,this.options=t}return e.prototype.trackAdded=function(){this.session.emit("trackAdded")},e.prototype.directionChanged=function(){this.session.emit("directionChanged")},e}();t.SessionDescriptionHandlerObserver=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(23);t.Modifiers=n;var i=r(68);t.Simple=i.Simple;var o=r(41);t.SessionDescriptionHandler=o.SessionDescriptionHandler;var s=r(42);t.Transport=s.Transport},function(e,t,r){"use strict";(function(e){var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=r(5),a=r(40),c=r(23);!function(e){e[e.STATUS_NULL=0]="STATUS_NULL",e[e.STATUS_NEW=1]="STATUS_NEW",e[e.STATUS_CONNECTING=2]="STATUS_CONNECTING",e[e.STATUS_CONNECTED=3]="STATUS_CONNECTED",e[e.STATUS_COMPLETED=4]="STATUS_COMPLETED"}(o=t.SimpleStatus||(t.SimpleStatus={}));var u=function(t){function r(r){var n=t.call(this)||this;if(r.media.remote.video?n.video=!0:n.video=!1,r.media.remote.audio?n.audio=!0:n.audio=!1,!n.audio&&!n.video)throw new Error("At least one remote audio or video element is required for Simple.");n.options=r;var i=e.navigator.userAgent.toLowerCase(),s=!1,u=!1;i.indexOf("safari")>-1&&i.indexOf("chrome")<0?s=!0:i.indexOf("firefox")>-1&&i.indexOf("chrome")<0&&(u=!0);var h={};return s&&(h.modifiers=[c.stripG722]),u&&(h.alwaysAcquireMediaFirst=!0),n.options.ua.uri?n.anonymous=!1:n.anonymous=!0,n.ua=new a.UA({uri:n.options.ua.uri,authorizationUser:n.options.ua.authorizationUser,password:n.options.ua.password,displayName:n.options.ua.displayName,userAgentString:n.options.ua.userAgentString,register:!0,sessionDescriptionHandlerFactoryOptions:h,transportOptions:{traceSip:n.options.ua.traceSip,wsServers:n.options.ua.wsServers}}),n.state=o.STATUS_NULL,n.logger=n.ua.getLogger("sip.simple"),n.ua.on("registered",function(){n.emit("registered",n.ua)}),n.ua.on("unregistered",function(){n.emit("unregistered",n.ua)}),n.ua.on("registrationFailed",function(){n.emit("unregistered",n.ua)}),n.ua.on("invite",function(e){if(n.state!==o.STATUS_NULL&&n.state!==o.STATUS_COMPLETED)return n.logger.warn("Rejecting incoming call. Simple only supports 1 call at a time"),void e.reject();n.session=e,n.setupSession(),n.emit("ringing",n.session)}),n.ua.on("message",function(e){n.emit("message",e)}),n}return i(r,t),r.prototype.call=function(e){if(this.ua&&this.checkRegistration()){if(this.state===o.STATUS_NULL||this.state===o.STATUS_COMPLETED)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.autoplay=!0,this.options.media.local.video.volume=0),this.session=this.ua.invite(e,{sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}}),this.setupSession(),this.session;this.logger.warn("Cannot make more than a single call with Simple")}else this.logger.warn("A registered UA is required for calling")},r.prototype.answer=function(){if(this.state===o.STATUS_NEW||this.state===o.STATUS_CONNECTING)return this.options.media.remote.audio&&(this.options.media.remote.audio.autoplay=!0),this.options.media.remote.video&&(this.options.media.remote.video.autoplay=!0),this.session.accept({sessionDescriptionHandlerOptions:{constraints:{audio:this.audio,video:this.video}}});this.logger.warn("No call to answer")},r.prototype.reject=function(){if(this.state===o.STATUS_NEW||this.state===o.STATUS_CONNECTING)return this.session.reject();this.logger.warn("Call is already answered")},r.prototype.hangup=function(){if(this.state===o.STATUS_CONNECTED||this.state===o.STATUS_CONNECTING||this.state===o.STATUS_NEW)return this.state!==o.STATUS_CONNECTED?this.session.cancel():this.session?this.session.bye():void 0;this.logger.warn("No active call to hang up on")},r.prototype.hold=function(){if(this.state===o.STATUS_CONNECTED&&this.session&&!this.session.localHold)return this.mute(),this.logger.log("Placing session on hold"),this.session.hold();this.logger.warn("Cannot put call on hold")},r.prototype.unhold=function(){if(this.state===o.STATUS_CONNECTED&&this.session&&this.session.localHold)return this.unmute(),this.logger.log("Placing call off hold"),this.session.unhold();this.logger.warn("Cannot unhold a call that is not on hold")},r.prototype.mute=function(){this.state===o.STATUS_CONNECTED?(this.logger.log("Muting Audio"),this.toggleMute(!0),this.emit("mute",this)):this.logger.warn("An acitve call is required to mute audio")},r.prototype.unmute=function(){this.state===o.STATUS_CONNECTED?(this.logger.log("Unmuting Audio"),this.toggleMute(!1),this.emit("unmute",this)):this.logger.warn("An active call is required to unmute audio")},r.prototype.sendDTMF=function(e){this.state===o.STATUS_CONNECTED&&this.session?(this.logger.log("Sending DTMF tone: "+e),this.session.dtmf(e)):this.logger.warn("An active call is required to send a DTMF tone")},r.prototype.message=function(e,t){this.ua&&this.checkRegistration()?e&&t?this.ua.message(e,t):this.logger.warn("A destination and message are required to send a message"):this.logger.warn("A registered UA is required to send a message")},r.prototype.checkRegistration=function(){return this.anonymous||this.ua&&this.ua.isRegistered()},r.prototype.setupRemoteMedia=function(){var t=this;if(this.session){var r,n=this.session.sessionDescriptionHandler.peerConnection;n.getReceivers?(r=new e.window.MediaStream,n.getReceivers().forEach(function(e){var t=e.track;t&&r.addTrack(t)})):r=n.getRemoteStreams()[0],this.video?(this.options.media.remote.video.srcObject=r,this.options.media.remote.video.play().catch(function(){t.logger.log("play was rejected")})):this.audio&&(this.options.media.remote.audio.srcObject=r,this.options.media.remote.audio.play().catch(function(){t.logger.log("play was rejected")}))}else this.logger.warn("No session to set remote media on")},r.prototype.setupLocalMedia=function(){if(this.session){if(this.video&&this.options.media.local&&this.options.media.local.video){var t,r=this.session.sessionDescriptionHandler.peerConnection;r.getSenders?(t=new e.window.MediaStream,r.getSenders().forEach(function(e){var r=e.track;r&&"video"===r.kind&&t.addTrack(r)})):t=r.getLocalStreams()[0],this.options.media.local.video.srcObject=t,this.options.media.local.video.volume=0,this.options.media.local.video.play()}}else this.logger.warn("No session to set local media on")},r.prototype.cleanupMedia=function(){this.video&&(this.options.media.remote.video.srcObject=null,this.options.media.remote.video.pause(),this.options.media.local&&this.options.media.local.video&&(this.options.media.local.video.srcObject=null,this.options.media.local.video.pause())),this.audio&&(this.options.media.remote.audio.srcObject=null,this.options.media.remote.audio.pause())},r.prototype.setupSession=function(){var e=this;this.session?(this.state=o.STATUS_NEW,this.emit("new",this.session),this.session.on("progress",function(){return e.onProgress()}),this.session.on("accepted",function(){return e.onAccepted()}),this.session.on("rejected",function(){return e.onEnded()}),this.session.on("failed",function(){return e.onFailed()}),this.session.on("terminated",function(){return e.onEnded()})):this.logger.warn("No session to set up")},r.prototype.destroyMedia=function(){this.session&&this.session.sessionDescriptionHandler&&this.session.sessionDescriptionHandler.close()},r.prototype.toggleMute=function(e){if(this.session){var t=this.session.sessionDescriptionHandler.peerConnection;t.getSenders?t.getSenders().forEach(function(t){t.track&&(t.track.enabled=!e)}):t.getLocalStreams().forEach(function(t){t.getAudioTracks().forEach(function(t){t.enabled=!e}),t.getVideoTracks().forEach(function(t){t.enabled=!e})})}else this.logger.warn("No session to toggle mute")},r.prototype.onAccepted=function(){var e=this;this.session?(this.state=o.STATUS_CONNECTED,this.emit("connected",this.session),this.setupLocalMedia(),this.setupRemoteMedia(),this.session.sessionDescriptionHandler&&(this.session.sessionDescriptionHandler.on("addTrack",function(){e.logger.log("A track has been added, triggering new remoteMedia setup"),e.setupRemoteMedia()}),this.session.sessionDescriptionHandler.on("addStream",function(){e.logger.log("A stream has been added, trigger new remoteMedia setup"),e.setupRemoteMedia()})),this.session.on("dtmf",function(t,r){e.emit("dtmf",r.tone)}),this.session.on("bye",function(){return e.onEnded()})):this.logger.warn("No session for accepting")},r.prototype.onProgress=function(){this.state=o.STATUS_CONNECTING,this.emit("connecting",this.session)},r.prototype.onFailed=function(){this.onEnded()},r.prototype.onEnded=function(){this.state=o.STATUS_COMPLETED,this.emit("ended",this.session),this.cleanupMedia()},r.C=o,r}(s.EventEmitter);t.Simple=u}).call(this,r(1))},function(e,t,r){"use strict";var n=r(4),i=r(43),o=r(71),s=r(24);function a(e){var t=new o(e),r=i(o.prototype.request,t);return n.extend(r,o.prototype,t),n.extend(r,t),r}var c=a(s);c.Axios=o,c.create=function(e){return a(n.merge(s,e))},c.Cancel=r(47),c.CancelToken=r(85),c.isCancel=r(46),c.all=function(e){return Promise.all(e)},c.spread=r(86),e.exports=c,e.exports.default=c},function(e,t){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,r){"use strict";var n=r(24),i=r(4),o=r(80),s=r(81),a=r(83),c=r(84);function u(e){this.defaults=e,this.interceptors={request:new o,response:new o}}u.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(n,this.defaults,{method:"get"},e)).method=e.method.toLowerCase(),e.baseURL&&!a(e.url)&&(e.url=c(e.baseURL,e.url));var t=[s,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head","options"],function(e){u.prototype[e]=function(t,r){return this.request(i.merge(r||{},{method:e,url:t}))}}),i.forEach(["post","put","patch"],function(e){u.prototype[e]=function(t,r,n){return this.request(i.merge(n||{},{method:e,url:t,data:r}))}}),e.exports=u},function(e,t,r){"use strict";var n=r(4);e.exports=function(e,t){n.forEach(e,function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])})}},function(e,t,r){"use strict";var n=r(45);e.exports=function(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r.request,r)):e(r)}},function(e,t,r){"use strict";e.exports=function(e,t,r,n,i){return e.config=t,r&&(e.code=r),e.request=n,e.response=i,e}},function(e,t,r){"use strict";var n=r(4);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var o;if(r)o=r(t);else if(n.isURLSearchParams(t))o=t.toString();else{var s=[];n.forEach(t,function(e,t){null!=e&&(n.isArray(e)&&(t+="[]"),n.isArray(e)||(e=[e]),n.forEach(e,function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),s.push(i(t)+"="+i(e))}))}),o=s.join("&")}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e}},function(e,t,r){"use strict";var n=r(4);e.exports=function(e){var t,r,i,o={};return e?(n.forEach(e.split("\n"),function(e){i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),r=n.trim(e.substr(i+1)),t&&(o[t]=o[t]?o[t]+", "+r:r)}),o):o}},function(e,t,r){"use strict";var n=r(4);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function i(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=i(window.location.href),function(t){var r=n.isString(t)?i(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i(){this.message="String contains an invalid character"}i.prototype=new Error,i.prototype.code=5,i.prototype.name="InvalidCharacterError",e.exports=function(e){for(var t,r,o=String(e),s="",a=0,c=n;o.charAt(0|a)||(c="=",a%1);s+=c.charAt(63&t>>8-a%1*8)){if((r=o.charCodeAt(a+=.75))>255)throw new i;t=t<<8|r}return s}},function(e,t,r){"use strict";var n=r(4);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,i,o,s){var a=[];a.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),n.isString(i)&&a.push("path="+i),n.isString(o)&&a.push("domain="+o),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var n=r(4);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){n.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=i},function(e,t,r){"use strict";var n=r(4),i=r(82),o=r(46),s=r(24);function a(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return a(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||s.adapter)(e).then(function(t){return a(e),t.data=i(t.data,t.headers,e.transformResponse),t},function(t){return o(t)||(a(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,r){"use strict";var n=r(4);e.exports=function(e,t,r){return n.forEach(r,function(r){e=r(e,t)}),e}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var n=r(47);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new n(e),t(r.reason))})}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i(function(t){e=t}),cancel:e}},e.exports=i},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,r){(function(t){var n=r(48),i=r(18)("socket.io-client:url");e.exports=function(e,r){var o=e;r=r||t.location,null==e&&(e=r.protocol+"//"+r.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==r?r.protocol+"//"+e:"https://"+e),i("parse %s",e),o=n(e));o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443"));o.path=o.path||"/";var s=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+s+":"+o.port,o.href=o.protocol+"://"+s+(r&&r.port===o.port?"":":"+o.port),o}}).call(this,r(1))},function(e,t,r){(t=e.exports=o.debug=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e);for(var r=(e||"").split(/[\s,]+/),n=r.length,i=0;i<n;i++)r[i]&&("-"===(e=r[i].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(89),t.names=[],t.skips=[],t.formatters={};var n,i=0;function o(e){function r(){}function o(){var e=o,r=+new Date,s=r-(n||r);e.diff=s,e.prev=n,e.curr=r,n=r,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=t.colors[i++%t.colors.length]);for(var a=new Array(arguments.length),c=0;c<a.length;c++)a[c]=arguments[c];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var u=0;a[0]=a[0].replace(/%([a-z%])/g,function(r,n){if("%%"===r)return r;u++;var i=t.formatters[n];if("function"==typeof i){var o=a[u];r=i.call(e,o),a.splice(u,1),u--}return r}),a=t.formatArgs.apply(e,a),(o.log||t.log||console.log.bind(console)).apply(e,a)}r.enabled=!1,o.enabled=!0;var s=t.enabled(e)?o:r;return s.namespace=e,s}},function(e,t){var r=1e3,n=60*r,i=60*n,o=24*i,s=365.25*o;function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var c,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?a(c=e,o,"day")||a(c,i,"hour")||a(c,n,"minute")||a(c,r,"second")||c+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=n)return Math.round(e/n)+"m";if(e>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){function n(){var e;try{e=t.storage.debug}catch(e){}return e}(t=e.exports=r(91)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(){var e=arguments,r=this.useColors;if(e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff),!r)return e;var n="color: "+this.color;e=[e[0],n,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,n),e},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){return JSON.stringify(e)},t.enable(n())},function(e,t,r){(t=e.exports=function(e){function r(){}function o(){var e=o,r=+new Date,s=r-(n||r);e.diff=s,e.prev=n,e.curr=r,n=r,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=t.colors[i++%t.colors.length]);var a=Array.prototype.slice.call(arguments);a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var c=0;a[0]=a[0].replace(/%([a-z%])/g,function(r,n){if("%%"===r)return r;c++;var i=t.formatters[n];if("function"==typeof i){var o=a[c];r=i.call(e,o),a.splice(c,1),c--}return r}),"function"==typeof t.formatArgs&&(a=t.formatArgs.apply(e,a));var u=o.log||t.log||console.log.bind(console);u.apply(e,a)}r.enabled=!1,o.enabled=!0;var s=t.enabled(e)?o:r;return s.namespace=e,s}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e);for(var r=(e||"").split(/[\s,]+/),n=r.length,i=0;i<n;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(92),t.names=[],t.skips=[],t.formatters={};var n,i=0},function(e,t){var r=1e3,n=60*r,i=60*n,o=24*i,s=365.25*o;function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){return t=t||{},"string"==typeof e?function(e){if((e=""+e).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a}}(e):t.long?a(c=e,o,"day")||a(c,i,"hour")||a(c,n,"minute")||a(c,r,"second")||c+" ms":function(e){return e>=o?Math.round(e/o)+"d":e>=i?Math.round(e/i)+"h":e>=n?Math.round(e/n)+"m":e>=r?Math.round(e/r)+"s":e+"ms"}(e);var c}},function(e,t,r){(function(e,n){var i;/*! JSON v3.3.2 | http://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org */(function(){var o=r(94),s={function:!0,object:!0},a=s[typeof t]&&t&&!t.nodeType&&t,c=s[typeof window]&&window||this,u=a&&s[typeof e]&&e&&!e.nodeType&&"object"==typeof n&&n;function h(e,t){e||(e=c.Object()),t||(t=c.Object());var r=e.Number||c.Number,n=e.String||c.String,i=e.Object||c.Object,o=e.Date||c.Date,a=e.SyntaxError||c.SyntaxError,u=e.TypeError||c.TypeError,d=e.Math||c.Math,p=e.JSON||c.JSON;"object"==typeof p&&p&&(t.stringify=p.stringify,t.parse=p.parse);var l,f,g,m=i.prototype,v=m.toString,y=new o(-0xc782b5b800cec);try{y=-109252==y.getUTCFullYear()&&0===y.getUTCMonth()&&1===y.getUTCDate()&&10==y.getUTCHours()&&37==y.getUTCMinutes()&&6==y.getUTCSeconds()&&708==y.getUTCMilliseconds()}catch(e){}function T(e){if(T[e]!==g)return T[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=T("json-stringify")&&T("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var c=t.stringify,u="function"==typeof c&&y;if(u){(s=function(){return 1}).toJSON=s;try{u="0"===c(0)&&"0"===c(new r)&&'""'==c(new n)&&c(v)===g&&c(g)===g&&c()===g&&"1"===c(s)&&"[1]"==c([s])&&"[null]"==c([g])&&"null"==c(null)&&"[null,null,null]"==c([g,v,null])&&c({a:[s,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===c(null,s)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new o(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==c(new o(864e13))&&'"-000001-01-01T00:00:00.000Z"'==c(new o(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==c(new o(-1))}catch(e){u=!1}}i=u}if("json-parse"==e){var h=t.parse;if("function"==typeof h)try{if(0===h("0")&&!h(!1)){var d=5==(s=h(a)).a.length&&1===s.a[0];if(d){try{d=!h('"\t"')}catch(e){}if(d)try{d=1!==h("01")}catch(e){}if(d)try{d=1!==h("1.")}catch(e){}}}}catch(e){d=!1}i=d}}return T[e]=!!i}if(!T("json")){var C=T("bug-string-char-index");if(!y)var S=d.floor,A=[0,31,59,90,120,151,181,212,243,273,304,334],b=function(e,t){return A[t]+365*(e-1970)+S((e-1969+(t=+(t>1)))/4)-S((e-1901+t)/100)+S((e-1601+t)/400)};if((l=m.hasOwnProperty)||(l=function(e){var t,r={};return(r.__proto__=null,r.__proto__={toString:1},r).toString!=v?l=function(e){var t=this.__proto__,r=e in(this.__proto__=null,this);return this.__proto__=t,r}:(t=r.constructor,l=function(e){var r=(this.constructor||t).prototype;return e in this&&!(e in r&&this[e]===r[e])}),r=null,l.call(this,e)}),f=function(e,t){var r,n,i,o=0;for(i in(r=function(){this.valueOf=0}).prototype.valueOf=0,n=new r)l.call(n,i)&&o++;return r=n=null,o?f=2==o?function(e,t){var r,n={},i="[object Function]"==v.call(e);for(r in e)i&&"prototype"==r||l.call(n,r)||!(n[r]=1)||!l.call(e,r)||t(r)}:function(e,t){var r,n,i="[object Function]"==v.call(e);for(r in e)i&&"prototype"==r||!l.call(e,r)||(n="constructor"===r)||t(r);(n||l.call(e,r="constructor"))&&t(r)}:(n=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],f=function(e,t){var r,i,o="[object Function]"==v.call(e),a=!o&&"function"!=typeof e.constructor&&s[typeof e.hasOwnProperty]&&e.hasOwnProperty||l;for(r in e)o&&"prototype"==r||!a.call(e,r)||t(r);for(i=n.length;r=n[--i];a.call(e,r)&&t(r));}),f(e,t)},!T("json-stringify")){var E={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},w=function(e,t){return("000000"+(t||0)).slice(-e)},_=function(e){for(var t='"',r=0,n=e.length,i=!C||n>10,o=i&&(C?e.split(""):e);r<n;r++){var s=e.charCodeAt(r);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=E[s];break;default:if(s<32){t+="\\u00"+w(2,s.toString(16));break}t+=i?o[r]:e.charAt(r)}}return t+'"'},R=function(e,t,r,n,i,o,s){var a,c,h,d,p,m,y,T,C,A,E,I,O,N,D,k;try{a=t[e]}catch(e){}if("object"==typeof a&&a)if("[object Date]"!=(c=v.call(a))||l.call(a,"toJSON"))"function"==typeof a.toJSON&&("[object Number]"!=c&&"[object String]"!=c&&"[object Array]"!=c||l.call(a,"toJSON"))&&(a=a.toJSON(e));else if(a>-1/0&&a<1/0){if(b){for(p=S(a/864e5),h=S(p/365.2425)+1970-1;b(h+1,0)<=p;h++);for(d=S((p-b(h,0))/30.42);b(h,d+1)<=p;d++);p=1+p-b(h,d),y=S((m=(a%864e5+864e5)%864e5)/36e5)%24,T=S(m/6e4)%60,C=S(m/1e3)%60,A=m%1e3}else h=a.getUTCFullYear(),d=a.getUTCMonth(),p=a.getUTCDate(),y=a.getUTCHours(),T=a.getUTCMinutes(),C=a.getUTCSeconds(),A=a.getUTCMilliseconds();a=(h<=0||h>=1e4?(h<0?"-":"+")+w(6,h<0?-h:h):w(4,h))+"-"+w(2,d+1)+"-"+w(2,p)+"T"+w(2,y)+":"+w(2,T)+":"+w(2,C)+"."+w(3,A)+"Z"}else a=null;if(r&&(a=r.call(t,e,a)),null===a)return"null";if("[object Boolean]"==(c=v.call(a)))return""+a;if("[object Number]"==c)return a>-1/0&&a<1/0?""+a:"null";if("[object String]"==c)return _(""+a);if("object"==typeof a){for(N=s.length;N--;)if(s[N]===a)throw u();if(s.push(a),E=[],D=o,o+=i,"[object Array]"==c){for(O=0,N=a.length;O<N;O++)I=R(O,a,r,n,i,o,s),E.push(I===g?"null":I);k=E.length?i?"[\n"+o+E.join(",\n"+o)+"\n"+D+"]":"["+E.join(",")+"]":"[]"}else f(n||a,function(e){var t=R(e,a,r,n,i,o,s);t!==g&&E.push(_(e)+":"+(i?" ":"")+t)}),k=E.length?i?"{\n"+o+E.join(",\n"+o)+"\n"+D+"}":"{"+E.join(",")+"}":"{}";return s.pop(),k}};t.stringify=function(e,t,r){var n,i,o,a;if(s[typeof t]&&t)if("[object Function]"==(a=v.call(t)))i=t;else if("[object Array]"==a){o={};for(var c,u=0,h=t.length;u<h;c=t[u++],("[object String]"==(a=v.call(c))||"[object Number]"==a)&&(o[c]=1));}if(r)if("[object Number]"==(a=v.call(r))){if((r-=r%1)>0)for(n="",r>10&&(r=10);n.length<r;n+=" ");}else"[object String]"==a&&(n=r.length<=10?r:r.slice(0,10));return R("",((c={})[""]=e,c),i,o,n,"",[])}}if(!T("json-parse")){var I,O,N=n.fromCharCode,D={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},k=function(){throw I=O=null,a()},x=function(){for(var e,t,r,n,i,o=O,s=o.length;I<s;)switch(i=o.charCodeAt(I)){case 9:case 10:case 13:case 32:I++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=C?o.charAt(I):o[I],I++,e;case 34:for(e="@",I++;I<s;)if((i=o.charCodeAt(I))<32)k();else if(92==i)switch(i=o.charCodeAt(++I)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=D[i],I++;break;case 117:for(t=++I,r=I+4;I<r;I++)(i=o.charCodeAt(I))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||k();e+=N("0x"+o.slice(t,I));break;default:k()}else{if(34==i)break;for(i=o.charCodeAt(I),t=I;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++I);e+=o.slice(t,I)}if(34==o.charCodeAt(I))return I++,e;k();default:if(t=I,45==i&&(n=!0,i=o.charCodeAt(++I)),i>=48&&i<=57){for(48==i&&((i=o.charCodeAt(I+1))>=48&&i<=57)&&k(),n=!1;I<s&&((i=o.charCodeAt(I))>=48&&i<=57);I++);if(46==o.charCodeAt(I)){for(r=++I;r<s&&((i=o.charCodeAt(r))>=48&&i<=57);r++);r==I&&k(),I=r}if(101==(i=o.charCodeAt(I))||69==i){for(43!=(i=o.charCodeAt(++I))&&45!=i||I++,r=I;r<s&&((i=o.charCodeAt(r))>=48&&i<=57);r++);r==I&&k(),I=r}return+o.slice(t,I)}if(n&&k(),"true"==o.slice(I,I+4))return I+=4,!0;if("false"==o.slice(I,I+5))return I+=5,!1;if("null"==o.slice(I,I+4))return I+=4,null;k()}return"$"},U=function(e){var t,r;if("$"==e&&k(),"string"==typeof e){if("@"==(C?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=x());r||(r=!0))r&&(","==e?"]"==(e=x())&&k():k()),","==e&&k(),t.push(U(e));return t}if("{"==e){for(t={};"}"!=(e=x());r||(r=!0))r&&(","==e?"}"==(e=x())&&k():k()),","!=e&&"string"==typeof e&&"@"==(C?e.charAt(0):e[0])&&":"==x()||k(),t[e.slice(1)]=U(x());return t}k()}return e},P=function(e,t,r){var n=L(e,t,r);n===g?delete e[t]:e[t]=n},L=function(e,t,r){var n,i=e[t];if("object"==typeof i&&i)if("[object Array]"==v.call(i))for(n=i.length;n--;)P(i,n,r);else f(i,function(e){P(i,e,r)});return r.call(e,t,i)};t.parse=function(e,t){var r,n;return I=0,O=""+e,r=U(x()),"$"!=x()&&k(),I=O=null,t&&"[object Function]"==v.call(t)?L(((n={})[""]=r,n),"",t):r}}}return t.runInContext=h,t}if(!u||u.global!==u&&u.window!==u&&u.self!==u||(c=u),a&&!o)h(c,a);else{var d=c.JSON,p=c.JSON3,l=!1,f=h(c,c.JSON3={noConflict:function(){return l||(l=!0,c.JSON=d,c.JSON3=p,d=p=null),f}});c.JSON={parse:f.parse,stringify:f.stringify}}o&&(void 0===(i=function(){return f}.call(t,r,t,e))||(e.exports=i))}).call(this)}).call(this,r(49)(e),r(1))},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){var r=this;function n(){r.off(e,n),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks[e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){(function(e){var n=r(50),i=r(51);t.deconstructPacket=function(e){var t=[],r=e.data;var o=e;return o.data=function e(r){if(!r)return r;if(i(r)){var o={_placeholder:!0,num:t.length};return t.push(r),o}if(n(r)){for(var s=new Array(r.length),a=0;a<r.length;a++)s[a]=e(r[a]);return s}if("object"==typeof r&&!(r instanceof Date)){for(var c in s={},r)s[c]=e(r[c]);return s}return r}(r),o.attachments=t.length,{packet:o,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(r){if(r&&r._placeholder)return t[r.num];if(n(r)){for(var i=0;i<r.length;i++)r[i]=e(r[i]);return r}if(r&&"object"==typeof r){for(var o in r)r[o]=e(r[o]);return r}return r}(e.data),e.attachments=void 0,e},t.removeBlobs=function(t,r){var o=0,s=t;!function t(a,c,u){if(!a)return a;if(e.Blob&&a instanceof Blob||e.File&&a instanceof File){o++;var h=new FileReader;h.onload=function(){u?u[c]=this.result:s=this.result,--o||r(s)},h.readAsArrayBuffer(a)}else if(n(a))for(var d=0;d<a.length;d++)t(a[d],d,a);else if(a&&"object"==typeof a&&!i(a))for(var p in a)t(a[p],p,a)}(s),o||r(s)}}).call(this,r(1))},function(e,t,r){e.exports=r(98)},function(e,t,r){e.exports=r(99),e.exports.parser=r(12)},function(e,t,r){(function(t){var n=r(53),i=r(13),o=r(20)("engine.io-client:socket"),s=r(57),a=r(12),c=r(48),u=r(113),h=r(28);function d(e,r){if(!(this instanceof d))return new d(e,r);r=r||{},e&&"object"==typeof e&&(r=e,e=null),e?(e=c(e),r.hostname=e.host,r.secure="https"===e.protocol||"wss"===e.protocol,r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=c(r.host).host),this.secure=null!=r.secure?r.secure:t.location&&"https:"===location.protocol,r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.agent=r.agent||!1,this.hostname=r.hostname||(t.location?location.hostname:"localhost"),this.port=r.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=r.query||{},"string"==typeof this.query&&(this.query=h.decode(this.query)),this.upgrade=!1!==r.upgrade,this.path=(r.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!r.forceJSONP,this.jsonp=!1!==r.jsonp,this.forceBase64=!!r.forceBase64,this.enablesXDR=!!r.enablesXDR,this.timestampParam=r.timestampParam||"t",this.timestampRequests=r.timestampRequests,this.transports=r.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=r.policyPort||843,this.rememberUpgrade=r.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=r.onlyBinaryUpgrades,this.perMessageDeflate=!1!==r.perMessageDeflate&&(r.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=r.pfx||null,this.key=r.key||null,this.passphrase=r.passphrase||null,this.cert=r.cert||null,this.ca=r.ca||null,this.ciphers=r.ciphers||null,this.rejectUnauthorized=void 0===r.rejectUnauthorized?null:r.rejectUnauthorized,this.forceNode=!!r.forceNode;var n="object"==typeof t&&t;n.global===n&&(r.extraHeaders&&Object.keys(r.extraHeaders).length>0&&(this.extraHeaders=r.extraHeaders),r.localAddress&&(this.localAddress=r.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=d,d.priorWebsocketSuccess=!1,i(d.prototype),d.protocol=a.protocol,d.Socket=d,d.Transport=r(27),d.transports=r(53),d.parser=r(12),d.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);return t.EIO=a.protocol,t.transport=e,this.id&&(t.sid=this.id),new n[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress})},d.prototype.open=function(){var e;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},d.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},d.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;d.priorWebsocketSuccess="websocket"===t.name,o('pausing current transport "%s"',n.transport.name),n.transport.pause(function(){r||"closed"!==n.readyState&&(o("changing transport and sending upgrade packet"),p(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())})}else{o('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,n.emit("upgradeError",s)}}))}function s(){r||(r=!0,p(),t.close(),t=null)}function a(r){var i=new Error("probe error: "+r);i.transport=t.name,s(),o('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",i)}function c(){a("transport closed")}function u(){a("socket closed")}function h(e){t&&e.name!==t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),s())}function p(){t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",c),n.removeListener("close",u),n.removeListener("upgrading",h)}d.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",a),t.once("close",c),this.once("close",u),this.once("upgrading",h),t.open()},d.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},d.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},d.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},d.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},d.prototype.sendPacket=function(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},d.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():t()}):this.upgrading?n():t()}function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},d.prototype.onError=function(e){o("socket error %j",e),d.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},d.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){o('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},d.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~s(this.transports,e[r])&&t.push(e[r]);return t}}).call(this,r(1))},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,r){(function(t){var n=r(26),i=r(54),o=r(13),s=r(19),a=r(20)("engine.io-client:polling-xhr");function c(){}function u(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,t.location){var r="https:"===location.protocol,n=location.port;n||(n=r?443:80),this.xd=e.hostname!==t.location.hostname||n!==e.port,this.xs=e.secure!==r}else this.extraHeaders=e.extraHeaders}function h(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function d(){for(var e in h.requests)h.requests.hasOwnProperty(e)&&h.requests[e].abort()}e.exports=u,e.exports.Request=h,s(u,i),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new h(e)},u.prototype.doWrite=function(e,t){var r="string"!=typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=n},u.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},o(h.prototype),h.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var r=this.xhr=new n(e),i=this;try{a("xhr open %s: %s",this.method,this.uri),r.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in r.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&r.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if(this.supportsBinary&&(r.responseType="arraybuffer"),"POST"===this.method)try{this.isBinary?r.setRequestHeader("Content-type","application/octet-stream"):r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{r.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in r&&(r.withCredentials=!0),this.requestTimeout&&(r.timeout=this.requestTimeout),this.hasXDR()?(r.onload=function(){i.onLoad()},r.onerror=function(){i.onError(r.responseText)}):r.onreadystatechange=function(){4===r.readyState&&(200===r.status||1223===r.status?i.onLoad():setTimeout(function(){i.onError(r.status)},0))},a("xhr data %s",this.data),r.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}t.document&&(this.index=h.requestsCount++,h.requests[this.index]=this)},h.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},h.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},h.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},h.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}t.document&&delete h.requests[this.index],this.xhr=null}},h.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===t)e=this.xhr.response||this.xhr.responseText;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(t){for(var r=new Uint8Array(this.xhr.response),n=[],i=0,o=r.length;i<o;i++)n.push(r[i]);e=String.fromCharCode.apply(null,n)}else e=this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},h.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},h.prototype.abort=function(){this.cleanup()},h.requestsCount=0,h.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",d):t.addEventListener&&t.addEventListener("beforeunload",d,!1))}).call(this,r(1))},function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},function(e,t){e.exports=function(e,t,r){var n=e.byteLength;if(t=t||0,r=r||n,e.slice)return e.slice(t,r);if(t<0&&(t+=n),r<0&&(r+=n),r>n&&(r=n),t>=n||t>=r||0===n)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(r-t),s=t,a=0;s<r;s++,a++)o[a]=i[s];return o.buffer}},function(e,t){function r(){}e.exports=function(e,t,n){var i=!1;return n=n||r,o.count=e,0===e?t():o;function o(e,r){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,t(e),t=n):0!==o.count||i||t(null,r)}}},function(e,t,r){(function(e,n){var i;/*! https://mths.be/wtf8 v1.0.0 by @mathias */!function(o){var s=t,a=(e&&e.exports,"object"==typeof n&&n);a.global!==a&&a.window;var c,u,h,d=String.fromCharCode;function p(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function l(e,t){return d(e>>t&63|128)}function f(e){if(0==(4294967168&e))return d(e);var t="";return 0==(4294965248&e)?t=d(e>>6&31|192):0==(4294901760&e)?(t=d(e>>12&15|224),t+=l(e,6)):0==(4292870144&e)&&(t=d(e>>18&7|240),t+=l(e,12),t+=l(e,6)),t+=d(63&e|128)}function g(){if(h>=u)throw Error("Invalid byte index");var e=255&c[h];if(h++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function m(){var e,t;if(h>u)throw Error("Invalid byte index");if(h==u)return!1;if(e=255&c[h],h++,0==(128&e))return e;if(192==(224&e)){if((t=(31&e)<<6|g())>=128)return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if((t=(15&e)<<12|g()<<6|g())>=2048)return t;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=(15&e)<<18|g()<<12|g()<<6|g())>=65536&&t<=1114111)return t;throw Error("Invalid WTF-8 detected")}var v={version:"1.0.0",encode:function(e){for(var t=p(e),r=t.length,n=-1,i="";++n<r;)i+=f(t[n]);return i},decode:function(e){c=p(e),u=c.length,h=0;for(var t,r=[];!1!==(t=m());)r.push(t);return function(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=d((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=d(t);return i}(r)}};void 0===(i=function(){return v}.call(t,r,t,e))||(e.exports=i)}()}).call(this,r(49)(e),r(1))},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<e.length;n++)r[e.charCodeAt(n)]=n;t.encode=function(t){var r,n=new Uint8Array(t),i=n.length,o="";for(r=0;r<i;r+=3)o+=e[n[r]>>2],o+=e[(3&n[r])<<4|n[r+1]>>4],o+=e[(15&n[r+1])<<2|n[r+2]>>6],o+=e[63&n[r+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,n,i,o,s,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var h=new ArrayBuffer(a),d=new Uint8Array(h);for(t=0;t<c;t+=4)n=r[e.charCodeAt(t)],i=r[e.charCodeAt(t+1)],o=r[e.charCodeAt(t+2)],s=r[e.charCodeAt(t+3)],d[u++]=n<<2|i>>4,d[u++]=(15&i)<<4|o>>2,d[u++]=(3&o)<<6|63&s;return h}}()},function(e,t,r){(function(t){var r=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,n=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=n&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),o=r&&r.prototype.append&&r.prototype.getBlob;function s(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.buffer instanceof ArrayBuffer){var n=r.buffer;if(r.byteLength!==n.byteLength){var i=new Uint8Array(r.byteLength);i.set(new Uint8Array(n,r.byteOffset,r.byteLength)),n=i.buffer}e[t]=n}}}function a(e,t){t=t||{};var n=new r;s(e);for(var i=0;i<e.length;i++)n.append(e[i]);return t.type?n.getBlob(t.type):n.getBlob()}function c(e,t){return s(e),new Blob(e,t||{})}e.exports=n?i?t.Blob:c:o?a:void 0}).call(this,r(1))},function(e,t,r){(t=e.exports=o.debug=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e);for(var r=(e||"").split(/[\s,]+/),n=r.length,i=0;i<n;i++)r[i]&&("-"===(e=r[i].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(109),t.names=[],t.skips=[],t.formatters={};var n,i=0;function o(e){function r(){}function o(){var e=o,r=+new Date,s=r-(n||r);e.diff=s,e.prev=n,e.curr=r,n=r,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=t.colors[i++%t.colors.length]);for(var a=new Array(arguments.length),c=0;c<a.length;c++)a[c]=arguments[c];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var u=0;a[0]=a[0].replace(/%([a-z%])/g,function(r,n){if("%%"===r)return r;u++;var i=t.formatters[n];if("function"==typeof i){var o=a[u];r=i.call(e,o),a.splice(u,1),u--}return r}),a=t.formatArgs.apply(e,a),(o.log||t.log||console.log.bind(console)).apply(e,a)}r.enabled=!1,o.enabled=!0;var s=t.enabled(e)?o:r;return s.namespace=e,s}},function(e,t){var r=1e3,n=60*r,i=60*n,o=24*i,s=365.25*o;function a(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}e.exports=function(e,t){t=t||{};var c,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?a(c=e,o,"day")||a(c,i,"hour")||a(c,n,"minute")||a(c,r,"second")||c+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=n)return Math.round(e/n)+"m";if(e>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,r){(function(t){var n=r(54),i=r(19);e.exports=u;var o,s=/\n/g,a=/\\n/g;function c(){}function u(e){n.call(this,e),this.query=this.query||{},o||(t.___eio||(t.___eio=[]),o=t.___eio),this.index=o.length;var r=this;o.push(function(e){r.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){r.script&&(r.script.onerror=c)},!1)}i(u,n),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},u.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},u.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function u(){h(),t()}function h(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(e){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),h(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,r(1))},function(e,t,r){(function(t){var n,i=r(27),o=r(12),s=r(28),a=r(19),c=r(56),u=r(20)("engine.io-client:websocket"),h=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{n=r(112)}catch(e){}var d=h;function p(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=h&&!e.forceNode,this.usingBrowserWebSocket||(d=n),i.call(this,e)}d||"undefined"!=typeof window||(d=n),e.exports=p,a(p,i),p.prototype.name="websocket",p.prototype.supportsBinary=!0,p.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent,perMessageDeflate:this.perMessageDeflate};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.localAddress&&(t.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?new d(e):new d(e,void 0,t)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},p.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},p.prototype.write=function(e){var r=this;this.writable=!1;for(var n=e.length,i=0,s=n;i<s;i++)!function(e){o.encodePacket(e,r.supportsBinary,function(i){if(!r.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),r.perMessageDeflate)("string"==typeof i?t.Buffer.byteLength(i):i.length)<r.perMessageDeflate.threshold&&(o.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,o)}catch(e){u("websocket closed before onclose event")}--n||a()})}(e[i]);function a(){r.emit("flush"),setTimeout(function(){r.writable=!0,r.emit("drain")},0)}},p.prototype.onClose=function(){i.prototype.onClose.call(this)},p.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},p.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},p.prototype.check=function(){return!(!d||"__initialize"in d&&this.name===p.prototype.name)}}).call(this,r(1))},function(e,t){},function(e,t,r){(function(t){var r=/^[\],:{}\s]*$/,n=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,o=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(s,"").replace(a,""),t.JSON&&JSON.parse?JSON.parse(e):r.test(e.replace(n,"@").replace(i,"]").replace(o,""))?new Function("return "+e)():void 0):null}}).call(this,r(1))},function(e,t){e.exports=function(e,t){for(var r=[],n=(t=t||0)||0;n<e.length;n++)r[n-t]=e[n];return r}},function(e,t){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-r:e+r}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},function(e,t,r){"use strict";r.r(t);var n,i,o=r(29),s=r(14);!function(e){e.progress="progress",e.terminated="terminated",e.accepted="accepted"}(n||(n={})),function(e){e.registered="registered",e.unregistered="unregistered",e.registrationFailed="registrationFailed",e.invite="invite",e.inviteSent="inviteSent",e.disconnected="disconnected"}(i||(i={}));var a=function(){function e(e){this.ID_AUDIO="remoteAudio",this.sip_ua=null,this.sip_sessions_in=[],this.sip_sessions_out=[],this.sip_callbacks=[],this.autoAnswerOnceFlag=!1,this.pc=null,this.sip_debug=e.debug,this.sip_account=e.sip_account,this.sip_domain=e.sip_domain,this.sip_password=e.sip_password,this.sip_autoAnswer=e.sip_autoAnswer,this.wss_proto=e.wss_proto,this.wss_address=e.wss_address,this.wss_port=e.wss_port,this.ice_checkTimeout=e.ice_checkTimeout,this.register_expire=e.register_expire,(null==this.register_expire||this.register_expire>600||this.register_expire<0)&&(this.register_expire=600),this.sip_callbacks=[].concat(e.sip_callbacks),this.inDeviceId=e.inDeviceId,this.outDeviceId=e.outDeviceId,void 0===this.inDeviceId&&(this.inDeviceId="default"),void 0===this.outDeviceId&&(this.outDeviceId="default"),this.initGui(),this.start()}return e.prototype.initGui=function(){var e=document.createElement("audio");e.id=this.ID_AUDIO,e.hidden=!0,document.body.appendChild(e)},e.prototype.destroyGui=function(){var e=document.getElementById(this.ID_AUDIO);e&&document.body.removeChild(e)},e.prototype.writeLog=function(e){this.sip_debug&&console.log("天客云2.0 Sdk WebRTC [ "+e+" ]")},e.prototype.fireCallBack=function(e,t){i.invite===e&&(this.sip_autoAnswer||this.autoAnswerOnceFlag)&&(this.autoAnswerOnceFlag?(this.writeLog("autoAnswerOnceFlag exec complete , set false"),this.autoAnswerOnceFlag=!1):this.writeLog("autoAnswer enable, answer now!!!"),this.answer()),this.sip_callbacks.map(function(r,n){r.handle(e,t)})},e.prototype.handleUA=function(e){var t=this;t.writeLog("ua add listener"),e.on(i.registered,function(e){t.writeLog(i.registered),t.fireCallBack(i.registered,null)}),e.on(i.unregistered,function(e,r){t.writeLog(i.unregistered),t.fireCallBack(i.unregistered,null)}),e.on(i.registrationFailed,function(e,r){t.writeLog(i.registrationFailed),t.fireCallBack(i.registrationFailed,null)}),e.on(i.invite,function(e){t.writeLog(i.invite),t.sip_sessions_in.push(e),t.handleSession(e),t.fireCallBack(i.invite,null)}),e.on(i.inviteSent,function(e){t.writeLog(i.inviteSent),t.sip_sessions_out.push(e),t.handleSession(e),t.fireCallBack(i.inviteSent,null)}),e.transport.on(i.disconnected,function(){t.fireCallBack(i.disconnected,null)})},e.prototype.handleSession=function(e){var t=this,r=this;r.writeLog("session add listener"),e instanceof s.InviteServerContext?(e.on(n.progress,function(t,i){r.writeLog("session in "+n.progress+" "+r.sip_sessions_in.length),r.handleAudio(e),r.fireCallBack(n.progress,null)}),e.on(n.accepted,function(i,o){r.writeLog("session in "+n.accepted+" "+r.sip_sessions_in.length),r.handleAudio(e),r.fireCallBack(n.accepted,t.pc)}),e.on(n.terminated,function(t,i){r.sip_sessions_in=r.sip_sessions_in.filter(function(t){return e!=t}),r.writeLog("session in "+n.terminated+" "+r.sip_sessions_in.length),r.fireCallBack(n.terminated,null)})):e instanceof s.InviteClientContext&&(e.on(n.progress,function(t,i){r.writeLog("session out "+n.progress+" "+r.sip_sessions_out.length),r.handleAudio(e),r.fireCallBack(n.progress,null)}),e.on(n.terminated,function(t,i){r.sip_sessions_out=r.sip_sessions_out.filter(function(t){return e!=t}),r.writeLog("session out "+n.terminated+" "+r.sip_sessions_out.length),r.fireCallBack(n.terminated,null)}))},e.prototype.handleAudio=function(e){var t=this,r=e.sessionDescriptionHandler.peerConnection;this.pc=r;var n=new MediaStream;if(r.getReceivers().forEach(function(e){n.addTrack(e.track)}),n.active){t.writeLog("remoteStream active attach audio");var i=document.getElementById(t.ID_AUDIO);i.srcObject=n,i.setSinkId?i.setSinkId(t.outDeviceId).then(function(){i.play().catch(function(e){t.writeLog(e)})}):i.play().catch(function(e){t.writeLog(e)})}else t.writeLog("remoteStream not active ignore")},e.prototype.start=function(){var e={uri:this.sip_account+"@"+this.sip_domain,password:this.sip_password,transportOptions:{wsServers:[this.wss_proto+"://"+this.wss_address+":"+this.wss_port],traceSip:this.sip_debug,maxReconnectionAttempts:0},register:!0,registerOptions:{expires:this.register_expire},autostart:!0,allowLegacyNotifications:!0,rel100:o.C.supported.SUPPORTED,sessionDescriptionHandlerFactoryOptions:{peerConnectionOptions:{iceCheckingTimeout:this.ice_checkTimeout,rtcConfiguration:{iceServers:[{urls:["stun:stun1.ketianyun.com","stun:turnserver.ketianyun.com"]},{credentialType:"password",urls:["turn:stun1.ketianyun.com"],username:"ketian",credential:"Kty1234"}]}}}};this.sip_ua=new o.UA(e),this.handleUA(this.sip_ua)},e.prototype.invite=function(e){if(this.count()>0)return this.writeLog("only 1 call is allowed"),!1;var t=this.sip_ua;if(null!=t){var r=e+"@"+this.sip_domain;return t.invite(r,{sessionDescriptionHandlerOptions:{constraints:{audio:{deviceId:this.inDeviceId},video:!1}}}),!0}return!1},e.prototype.answer=function(){var e=this;this.sip_sessions_in.map(function(t,r){t.accept({sessionDescriptionHandlerOptions:{constraints:{audio:{deviceId:e.inDeviceId},video:!1}}})})},e.prototype.hangup=function(){this.sip_sessions_out.map(function(e,t){e.terminate()}),this.sip_sessions_in.map(function(e,t){e.terminate()})},e.prototype.stop=function(){var e=this.sip_ua;e&&(e.unregister(),e.stop(),this.destroyGui(),this.sip_callbacks=[],this.sip_ua=null)},e.prototype.count=function(){return this.sip_sessions_out.length+this.sip_sessions_in.length},e.prototype.autoAnswerOnce=function(){this.autoAnswerOnceFlag=!0},e.prototype.setAutoAnswer=function(e){this.sip_autoAnswer=e},e.prototype.setInDevice=function(e){void 0!==e&&(this.inDeviceId=e)},e.prototype.setOutDevice=function(e){void 0!==e&&(this.outDeviceId=e)},e.prototype.getAutoAnswerState=function(){return this.sip_autoAnswer},e}(),c=null;function u(){return null!=c}function h(){u()&&c.autoAnswerOnce()}var d=r(10),p=r.n(d),l=r(61),f=r.n(l);function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var v,y,T,C,S,A,b,E;window.sessionStorage.state="";var w,_,R,I,O,N,D,k,x,U,P,L,H,q,M,B,F,j=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),m(this,"agentNo",void 0),m(this,"token",void 0),m(this,"baseUrl",""),m(this,"orgId",""),m(this,"stateListener",[]),m(this,"initListener",[]),m(this,"popScreen",[]),m(this,"socketAgent",void 0),m(this,"discountCallback",void 0),m(this,"debug",!0),m(this,"autoReconnect",!0),m(this,"sendAgentStateMsg",!1),this.baseUrl=t.baseUrl,this.agentNo=t.agentNo,this.debug=t.debug,this.autoReconnect=void 0===t.autoReconnect||t.autoReconnect,this.path="/agentbar",this.sendAgentStateMsg=void 0!==t.sendAgentStateMsg&&t.sendAgentStateMsg,n&&(this.discountCallback=n),r&&this.initListener.push(r),t.popScreen&&this.popScreen.push(t.popScreen),t.stateEventListener&&this.addStateListener(t.stateEventListener),t.loginCallback&&this.addStateListener(t.loginCallback),this.socketAgent=f()(this.baseUrl,{path:this.path,autoConnect:!0,reconnection:this.autoReconnect,forceNew:!1,transports:["websocket"]}),this.socketEvent(this.socketAgent)}var t,r,n;return t=e,(r=[{key:"addStateListener",value:function(e){this.stateListener.push(e)}},{key:"onChangeState",value:function(e,t){this.stateListener.map(function(r){r({event:e,data:t})})}},{key:"login",value:function(e,t){var r={username:"",password:""};r.token=e,r.agentNo=t,r.sendAgentStateMsg=this.sendAgentStateMsg,this.socketAgent.emit("LOGIN",r)}},{key:"logout",value:function(e){var t={};t.agentNo=y,t.userId=T,t.workNo=v,t.orgId=this.orgId,t.type=e,this.socketAgent.emit("LOGOUT",t)}},{key:"ready",value:function(){var e={};e.workNo=v,e.userId=T,e.orgId=this.orgId,this.socketAgent.emit("READY",e)}},{key:"busy",value:function(){var e={};e.workNo=v,e.userId=T,e.orgId=this.orgId,this.socketAgent.emit("BUSY",e)}},{key:"rest",value:function(e){var t={};t.workNo=v,t.userId=T,t.orgId=this.orgId,t.detail=e,this.socketAgent.emit("REST",t)}},{key:"progress",value:function(){var e={};e.workNo=v,e.userId=T,e.orgId=this.orgId,this.socketAgent.emit("PROGRESS",e)}},{key:"makecall",value:function(e,t){var r={};r.workNo=v,r.orgId=this.orgId,r.agentNo=y,r.domain=C,r.callOut=e,r.extraData=t,this.socketAgent.emit("MAKECALL",r),h()}},{key:"makecallEncode",value:function(e,t){var r={};r.workNo=v,r.orgId=this.orgId,r.agentNo=y,r.domain=C,r.callOut=e,r.extraData=t,this.socketAgent.emit("MAKECALL_ENCODED",r),h()}},{key:"makecall58",value:function(e,t){var r={};r.workNo=v,r.orgId=this.orgId,r.agentNo=y,r.domain=C,r.callOut=e,r.extraData=t,this.socketAgent.emit("MAKECALL58",r),h()}},{key:"makecall58External",value:function(e){this.socketAgent.emit("MAKECALL58EXTERNAL",e)}},{key:"changeEnv",value:function(e,t){var r={type:e,phoneNo:t,orgId:this.orgId,userId:T};this.socketAgent.emit("CHANGE_ENV",r)}},{key:"hold",value:function(){var e={};e.uuid=S,this.socketAgent.emit("HOLD",e)}},{key:"unhold",value:function(){var e={};e.uuid=S,this.socketAgent.emit("UNHOLD",e)}},{key:"dtmf",value:function(e){var t={};t.uuid=S,t.dtmf=e,this.socketAgent.emit("DTMF",t)}},{key:"talk",value:function(){var e={};e.uuid=A,e.node=b,this.socketAgent.emit("TALK",e)}},{key:"hangup",value:function(){var e={};e.uuid=S,e.node=b,this.socketAgent.emit("KILLCALL",e)}},{key:"hangupEx",value:function(e){var t={};t.uuid=S,t.node=b,t.hangupToState=e,this.socketAgent.emit("KILLCALL_EX",t)}},{key:"satisfy",value:function(){var e={};e.uuid=S,e.orgId=this.orgId,this.socketAgent.emit("SATISFY",e)}},{key:"satisfy58",value:function(e){var t={};t.uuid=S,t.orgId=this.orgId,t.satisfyId=e,this.socketAgent.emit("SATISFY58",t)}},{key:"transfer",value:function(e,t,r,n,i,o){var s={};s.type=e,s.uuid=S,s.orgId=this.orgId,s.domain=C,s.userId=T,s.transferNo=t,s.transferQueue=r,s.transfeeNo=n,s.transferUserId=i,s.transferPstn=o,this.socketAgent.emit("TRANSFER",s)}},{key:"transfer58",value:function(e,t){if("3"===e||3===e){var r=JSON.parse(t);this.socketAgent.emit("JUMPFLOW",r)}else{var n={};n.uuid=S,n.domain=C,n.userId=T,n.orgId=this.orgId,n.type=e,n.info=t,this.socketAgent.emit("TRANSFER58",n)}}},{key:"jumpFlow",value:function(e,t){var r={};r.rootFlowId=e,r.pstn=t,this.socketAgent.emit("JUMPFLOW",r)}},{key:"toIvr",value:function(e){var t={};t.rootFlowId=e,this.socketAgent.emit("TOIVR",t)}},{key:"threeWay",value:function(e,t){var r={};r.type=e,r.uuid=S,r.orgId=this.orgId,r.domain=C,r.userId=T,r.threewayNo=t,this.socketAgent.emit("THREEWAY",r)}},{key:"threeWay58",value:function(e,t){var r={};r.type=e,r.uuid=S,r.orgId=this.orgId,r.domain=C,r.userId=T,r.threewayNo=t,this.socketAgent.emit("THREEWAY58",r)}},{key:"dropCall",value:function(e){var t={};t.userId=T,this.socketAgent.emit("DROPCALL",t)}},{key:"stateChange",value:function(e,t){var r={};r.oa=e,r.type=this.state,this.socketAgent.emit("STATECHANGE",r)}},{key:"listenCall",value:function(e,t){var r={};r.orgId=this.orgId,r.userId=T,r.domain=C,r.uuid=e,r.listenCaller=y,r.listenCallee=t,this.socketAgent.emit("LISTENCALL",r)}},{key:"listenCall58",value:function(e){var t={};t.orgId=this.orgId,t.userId=T,t.domain=C,t.uuid=A,t.listenCaller=y,t.oa=e,this.socketAgent.emit("LISTENCALL58",t)}},{key:"bargeinCall",value:function(e){var t={};t.uuid=S,t.oa=e,this.socketAgent.emit("BARGEINCALL",t)}},{key:"whisperCall",value:function(e){var t={};t.uuid=S,t.oa=e,this.socketAgent.emit("WHISPERCALL",t)}},{key:"threewayCall",value:function(e){var t={};t.uuid=S,t.oa=e,this.socketAgent.emit("THREEWAYCALL",t)}},{key:"restoreCall",value:function(){var e={};e.uuid=S,this.socketAgent.emit("RESTORECALL",e)}},{key:"demolish",value:function(e,t){var r={};r.orgId=this.orgId,r.uuid=e,r.listenCaller=y,r.listenCallee=t,this.socketAgent.emit("DEMOLISH",r)}},{key:"destroy",value:function(){this.socketAgent.close(),this.discountCallback=null,this.initListener=[]}},{key:"consult",value:function(e,t){var r={};r.callId=S,r.consultNum=e,r.domain=C,r.orgId=this.orgId,r.consultUserId=t,this.socketAgent.emit("CONSULT",r)}},{key:"consult58",value:function(e,t){var r={};r.callId=S,r.consultNum=t,r.domain=C,r.orgId=this.orgId,r.type=e,this.socketAgent.emit("CONSULT58",r)}},{key:"consultComplete",value:function(){var e={};e.callId=S,this.socketAgent.emit("CONSULTCOMPLETE",e)}},{key:"consultCancel",value:function(){var e={};e.callId=S,e.consultUuid=E,this.socketAgent.emit("CONSULTCANCEL",e)}},{key:"consultConf",value:function(){var e={};e.callId=S,this.socketAgent.emit("CONSULTCONF",e)}},{key:"signOut",value:function(e){var t={};t.orgId=this.orgId,t.userId=T,t.domain=C,t.oa=e,this.socketAgent.emit("SIGNOUT",t)}},{key:"releaseCall",value:function(e){var t={};t.orgId=this.orgId,t.userId=T,t.domain=C,t.oa=e,this.socketAgent.emit("RELEASECALL",t)}},{key:"mute",value:function(e){this.socketAgent.emit("MUTE",e)}},{key:"writeToScreen",value:function(e){!0===this.debug&&console.log("天客云2.0 Sdk WebSocket [ "+e+" ]")}},{key:"socketEvent",value:function(e){var t=this;e.on("connect",function(){t.writeToScreen("websocket连接成功"),t.initListener&&t.initListener.map(function(e){e({code:200,msg:"初始化连接成功."})})}),e.on("disconnect",function(e){t.writeToScreen("websocket断开连接"),t.initListener&&t.initListener.map(function(e){e({code:500,msg:"初始化连接失败."}),t.discountCallback()})}),e.on("reconnect_failed",function(e){t.writeToScreen("websocket重连失败"),t.initListener&&t.initListener.map(function(e){e({code:500,msg:"websocket重连失败."})})}),e.on("reconnect",function(e){t.writeToScreen("websocket reconnect "+e)}),e.on("CB_CONNECT",function(e){t.onChangeState("CB_CONNECT",e)}),e.on("CB_LOGIN",function(e){200===e.code?(t.writeToScreen(e.message),t.orgId=e.data.orgId,v=e.data.workNo,y=e.data.agentNo,T=e.data.userId,C=e.data.domain):(t.writeToScreen(e.message),t.orgId="",v="",y="",T="",C=""),t.onChangeState("CB_LOGIN",e)}),e.on("CB_LOGOUT",function(e){t.onChangeState("CB_LOGOUT",e),200===e.code&&(t.writeToScreen(e.message),t.orgId="",v="",y="",T="",C="",S="",A="")}),e.on("CB_MAKECALL",function(e){200===e.code&&(b=e.data.node),t.onChangeState("CB_MAKECALL",e)}),e.on("CB_TRANSFER",function(e){t.onChangeState("CB_TRANSFER",e)}),e.on("CB_JUMPFLOW",function(e){t.onChangeState("CB_TRANSFER",e)}),e.on("CB_TOIVR",function(e){t.onChangeState("CB_TOIVR",e)}),e.on("CB_READY",function(e){t.onChangeState("CB_READY",e)}),e.on("CB_BUSY",function(e){t.onChangeState("CB_BUSY",e)}),e.on("CB_REST",function(e){t.onChangeState("CB_REST",e)}),e.on("CB_PROGRESS",function(e){t.onChangeState("CB_PROGRESS",e)}),e.on("CB_RINGING",function(e){var r=e.data;t.writeToScreen(r),S=r.callId,A=r.uuid,t.onChangeState("CB_RINGING",e),t.popScreen[0]&&t.popScreen.map(function(e){e(r)})}),e.on("CB_CUSTOMERRING",function(e){var r=e.data;t.writeToScreen(r),t.onChangeState("CB_CUSTOMERRING",e)}),e.on("CB_ANSWERING",function(e){t.onChangeState("CB_ANSWERING",e)}),e.on("CB_REALTIME",function(e){t.onChangeState("CB_REALTIME",e)}),e.on("CB_HANGUP",function(e){b="",t.onChangeState("CB_HANGUP",e)}),e.on("CB_HOLD",function(e){t.onChangeState("CB_HOLD",e)}),e.on("CB_DTMF",function(e){t.onChangeState("CB_DTMF",e)}),e.on("CB_UNHOLD",function(e){t.onChangeState("CB_UNHOLD",e)}),e.on("CB_THREEWAY",function(e){t.onChangeState("CB_THREEWAY",e)}),e.on("CB_STATE_CHANGE",function(e){t.onChangeState("CB_STATE_CHANGE",e)}),e.on("CB_LISTENCALL",function(e){t.onChangeState("CB_LISTENCALL",e)}),e.on("CB_KICKOUT",function(){t.discountCallback(),t.onChangeState("CB_KICKOUT",null)}),e.on("CB_CONSULT",function(e){var r=e.data;200===e.code&&(E=r.consultUuid),t.onChangeState("CB_CONSULT",e)}),e.on("CB_CONSULTCOMPLETE",function(e){E="",t.onChangeState("CB_CONSULTCOMPLETE",e)}),e.on("CB_CONSULTCANCEL",function(e){E="",t.onChangeState("CB_CONSULTCANCEL",e)}),e.on("CB_CHANGEENV",function(e){t.onChangeState("CB_CHANGEENV",e)}),e.on("CB_TALK",function(e){t.onChangeState("CB_TALK",e)}),e.on("CB_SIGNOUT",function(e){t.onChangeState("CB_SIGNOUT",e)}),e.on("CB_RELEASECALL",function(e){t.onChangeState("CB_RELEASECALL",e)}),e.on("CB_WHISPERCALL",function(e){t.onChangeState("CB_WHISPERCALL",e)}),e.on("CB_BARGINECALL",function(e){t.onChangeState("CB_BARGINECALL",e)}),e.on("CB_THREEWAYCALL",function(e){t.onChangeState("CB_THREEWAYCALL",e)}),e.on("CB_MUTE",function(e){t.onChangeState("CB_MUTE",e)}),e.on("CB_UNMUTE",function(e){t.onChangeState("CB_UNMUTE",e)})}}])&&g(t.prototype,r),n&&g(t,n),e}(),G=function(e){var t=p.a.create();return t.interceptors.response.use(function(t){return 200!==t.data.code&&e&&e(t),t},function(t){return e&&e(t.response),Promise.reject(t)}),t};r.d(t,"SipEvent",function(){return V}),r.d(t,"init",function(){return z}),r.d(t,"init58",function(){return $}),r.d(t,"initSecret",function(){return J}),r.d(t,"doubleInit",function(){return X}),r.d(t,"double2Init",function(){return Q}),r.d(t,"ZKdoubleInit",function(){return Z}),r.d(t,"ZK2doubleInit",function(){return ee}),r.d(t,"FdoubleInit",function(){return te}),r.d(t,"getToken",function(){return re}),r.d(t,"destroy",function(){return ne}),r.d(t,"stateListener",function(){return ie}),r.d(t,"addStateListener",function(){return oe}),r.d(t,"login",function(){return se}),r.d(t,"logout",function(){return ae}),r.d(t,"ready",function(){return ce}),r.d(t,"busy",function(){return ue}),r.d(t,"rest",function(){return he}),r.d(t,"progress",function(){return de}),r.d(t,"makecall",function(){return pe}),r.d(t,"makecallEncode",function(){return le}),r.d(t,"makecall58",function(){return fe}),r.d(t,"makecall58External",function(){return ge}),r.d(t,"changeEnv",function(){return me}),r.d(t,"hold",function(){return ve}),r.d(t,"unhold",function(){return ye}),r.d(t,"dtmf",function(){return Te}),r.d(t,"talk",function(){return Ce}),r.d(t,"hangup",function(){return Se}),r.d(t,"hangupEx",function(){return Ae}),r.d(t,"satisfy",function(){return be}),r.d(t,"satisfy58",function(){return Ee}),r.d(t,"transfer",function(){return we}),r.d(t,"transfer58",function(){return _e}),r.d(t,"jumpFlow",function(){return Re}),r.d(t,"toIvr",function(){return Ie}),r.d(t,"threeWay",function(){return Oe}),r.d(t,"threeWay58",function(){return Ne}),r.d(t,"dropCall",function(){return De}),r.d(t,"stateChange",function(){return ke}),r.d(t,"listenCall",function(){return xe}),r.d(t,"demolish",function(){return Ue}),r.d(t,"listenCall58",function(){return Pe}),r.d(t,"bargeinCall",function(){return Le}),r.d(t,"whisperCall",function(){return He}),r.d(t,"threewayCall",function(){return qe}),r.d(t,"restoreCall",function(){return Me}),r.d(t,"signOut",function(){return Be}),r.d(t,"releaseCall",function(){return Fe}),r.d(t,"consult",function(){return je}),r.d(t,"consult58",function(){return Ge}),r.d(t,"consultComplete",function(){return We}),r.d(t,"consultCancel",function(){return Ke}),r.d(t,"consultConf",function(){return Ve}),r.d(t,"mute",function(){return Ye}),r.d(t,"getFreeAgentInfo",function(){return ze}),r.d(t,"webRTCAnswer",function(){return $e}),r.d(t,"setWebRTCAutoAnswer",function(){return Je}),r.d(t,"getAlreadyBind",function(){return Xe}),r.d(t,"setInDevice",function(){return Qe}),r.d(t,"setOutDevice",function(){return Ze}),r.d(t,"getInDeviceList",function(){return et}),r.d(t,"getOutDeviceList",function(){return tt}),r.d(t,"getAvailableTypes",function(){return rt}),r.d(t,"getCallInMobileState",function(){return nt}),r.d(t,"setCallInMobileState",function(){return it}),r.d(t,"getAgentInfo",function(){return ot}),r.d(t,"getQueueInfo",function(){return st}),r.d(t,"isAnswer",function(){return at}),r.d(t,"getAfterHangupStatus",function(){return ct}),r.d(t,"setAfterHangupStatus",function(){return ut}),r.d(t,"forceChange",function(){return ht}),r.d(t,"getPeerConnection",function(){return dt}),r.d(t,"doubleMakeCall",function(){return pt}),r.d(t,"double2MakeCall",function(){return lt}),r.d(t,"doubleHangUp",function(){return ft}),r.d(t,"ZKdoubleMakeCall",function(){return gt}),r.d(t,"ZK2doubleMakeCall",function(){return mt}),r.d(t,"ZKdoubleHangUp",function(){return vt}),r.d(t,"fhDoubleMakeCall",function(){return yt}),r.d(t,"zpytDoubleCall",function(){return Tt}),r.d(t,"ywDoubleMakeCall",function(){return Ct}),r.d(t,"yw2DoubleMakeCall",function(){return St}),r.d(t,"cmDoublePhoneMakeCall",function(){return At}),r.d(t,"fhDoubleInit",function(){return bt}),r.d(t,"FdoubleMakeCall",function(){return Et}),r.d(t,"FdoubleHangUp",function(){return wt}),r.d(t,"ywDoubleInit",function(){return _t}),r.d(t,"yw2DoubleInit",function(){return Rt}),r.d(t,"cmDoublePhoneInit",function(){return It});var W=!0,K=!1,V=i,Y=p.a;function z(e,t,r){return new Promise(function(n){_=e.baseUrl,O=e.username,N=e.password,q=e.inDeviceId,M=e.outDeviceId,B=e.register_expire,F=e.httpErrorCallback,Y=G(F),!1===e.debug?W=!1:e.debug=!0,void 0===q&&(q="default"),void 0===M&&(M="default"),U=!!e.webRTCAutoAnswer&&e.webRTCAutoAnswer,L=e.iceCheckTimeout?e.iceCheckTimeout:500,k="true"===e.enableWebRTC,P=r?[].concat(r):[],e.autoReady&&k&&P.push({handle:function(e,t){"registered"===e?K||(ce(),K=!K):"unregistered"!==e&&"registrationFailed"!==e&&"disconnected"!==e||(K=!1)}});var i=e.token,o=e.orgi;i&&o?(I=i,R=o,Ot(e,t).then(function(e){n(e)})):Y.post(_+"/callInfo/sipInfo/auth",{username:O,password:N}).then(function(r){r.data.data||n({code:500,msg:"登录失败"}),I=r.data.data.token,R=r.data.data.orgi,Ot(e,t).then(function(e){n(e)})})})}function $(e,t,r){return new Promise(function(n){_=e.baseUrl,O=e.username,N=e.password,q=e.inDeviceId,M=e.outDeviceId,B=e.register_expire,F=e.httpErrorCallback,Y=G(F),!1===e.debug?W=!1:e.debug=!0,void 0===q&&(q="default"),void 0===M&&(M="default"),U=!!e.webRTCAutoAnswer&&e.webRTCAutoAnswer,L=e.iceCheckTimeout?e.iceCheckTimeout:500,k="true"===e.enableWebRTC,P=r?[].concat(r):[],e.autoReady&&k&&P.push({handle:function(e,t){"registered"===e?K||(ce(),K=!K):"unregistered"!==e&&"registrationFailed"!==e&&"disconnected"!==e||(K=!1)}});var i=e.token,o=e.orgi;i&&o?(I=i,R=o,Ot(e,t).then(function(e){n(e)})):Y.post(_+"/callInfo/sipInfo/auth2",{username:O,password:N}).then(function(r){r.data.data||n({code:500,msg:"登录失败"}),I=r.data.data.token,R=r.data.data.orgi,Ot(e,t).then(function(e){n(e)})})})}function J(e,t,r){return new Promise(function(n){_=e.baseUrl,O=e.username,N=e.password,q=e.inDeviceId,M=e.outDeviceId,B=e.register_expire,F=e.httpErrorCallback,Y=G(F),!1===e.debug?W=!1:e.debug=!0,void 0===q&&(q="default"),void 0===M&&(M="default"),U=!!e.webRTCAutoAnswer&&e.webRTCAutoAnswer,L=e.iceCheckTimeout?e.iceCheckTimeout:500,k="true"===e.enableWebRTC,P=r?[].concat(r):[],e.autoReady&&k&&P.push({handle:function(e,t){"registered"===e?K||(ce(),K=!K):"unregistered"!==e&&"registrationFailed"!==e&&"disconnected"!==e||(K=!1)}});var i=e.token,o=e.orgi;i&&o?(I=i,R=o,Ot(e,t).then(function(e){n(e)})):Y.post(_+"/callInfo/sipInfo/auth2",{username:O,password:N}).then(function(r){r.data.data?(I=r.data.data.token,R=r.data.data.orgi,Ot(e,t).then(function(e){n(e)})):n({code:r.data.code,msg:r.data.msg})})})}function X(e){return rt(e).then(function(e){return e.includes("double")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function Q(e){return rt(e).then(function(e){return e.includes("double2")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function Z(e){return rt(e).then(function(e){return e.includes("zkdouble")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function ee(e){return rt(e).then(function(e){return e.includes("zk2double")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function te(e){return rt(e).then(function(e){return e.includes("fdouble")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function re(e){return _=e.baseUrl,O=e.username,N=e.password,p.a.post(_+"/callInfo/sipInfo/auth",{username:O,password:N}).then(function(e){return e.data.data?(I=e.data.data.token,R=e.data.data.orgi,{code:200,msg:"登录成功",data:{token:I}}):{code:500,msg:"登录失败"}})}function ne(){null!=w&&(w.logout(),w.destroy(),K=!1),Dt()}function ie(){return w.stateListener}function oe(e){w.addStateListener(e)}function se(e,t,r){D=e,!0===k?!0===x?(void 0!==q&&(q=t),void 0!==M&&(M=r),navigator.mediaDevices.getUserMedia({video:!1,audio:{deviceId:q}}).then(function(t){t.getTracks().forEach(function(e){e.stop()}),P.map(function(e,t){e.handle("check",!0)}),w.login(I,e)}).catch(function(e){kt("麦克风校验失败!"),Dt(),P.map(function(e,t){e.handle("check",!1)})})):kt("WebRTC模式不允许,回落至硬件话机模式!!!"):w.login(I,e)}function ae(){w.logout(1),K=!1,Dt()}function ce(){w.ready()}function ue(){w.busy()}function he(e){w.rest(e)}function de(){w.progress()}function pe(e,t){w.makecall(e,t)}function le(e,t){w.makecallEncode(e,t)}function fe(e,t){w.makecall58(e,t)}function ge(e){w.makecall58External(e)}function me(e,t){w.changeEnv(e,t)}function ve(){w.hold()}function ye(){w.unhold()}function Te(e){w.dtmf(e)}function Ce(){w.talk()}function Se(){w.hangup()}function Ae(e){w.hangupEx(e)}function be(){w.satisfy()}function Ee(e){w.satisfy58(e)}function we(e,t,r,n,i,o){w.transfer(e,t,r,n,i,o)}function _e(e,t){w.transfer58(e,t)}function Re(e,t){w.jumpFlow(e,t)}function Ie(e){w.toIvr(e)}function Oe(e,t){w.threeWay(e,t)}function Ne(e,t){w.threeWay58(e,t)}function De(e){w.dropCall(e)}function ke(e,t){w.stateChange(e,t)}function xe(e,t){w.listenCall(e,t)}function Ue(e,t){w.demolish(e,t)}function Pe(e){w.listenCall58(e)}function Le(e){w.bargeinCall(e)}function He(e){w.whisperCall(e)}function qe(e){w.threewayCall(e)}function Me(){w.restoreCall()}function Be(e){w.signOut(e)}function Fe(e){w.releaseCall(e)}function je(e,t){w.consult(e,t)}function Ge(e,t){w.consult58(e,t)}function We(){w.consultComplete()}function Ke(){w.consultCancel()}function Ve(){w.consultConf()}function Ye(e){w.mute(e)}function ze(e){return Y({url:_+"/callInfo/freeAgents/"+e,headers:{token:I}}).then(function(e){return e.data.data})}function $e(){u()&&c.answer()}function Je(e){!function(e){u()&&c.setAutoAnswer(e)}(e),U=e}function Xe(){return Y.get(_+"/callInfo/sipInfo/alreadyBind?token="+I).then(function(e){return e.data.data})}function Qe(e){!function(e){u()&&c.setInDevice(e)}(e)}function Ze(e){!function(e){u()&&c.setOutDevice(e)}(e)}function et(){return navigator.mediaDevices.enumerateDevices().then(function(e){for(var t=e.length,r=0,n=[];r<t;r++){var i=e[r];"audioinput"===i.kind&&n.push({label:i.label,deviceId:i.deviceId})}return n})}function tt(){return navigator.mediaDevices.enumerateDevices().then(function(e){for(var t=e.length,r=0,n=[];r<t;r++){var i=e[r];"audiooutput"===i.kind&&n.push({label:i.label,deviceId:i.deviceId})}return n})}function rt(e){return _=e.baseUrl,void 0===I&&(I=e.token),p.a.get(_+"/callInfo/sipInfo/types?token="+I).then(function(e){return e.data.data})}function nt(){return Y({method:"get",url:_+"/callInfo/agents/checkTransferMob",headers:{token:I}}).then(function(e){return 200===e.data.code&&e.data.data})}function it(e){var t=!1;return!0===e&&(t=!0),Y({url:_+"/callInfo/agents/transferMob",method:"post",headers:{token:I},data:{open:t+""}}).then(function(e){return 200===e.data.code})}function ot(){return Y.get(_+"/callInfo/agents/"+R).then(function(e){return 200===e.data.code?e.data.data:[]})}function st(e,t){return Y.get(_+"/callInfo/queues/"+R+"/"+e+"/"+t).then(function(e){return 200===e.data.code?{data:e.data.data.records,total:e.data.data.total}:{data:[],total:0}})}function at(){return Y({url:_+"/callInfo/agents/isAnswer",method:"get",headers:{token:I}}).then(function(e){return e.data.data})}function ct(){return Y({url:_+"/callInfo/agents/afterHangupStatus",method:"get",headers:{token:I}}).then(function(e){return e.data.data})}function ut(e){return Y({url:_+"/callInfo/agents/afterHangupStatus",method:"post",headers:{token:I},data:{after_hangup_state:e}}).then(function(e){return 200===e.data.code})}function ht(e,t){return Y.post(_+"/callInfo/sipInfo/force/"+e+"/"+t,{token:I}).then(function(e){return e})}function dt(){return H}function pt(e,t){return Y({url:_+"/callInfo/call/xcall",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return e})}function lt(e,t){return Y({url:_+"/callInfo/call/x2call",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return e})}function ft(e,t){return Y({url:_+"/callInfo/call/stopxcall",method:"post",data:{sessionId:e},headers:{token:t}}).then(function(e){return e})}function gt(e,t){return Y({url:_+"/callInfo/call/kcall",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return e})}function mt(e,t){return Y({url:_+"/callInfo/call/k2call",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return e})}function vt(e,t){return Y({url:_+"/callInfo/call/stopkcall",method:"post",data:{sessionId:e},headers:{token:t}}).then(function(e){return e})}function yt(e,t){return Y({url:_+"/callInfo/call/fhcall",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return console.log(e),e})}function Tt(e,t){return Y({url:_+"/callInfo/call/zpytcall",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return console.log(e),e})}function Ct(e,t){return Y({url:_+"/callInfo/call/ywcall",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return console.log(e),e})}function St(e,t){return Y({url:_+"/callInfo/call/yw2call",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return console.log(e),e})}function At(e,t){return Y({url:_+"/callInfo/call/cmcall",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return console.log(e),e})}function bt(e){return rt(e).then(function(e){return e.includes("fhdouble")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function Et(e,t){return Y({url:_+"/callInfo/call/fcall",method:"post",data:{phone:e},headers:{token:t}}).then(function(e){return e})}function wt(e,t){return Y({url:_+"/callInfo/call/stopfcall",method:"post",data:{sessionId:e},headers:{token:t}}).then(function(e){return e})}function _t(e){return rt(e).then(function(e){return e.includes("ywdouble")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function Rt(e){return rt(e).then(function(e){return e.includes("yw2double")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function It(e){return rt(e).then(function(e){return e.includes("cmDoublePhone")?{code:200,msg:"ok"}:{code:501,msg:"该模式不可用,请联系管理员！"}})}function Ot(e,t){return new Promise(function(r){Y.get(_+"/callInfo/sipInfo/types?token="+I).then(function(n){var i=n.data.data;i.indexOf("webrtc")>-1||i.indexOf("hard")>-1?(i.indexOf("webrtc")>-1&&(x=!0),!0===k&&!0!==x&&(kt("WebRTC模式不允许,回落至硬件话机模式"),r({code:500,msg:"WebRTC模式不允许,回落至硬件话机模式！"})),e.loginCallback=function(e){x&&k&&"CB_LOGIN"===e.event&&200===e.data.code&&new Promise(function(e){x?Y.get(_+"/callInfo/sipInfo/"+D+"?token="+I).then(function(e){if(200===e.data.code){var t=e.data.data;r={sip_account:D,sip_domain:t.domain,sip_password:t.password,sip_autoAnswer:U,wss_proto:t.proto,wss_address:t.address,wss_port:t.port,ice_checkTimeout:L,debug:t.debug,sip_callbacks:P,inDeviceId:q,outDeviceId:M,register_expire:B},u()||(c=new a(r))}var r}):(kt("WebRTC模式无法使用,请联系管理员"),e({code:500,msg:"WebRTC模式无法使用,请联系管理员！"}))}).then(function(e){r(e)})},w=new j(e,t,Nt),e.autoReady&&!k&&oe(function(e){"CB_LOGIN"===e.event&&ce()})):(kt("无可用模式,请联系管理员"),r({code:501,msg:"无可用模式,请联系管理员！"})),r({code:200,msg:"ok",data:i})})})}function Nt(){Dt()}function Dt(){u()&&(c.stop(),c=null)}function kt(e){!0===W&&console.log("天客云2.0 Sdk [ "+e+" ]")}}]);